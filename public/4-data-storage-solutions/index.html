<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.147.8">
    <meta name="description" content="Build a complete weather data ETL pipeline using AWS Lambda, S3, Athena, and QuickSight">
<meta name="author" content="Dang Van Huy">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Data Analysis with Athena :: Weather ETL Pipeline with AWS</title>

    
    <link href="/css/nucleus.css?1752217735" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1752217735" rel="stylesheet">
    <link href="/css/hybrid.css?1752217735" rel="stylesheet">
    <link href="/css/featherlight.min.css?1752217735" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1752217735" rel="stylesheet">
    <link href="/css/auto-complete.css?1752217735" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1752217735" rel="stylesheet">
    <link href="/css/theme.css?1752217735" rel="stylesheet">
    <link href="/css/hugo-theme.css?1752217735" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1752217735" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1752217735"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/4-data-storage-solutions/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1752217735"></script>
<script type="text/javascript" src="/js/auto-complete.js?1752217735"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1752217735"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduction/" title="Introduction and Architecture" class="dd-item 
        
        
        
        ">
      <a href="/1-introduction/">
          <b>1. </b>Introduction and Architecture
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/" title="Weather Data Collection with Lambda" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/">
          <b>2. </b>Weather Data Collection with Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.2-lambda-weather-collector/" title="Building Lambda Weather Collector" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/2.2-lambda-weather-collector/">
          Building Lambda Weather Collector
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.1-openweathermap-setup/" title="OpenWeatherMap API Setup" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/2.1-openweathermap-setup/">
          OpenWeatherMap API Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.3-automated-scheduling/" title="Automated Scheduling with CloudWatch Events" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/2.3-automated-scheduling/">
          Automated Scheduling with CloudWatch Events
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.4-testing-monitoring/" title="Testing and Monitoring Weather Collection" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/2.4-testing-monitoring/">
          Testing and Monitoring Weather Collection
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-serverless-processing-lambda/" title="Data Processing and Transformation" class="dd-item 
        
        
        
        ">
      <a href="/3-serverless-processing-lambda/">
          <b>3. </b>Data Processing and Transformation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-data-storage-solutions/" title="Data Analysis with Athena" class="dd-item 
        
        active
        
        ">
      <a href="/4-data-storage-solutions/">
          <b>4. </b>Data Analysis with Athena
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-analytics-visualization/" title="Data Visualization with QuickSight" class="dd-item 
        
        
        
        ">
      <a href="/5-analytics-visualization/">
          <b>5. </b>Data Visualization with QuickSight
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/4-data-storage-solutions/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/4-data-storage-solutions/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
     
    
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>23-06-2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Author </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/imvhuy/"  style="color:orange">Đặng Văn Huy</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>Building ETL Data Pipeline for Weather Analytics on AWS</a> > Data Analysis with Athena
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#module-overview">Module Overview</a></li>
    <li><a href="#what-youll-build">What You&rsquo;ll Build</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#step-1-set-up-athena-query-result-location">Step 1: Set Up Athena Query Result Location</a>
      <ul>
        <li><a href="#11-create-s3-bucket-for-query-results">1.1 Create S3 Bucket for Query Results</a></li>
        <li><a href="#12-configure-athena-query-result-location">1.2 Configure Athena Query Result Location</a></li>
      </ul>
    </li>
    <li><a href="#step-2-create-database-and-table">Step 2: Create Database and Table</a>
      <ul>
        <li><a href="#21-create-weather-analytics-database">2.1 Create Weather Analytics Database</a></li>
        <li><a href="#22-create-external-table-for-processed-weather-data">2.2 Create External Table for Processed Weather Data</a></li>
        <li><a href="#23-verify-table-creation">2.3 Verify Table Creation</a></li>
      </ul>
    </li>
    <li><a href="#step-3-basic-weather-data-analysis">Step 3: Basic Weather Data Analysis</a>
      <ul>
        <li><a href="#31-data-exploration-queries">3.1 Data Exploration Queries</a></li>
        <li><a href="#32-temperature-analysis">3.2 Temperature Analysis</a></li>
        <li><a href="#33-weather-pattern-analysis">3.3 Weather Pattern Analysis</a></li>
      </ul>
    </li>
    <li><a href="#step-4-advanced-analytics-queries">Step 4: Advanced Analytics Queries</a>
      <ul>
        <li><a href="#41-time-series-analysis">4.1 Time-Series Analysis</a></li>
        <li><a href="#42-geographical-analysis">4.2 Geographical Analysis</a></li>
      </ul>
    </li>
    <li><a href="#step-5-export-and-visualize-results">Step 5: Export and Visualize Results</a>
      <ul>
        <li><a href="#51-save-query-results">5.1 Save Query Results</a></li>
        <li><a href="#52-create-simple-visualizations">5.2 Create Simple Visualizations</a></li>
        <li><a href="#53-example-analysis-workflow">5.3 Example Analysis Workflow</a></li>
      </ul>
    </li>
    <li><a href="#step-6-performance-optimization">Step 6: Performance Optimization</a>
      <ul>
        <li><a href="#61-query-performance-tips">6.1 Query Performance Tips</a></li>
        <li><a href="#62-cost-optimization">6.2 Cost Optimization</a></li>
      </ul>
    </li>
    <li><a href="#troubleshooting-common-issues">Troubleshooting Common Issues</a>
      <ul>
        <li><a href="#issue-1-table-not-found-error">Issue 1: &ldquo;Table not found&rdquo; Error</a></li>
        <li><a href="#issue-2-zero-records-returned">Issue 2: &ldquo;Zero records returned&rdquo;</a></li>
        <li><a href="#issue-3-access-denied-error">Issue 3: &ldquo;Access denied&rdquo; Error</a></li>
      </ul>
    </li>
    <li><a href="#cost-analysis">Cost Analysis</a></li>
    <li><a href="#next-steps">Next Steps</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Data Analysis with Athena
            </h1>
          

        



	<h1 id="data-analysis-with-athena">Data Analysis with Athena</h1>
<p>In this module, you&rsquo;ll learn how to use Amazon Athena to run SQL queries directly against your processed weather data stored in S3. Athena is a serverless query service that makes it easy to analyze data using standard SQL without the need to set up complex data warehousing infrastructure.</p>
<h2 id="module-overview">Module Overview</h2>
<p>Amazon Athena allows you to analyze data in S3 using standard SQL queries without having to move the data or set up servers. This makes it an ideal tool for ad-hoc analysis of your weather data. In this module, we&rsquo;ll set up Athena to query our processed weather data and extract meaningful insights.</p>
<p><strong>Duration:</strong> 40-50 minutes<br>
<strong>Cost:</strong> ~$0.50</p>
<h2 id="what-youll-build">What You&rsquo;ll Build</h2>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
    A[S3 Processed Data] --&gt; B[Athena Query Service]
    B --&gt; C[SQL Analysis]
    C --&gt; D[Weather Insights]

    style B fill:#4fc3f7,stroke:#232f3e,stroke-width:3px
    style A fill:#f3e5f5
    style D fill:#66bb6a
</code></pre><h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Completed Module 3: Data Processing and Transformation</li>
<li>Processed weather data available in S3</li>
<li>AWS Console access</li>
</ul>
<h2 id="step-1-set-up-athena-query-result-location">Step 1: Set Up Athena Query Result Location</h2>
<p>Before using Athena, you need to configure a location to store query results.</p>
<h3 id="11-create-s3-bucket-for-query-results">1.1 Create S3 Bucket for Query Results</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Create bucket for Athena query results</span>
</span></span><span style="display:flex;"><span>aws s3 mb s3://your-athena-query-results-bucket
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Optional: Set lifecycle policy to delete old results after 30 days</span>
</span></span><span style="display:flex;"><span>cat &gt; lifecycle-policy.json <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Rules&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;ID&#34;: &#34;DeleteOldQueryResults&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Status&#34;: &#34;Enabled&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Filter&#34;: {&#34;Prefix&#34;: &#34;&#34;},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Expiration&#34;: {&#34;Days&#34;: 30}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws s3api put-bucket-lifecycle-configuration <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --bucket your-athena-query-results-bucket <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --lifecycle-configuration file://lifecycle-policy.json
</span></span></code></pre></div><h3 id="12-configure-athena-query-result-location">1.2 Configure Athena Query Result Location</h3>
<ol>
<li>Open the <strong>Amazon Athena console</strong></li>
<li>Click <strong>Settings</strong> in the top right</li>
<li>Click <strong>Manage</strong></li>
<li>Enter your S3 bucket path: <code>s3://your-athena-query-results-bucket/</code></li>
<li>Click <strong>Save</strong></li>
</ol>
<h2 id="step-2-create-database-and-table">Step 2: Create Database and Table</h2>
<h3 id="21-create-weather-analytics-database">2.1 Create Weather Analytics Database</h3>
<p>In the Athena Query Editor, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> weather_analytics
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;Database for weather data analysis&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LOCATION</span> <span style="color:#e6db74">&#39;s3://your-athena-query-results-bucket/databases/weather_analytics/&#39;</span>;
</span></span></code></pre></div><h3 id="22-create-external-table-for-processed-weather-data">2.2 Create External Table for Processed Weather Data</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">EXTERNAL</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> weather_analytics.current_weather (
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">timestamp</span> STRING,
</span></span><span style="display:flex;"><span>  city_name STRING,
</span></span><span style="display:flex;"><span>  country STRING,
</span></span><span style="display:flex;"><span>  latitude DOUBLE,
</span></span><span style="display:flex;"><span>  longitude DOUBLE,
</span></span><span style="display:flex;"><span>  data_collection_date STRING,
</span></span><span style="display:flex;"><span>  temperature_kelvin DOUBLE,
</span></span><span style="display:flex;"><span>  temperature_celsius DOUBLE,
</span></span><span style="display:flex;"><span>  temperature_fahrenheit DOUBLE,
</span></span><span style="display:flex;"><span>  feels_like_celsius DOUBLE,
</span></span><span style="display:flex;"><span>  feels_like_fahrenheit DOUBLE,
</span></span><span style="display:flex;"><span>  humidity_percent INT,
</span></span><span style="display:flex;"><span>  pressure_hpa INT,
</span></span><span style="display:flex;"><span>  visibility_meters BIGINT,
</span></span><span style="display:flex;"><span>  uv_index DOUBLE,
</span></span><span style="display:flex;"><span>  weather_id INT,
</span></span><span style="display:flex;"><span>  weather_main STRING,
</span></span><span style="display:flex;"><span>  weather_description STRING,
</span></span><span style="display:flex;"><span>  weather_icon STRING,
</span></span><span style="display:flex;"><span>  wind_speed_ms DOUBLE,
</span></span><span style="display:flex;"><span>  wind_speed_kmh DOUBLE,
</span></span><span style="display:flex;"><span>  wind_speed_mph DOUBLE,
</span></span><span style="display:flex;"><span>  wind_direction_deg INT,
</span></span><span style="display:flex;"><span>  wind_gust_ms DOUBLE,
</span></span><span style="display:flex;"><span>  cloud_coverage_percent INT,
</span></span><span style="display:flex;"><span>  rain_1h_mm DOUBLE,
</span></span><span style="display:flex;"><span>  rain_3h_mm DOUBLE,
</span></span><span style="display:flex;"><span>  snow_1h_mm DOUBLE,
</span></span><span style="display:flex;"><span>  snow_3h_mm DOUBLE,
</span></span><span style="display:flex;"><span>  heat_index_fahrenheit DOUBLE,
</span></span><span style="display:flex;"><span>  heat_index_celsius DOUBLE,
</span></span><span style="display:flex;"><span>  comfort_level STRING,
</span></span><span style="display:flex;"><span>  wind_condition STRING,
</span></span><span style="display:flex;"><span>  weather_severity STRING
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ROW</span> FORMAT SERDE <span style="color:#e6db74">&#39;org.openx.data.jsonserde.JsonSerDe&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WITH</span> SERDEPROPERTIES (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;serialization.format&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LOCATION</span> <span style="color:#e6db74">&#39;s3://your-weather-processed-bucket/processed/&#39;</span>
</span></span><span style="display:flex;"><span>TBLPROPERTIES (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;has_encrypted_data&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;false&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;projection.enabled&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;true&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;projection.data_collection_date.type&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;date&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;projection.data_collection_date.range&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2025-01-01,NOW&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;projection.data_collection_date.format&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;yyyy-MM-dd&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;storage.location.template&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;s3://your-weather-processed-bucket/processed/year=${data_collection_date}&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="23-verify-table-creation">2.3 Verify Table Creation</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Check if table was created successfully
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> TABLES <span style="color:#66d9ef">IN</span> weather_analytics;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Get table schema
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">DESCRIBE</span> weather_analytics.current_weather;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Count total records
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> total_records
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather;
</span></span></code></pre></div><h2 id="step-3-basic-weather-data-analysis">Step 3: Basic Weather Data Analysis</h2>
<h3 id="31-data-exploration-queries">3.1 Data Exploration Queries</h3>
<h4 id="view-sample-data">View Sample Data</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Get a sample of your data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>;
</span></span></code></pre></div><h4 id="check-data-quality">Check Data Quality</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Check for missing values in key fields
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> total_records,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(temperature_celsius) <span style="color:#66d9ef">as</span> temp_records,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(humidity_percent) <span style="color:#66d9ef">as</span> humidity_records,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(pressure_hpa) <span style="color:#66d9ef">as</span> pressure_records,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(wind_speed_ms) <span style="color:#66d9ef">as</span> wind_records
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather;
</span></span></code></pre></div><h4 id="date-range-analysis">Date Range Analysis</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Check the date range of your data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MIN</span>(data_collection_date) <span style="color:#66d9ef">as</span> earliest_date,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MAX</span>(data_collection_date) <span style="color:#66d9ef">as</span> latest_date,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#66d9ef">DISTINCT</span> data_collection_date) <span style="color:#66d9ef">as</span> unique_dates
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather;
</span></span></code></pre></div><h3 id="32-temperature-analysis">3.2 Temperature Analysis</h3>
<h4 id="average-temperature-by-city">Average Temperature by City</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  city_name,
</span></span><span style="display:flex;"><span>  country,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> measurement_count,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(temperature_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_temp_celsius,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">MIN</span>(temperature_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> min_temp_celsius,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">MAX</span>(temperature_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> max_temp_celsius
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> city_name, country
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> avg_temp_celsius <span style="color:#66d9ef">DESC</span>;
</span></span></code></pre></div><h4 id="temperature-trends-over-time">Temperature Trends Over Time</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  data_collection_date,
</span></span><span style="display:flex;"><span>  city_name,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(temperature_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_temp,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(feels_like_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_feels_like
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> data_collection_date <span style="color:#f92672">&gt;=</span> DATE(<span style="color:#e6db74">&#39;2025-01-01&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> data_collection_date, city_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> data_collection_date, city_name;
</span></span></code></pre></div><h4 id="heat-index-analysis">Heat Index Analysis</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  city_name,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(heat_index_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_heat_index,
</span></span><span style="display:flex;"><span>  comfort_level,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> occurrence_count
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> heat_index_celsius <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> city_name, comfort_level
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> avg_heat_index <span style="color:#66d9ef">DESC</span>;
</span></span></code></pre></div><h3 id="33-weather-pattern-analysis">3.3 Weather Pattern Analysis</h3>
<h4 id="weather-condition-distribution">Weather Condition Distribution</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  weather_main,
</span></span><span style="display:flex;"><span>  weather_description,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> occurrence_count,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span> <span style="color:#66d9ef">SUM</span>(<span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>)) OVER (), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> percentage
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> weather_main, weather_description
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> occurrence_count <span style="color:#66d9ef">DESC</span>;
</span></span></code></pre></div><h4 id="wind-analysis">Wind Analysis</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  city_name,
</span></span><span style="display:flex;"><span>  wind_condition,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> occurrence_count,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(wind_speed_kmh), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_wind_speed_kmh,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">MAX</span>(wind_speed_kmh), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> max_wind_speed_kmh
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> city_name, wind_condition
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> city_name, avg_wind_speed_kmh <span style="color:#66d9ef">DESC</span>;
</span></span></code></pre></div><h4 id="humidity-vs-temperature-correlation">Humidity vs Temperature Correlation</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  city_name,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">CASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> temperature_celsius <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">15</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Cold&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> temperature_celsius <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Moderate&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ELSE</span> <span style="color:#e6db74">&#39;Hot&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">as</span> temp_category,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(humidity_percent), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_humidity,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(temperature_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_temperature,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> sample_count
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> city_name,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">CASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> temperature_celsius <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">15</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Cold&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> temperature_celsius <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Moderate&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ELSE</span> <span style="color:#e6db74">&#39;Hot&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">END</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> city_name, temp_category;
</span></span></code></pre></div><h2 id="step-4-advanced-analytics-queries">Step 4: Advanced Analytics Queries</h2>
<h3 id="41-time-series-analysis">4.1 Time-Series Analysis</h3>
<h4 id="daily-weather-summary">Daily Weather Summary</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  data_collection_date,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#66d9ef">DISTINCT</span> city_name) <span style="color:#66d9ef">as</span> cities_measured,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(temperature_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> global_avg_temp,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(humidity_percent), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> global_avg_humidity,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(pressure_hpa), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> global_avg_pressure
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> data_collection_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> data_collection_date;
</span></span></code></pre></div><h4 id="weather-extremes">Weather Extremes</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Find temperature extremes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">WITH</span> temp_extremes <span style="color:#66d9ef">AS</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>    data_collection_date,
</span></span><span style="display:flex;"><span>    city_name,
</span></span><span style="display:flex;"><span>    temperature_celsius,
</span></span><span style="display:flex;"><span>    ROW_NUMBER() OVER (PARTITION <span style="color:#66d9ef">BY</span> data_collection_date <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> temperature_celsius <span style="color:#66d9ef">DESC</span>) <span style="color:#66d9ef">as</span> hot_rank,
</span></span><span style="display:flex;"><span>    ROW_NUMBER() OVER (PARTITION <span style="color:#66d9ef">BY</span> data_collection_date <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> temperature_celsius <span style="color:#66d9ef">ASC</span>) <span style="color:#66d9ef">as</span> cold_rank
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  data_collection_date,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MAX</span>(<span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> hot_rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">THEN</span> city_name <span style="color:#66d9ef">END</span>) <span style="color:#66d9ef">as</span> hottest_city,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MAX</span>(<span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> hot_rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">THEN</span> temperature_celsius <span style="color:#66d9ef">END</span>) <span style="color:#66d9ef">as</span> highest_temp,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MAX</span>(<span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> cold_rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">THEN</span> city_name <span style="color:#66d9ef">END</span>) <span style="color:#66d9ef">as</span> coldest_city,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MAX</span>(<span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> cold_rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">THEN</span> temperature_celsius <span style="color:#66d9ef">END</span>) <span style="color:#66d9ef">as</span> lowest_temp
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> temp_extremes
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> hot_rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">OR</span> cold_rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> data_collection_date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> data_collection_date;
</span></span></code></pre></div><h3 id="42-geographical-analysis">4.2 Geographical Analysis</h3>
<h4 id="weather-by-geographic-region">Weather by Geographic Region</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">CASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> latitude <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">23</span>.<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Northern Temperate&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> latitude <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Northern Tropical&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> latitude <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">23</span>.<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Southern Tropical&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ELSE</span> <span style="color:#e6db74">&#39;Southern Temperate&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">as</span> climate_zone,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> measurement_count,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(temperature_celsius), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_temperature,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(humidity_percent), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_humidity,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(wind_speed_kmh), <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> avg_wind_speed
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">CASE</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> latitude <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">23</span>.<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Northern Temperate&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> latitude <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Northern Tropical&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">WHEN</span> latitude <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">23</span>.<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Southern Tropical&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ELSE</span> <span style="color:#e6db74">&#39;Southern Temperate&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">END</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> avg_temperature <span style="color:#66d9ef">DESC</span>;
</span></span></code></pre></div><h2 id="step-5-export-and-visualize-results">Step 5: Export and Visualize Results</h2>
<h3 id="51-save-query-results">5.1 Save Query Results</h3>
<ol>
<li>Run any query in Athena</li>
<li>Click <strong>Download</strong> to save results as CSV</li>
<li>Results are also automatically saved to your S3 query results bucket</li>
</ol>
<h3 id="52-create-simple-visualizations">5.2 Create Simple Visualizations</h3>
<p>You can use the exported CSV files to create charts in:</p>
<ul>
<li><strong>Excel or Google Sheets</strong> for basic charts</li>
<li><strong>Python/Jupyter</strong> for advanced analysis</li>
<li><strong>QuickSight</strong> (covered in next module)</li>
</ul>
<h3 id="53-example-analysis-workflow">5.3 Example Analysis Workflow</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Create a comprehensive weather report
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>  city_name,
</span></span><span style="display:flex;"><span>  country,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> total_measurements,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(temperature_celsius), <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">as</span> avg_temp_c,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">MIN</span>(temperature_celsius), <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">as</span> min_temp_c,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">MAX</span>(temperature_celsius), <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">as</span> max_temp_c,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(humidity_percent), <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">as</span> avg_humidity,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(pressure_hpa), <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">as</span> avg_pressure,
</span></span><span style="display:flex;"><span>  ROUND(<span style="color:#66d9ef">AVG</span>(wind_speed_kmh), <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">as</span> avg_wind_kmh,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MODE</span>() WITHIN <span style="color:#66d9ef">GROUP</span> (<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> weather_main) <span style="color:#66d9ef">as</span> most_common_weather,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">MODE</span>() WITHIN <span style="color:#66d9ef">GROUP</span> (<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> comfort_level) <span style="color:#66d9ef">as</span> most_common_comfort
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> city_name, country
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">5</span>  <span style="color:#75715e">-- Only cities with at least 5 measurements
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> avg_temp_c <span style="color:#66d9ef">DESC</span>;
</span></span></code></pre></div><h2 id="step-6-performance-optimization">Step 6: Performance Optimization</h2>
<h3 id="61-query-performance-tips">6.1 Query Performance Tips</h3>
<ol>
<li><strong>Use LIMIT</strong> for exploratory queries:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> data_collection_date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2025-01-15&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">100</span>;
</span></span></code></pre></div><ol start="2">
<li><strong>Filter on partition columns</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Good - filters on partitioned column
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> weather_analytics.current_weather
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> data_collection_date <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;2025-01-01&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;2025-01-07&#39;</span>;
</span></span></code></pre></div><ol start="3">
<li><strong>Select only needed columns</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Better performance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> city_name, temperature_celsius, humidity_percent
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> weather_analytics.current_weather;
</span></span></code></pre></div><h3 id="62-cost-optimization">6.2 Cost Optimization</h3>
<p>Monitor your Athena usage:</p>
<ol>
<li>Check <strong>CloudWatch metrics</strong> for data scanned</li>
<li>Use <strong>Athena Query History</strong> to analyze costs</li>
<li>Consider converting to <strong>Parquet format</strong> for large datasets</li>
</ol>
<h2 id="troubleshooting-common-issues">Troubleshooting Common Issues</h2>
<h3 id="issue-1-table-not-found-error">Issue 1: &ldquo;Table not found&rdquo; Error</h3>
<ul>
<li>Verify your S3 bucket permissions</li>
<li>Check that data exists in the specified S3 location</li>
<li>Ensure proper table schema matches your data</li>
</ul>
<h3 id="issue-2-zero-records-returned">Issue 2: &ldquo;Zero records returned&rdquo;</h3>
<ul>
<li>Verify data format matches table schema</li>
<li>Check S3 path in table definition</li>
<li>Ensure files are in JSON format as expected</li>
</ul>
<h3 id="issue-3-access-denied-error">Issue 3: &ldquo;Access denied&rdquo; Error</h3>
<ul>
<li>Check IAM permissions for Athena and S3</li>
<li>Verify query results bucket permissions</li>
</ul>
<h2 id="cost-analysis">Cost Analysis</h2>
<p>Typical costs for this module:</p>
<ul>
<li><strong>Athena queries</strong>: ~$5 per TB of data scanned</li>
<li><strong>S3 storage</strong>: ~$0.023 per GB/month</li>
<li><strong>S3 requests</strong>: ~$0.0004 per 1,000 requests</li>
</ul>
<p>For a typical weather dataset (1-10 MB), expect less than $0.50 total cost.</p>
<h2 id="next-steps">Next Steps</h2>
<p>After completing this module, you&rsquo;ll be able to analyze your weather data using SQL queries in Athena. In the next module, we&rsquo;ll build on this foundation to create interactive dashboards using Amazon QuickSight.</p>

<div class="notices tip" ><p>When writing Athena queries, always try to limit the amount of data scanned by using appropriate WHERE clauses on date fields and other frequently filtered columns.</p>
</div>


<div class="notices info" ><p>Save your useful queries as <strong>Saved Queries</strong> in Athena for reuse. You can also create <strong>Views</strong> for commonly used complex queries.</p>
</div>


<div class="notices warning" ><p>Remember to replace placeholder bucket names with your actual S3 bucket names in all SQL queries.</p>
</div>






<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/3-serverless-processing-lambda/" title="Data Processing and Transformation"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/5-analytics-visualization/" title="Data Visualization with QuickSight" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1752217735"></script>
    <script src="/js/perfect-scrollbar.min.js?1752217735"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1752217735"></script>
    <script src="/js/jquery.sticky.js?1752217735"></script>
    <script src="/js/featherlight.min.js?1752217735"></script>
    <script src="/js/highlight.pack.js?1752217735"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1752217735"></script>
    <script src="/js/learn.js?1752217735"></script>
    <script src="/js/hugo-learn.js?1752217735"></script>

    <link href="/mermaid/mermaid.css?1752217735" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1752217735"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
