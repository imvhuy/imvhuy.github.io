<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.147.8">
    <meta name="description" content="Build a complete weather data ETL pipeline using AWS Lambda, S3, Athena, and QuickSight">
<meta name="author" content="Dang Van Huy">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Testing and Monitoring Weather Collection :: Weather ETL Pipeline with AWS</title>

    
    <link href="/css/nucleus.css?1751594757" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1751594757" rel="stylesheet">
    <link href="/css/hybrid.css?1751594757" rel="stylesheet">
    <link href="/css/featherlight.min.css?1751594757" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1751594757" rel="stylesheet">
    <link href="/css/auto-complete.css?1751594757" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1751594757" rel="stylesheet">
    <link href="/css/theme.css?1751594757" rel="stylesheet">
    <link href="/css/hugo-theme.css?1751594757" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1751594757" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1751594757"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/2-data-collection-openweathermap/2.4-testing-monitoring/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1751594757"></script>
<script type="text/javascript" src="/js/auto-complete.js?1751594757"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1751594757"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduction/" title="Introduction &amp; Architecture Design" class="dd-item 
        
        
        
        ">
      <a href="/1-introduction/">
          <b>1. </b>Introduction &amp; Architecture Design
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/" title="Weather Data Collection with Lambda" class="dd-item 
        parent
        
        
        ">
      <a href="/2-data-collection-openweathermap/">
          <b>2. </b>Weather Data Collection with Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.2-lambda-weather-collector/" title="Building Lambda Weather Collector" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/2.2-lambda-weather-collector/">
          Building Lambda Weather Collector
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.1-openweathermap-setup/" title="OpenWeatherMap API Setup" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/2.1-openweathermap-setup/">
          OpenWeatherMap API Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.3-automated-scheduling/" title="Automated Scheduling with CloudWatch Events" class="dd-item 
        
        
        
        ">
      <a href="/2-data-collection-openweathermap/2.3-automated-scheduling/">
          Automated Scheduling with CloudWatch Events
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-data-collection-openweathermap/2.4-testing-monitoring/" title="Testing and Monitoring Weather Collection" class="dd-item 
        
        active
        
        ">
      <a href="/2-data-collection-openweathermap/2.4-testing-monitoring/">
          Testing and Monitoring Weather Collection
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/2-data-collection-openweathermap/2.4-testing-monitoring/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
     
    
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>23-06-2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Author </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/imvhuy/"  style="color:orange">Đặng Văn Huy</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Building ETL Data Pipeline for Weather Analytics on AWS</a> > <a href='/2-data-collection-openweathermap/'>Weather Data Collection with Lambda</a> > Testing and Monitoring Weather Collection
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#testing-strategy-overview">Testing Strategy Overview</a></li>
    <li><a href="#step-1-manual-function-testing">Step 1: Manual Function Testing</a>
      <ul>
        <li><a href="#11-test-current-weather-function">1.1 Test Current Weather Function</a></li>
        <li><a href="#12-test-weather-forecast-function">1.2 Test Weather Forecast Function</a></li>
      </ul>
    </li>
    <li><a href="#step-2-data-quality-validation">Step 2: Data Quality Validation</a>
      <ul>
        <li><a href="#21-s3-data-structure-verification">2.1 S3 Data Structure Verification</a></li>
        <li><a href="#22-data-quality-validation-script">2.2 Data Quality Validation Script</a></li>
      </ul>
    </li>
    <li><a href="#step-3-performance-testing">Step 3: Performance Testing</a>
      <ul>
        <li><a href="#31-lambda-performance-analysis">3.1 Lambda Performance Analysis</a></li>
        <li><a href="#32-api-usage-tracking">3.2 API Usage Tracking</a></li>
      </ul>
    </li>
    <li><a href="#step-4-error-scenario-testing">Step 4: Error Scenario Testing</a>
      <ul>
        <li><a href="#41-test-api-key-failure">4.1 Test API Key Failure</a></li>
        <li><a href="#42-test-network-failure-simulation">4.2 Test Network Failure Simulation</a></li>
      </ul>
    </li>
    <li><a href="#step-5-comprehensive-monitoring-setup">Step 5: Comprehensive Monitoring Setup</a>
      <ul>
        <li><a href="#51-create-cloudwatch-dashboard">5.1 Create CloudWatch Dashboard</a></li>
        <li><a href="#52-set-up-automated-testing">5.2 Set Up Automated Testing</a></li>
      </ul>
    </li>
    <li><a href="#step-6-cost-monitoring">Step 6: Cost Monitoring</a>
      <ul>
        <li><a href="#61-daily-cost-tracking">6.1 Daily Cost Tracking</a></li>
      </ul>
    </li>
    <li><a href="#step-7-testing-results-summary">Step 7: Testing Results Summary</a>
      <ul>
        <li><a href="#expected-test-results">Expected Test Results</a></li>
        <li><a href="#troubleshooting-common-issues">Troubleshooting Common Issues</a></li>
      </ul>
    </li>
    <li><a href="#next-steps">Next Steps</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Testing and Monitoring Weather Collection
            </h1>
          

        



	<h1 id="testing-and-monitoring-weather-collection">Testing and Monitoring Weather Collection</h1>
<p>Now that we have our Lambda functions and automated scheduling configured, it&rsquo;s time to thoroughly test the weather collection pipeline and set up comprehensive monitoring. We&rsquo;ll validate data quality, performance, and ensure the system runs reliably.</p>
<h2 id="testing-strategy-overview">Testing Strategy Overview</h2>
<p>We&rsquo;ll test our weather collection system using:</p>
<ol>
<li><strong>Manual Function Testing</strong> - Direct Lambda invocation</li>
<li><strong>Scheduled Execution Testing</strong> - CloudWatch Events validation</li>
<li><strong>Data Quality Validation</strong> - S3 data verification</li>
<li><strong>Performance Testing</strong> - Load and timing analysis</li>
<li><strong>Error Scenario Testing</strong> - Failure handling validation</li>
</ol>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
    A[Manual Tests] --&gt; B[Lambda Functions]
    C[Scheduled Tests] --&gt; D[CloudWatch Events]
    E[Data Quality Tests] --&gt; F[S3 Storage]
    G[Performance Tests] --&gt; H[CloudWatch Metrics]
    I[Error Tests] --&gt; J[Error Handling]

    style B fill:#ff9900,stroke:#232f3e,stroke-width:3px
    style F fill:#f3e5f5
    style H fill:#e8f5e8
</code></pre><h2 id="step-1-manual-function-testing">Step 1: Manual Function Testing</h2>
<h3 id="11-test-current-weather-function">1.1 Test Current Weather Function</h3>
<ol>
<li>
<p><strong>Navigate to Lambda Console</strong></p>
<ul>
<li>AWS Console → Lambda → Functions</li>
<li>Click <code>weather-current-collector</code></li>
</ul>
</li>
<li>
<p><strong>Create Test Event</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;manual-test&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail-type&#34;</span>: <span style="color:#e6db74">&#34;Manual Test Event&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;test_mode&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cities_to_test&#34;</span>: [<span style="color:#e6db74">&#34;Ho Chi Minh City&#34;</span>, <span style="color:#e6db74">&#34;Singapore&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p><strong>Run Test</strong></p>
<ul>
<li>Click &ldquo;Test&rdquo; button</li>
<li>Wait for execution completion</li>
<li>Review execution results</li>
</ul>
</li>
</ol>
<p><strong>Expected Response:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;statusCode&#34;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;body&#34;</span>: <span style="color:#e6db74">&#34;{\&#34;message\&#34;: \&#34;Weather collection completed\&#34;, \&#34;successful_collections\&#34;: 6, \&#34;failed_collections\&#34;: 0, \&#34;results\&#34;: [...]}&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="12-test-weather-forecast-function">1.2 Test Weather Forecast Function</h3>
<ol>
<li>
<p><strong>Navigate to forecast function</strong></p>
<ul>
<li>Click <code>weather-forecast-collector</code></li>
</ul>
</li>
<li>
<p><strong>Create Test Event</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;manual-test&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail-type&#34;</span>: <span style="color:#e6db74">&#34;Manual Test Event&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;test_mode&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;include_extended_forecast&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p><strong>Verify Test Results</strong></p>
<ul>
<li>Check execution logs in CloudWatch</li>
<li>Verify S3 objects are created</li>
<li>Validate JSON structure</li>
</ul>
</li>
</ol>
<h2 id="step-2-data-quality-validation">Step 2: Data Quality Validation</h2>
<h3 id="21-s3-data-structure-verification">2.1 S3 Data Structure Verification</h3>
<p><strong>Check S3 Bucket Structure:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws s3 ls s3://weather-data-lake-123456789012/ --recursive
</span></span></code></pre></div><p><strong>Expected Structure:</strong></p>
<pre tabindex="0"><code>weather-data-lake-123456789012/
├── raw/
│   ├── current-weather/
│   │   └── year=2025/month=01/day=03/hour=14/
│   │       ├── ho_chi_minh_city_20250103_140532.json
│   │       ├── hanoi_20250103_140534.json
│   │       ├── singapore_20250103_140536.json
│   │       ├── bangkok_20250103_140538.json
│   │       ├── jakarta_20250103_140540.json
│   │       └── kuala_lumpur_20250103_140542.json
│   └── forecast/
│       └── year=2025/month=01/day=03/
│           ├── ho_chi_minh_city_20250103_140612.json
│           └── ...
</code></pre><h3 id="22-data-quality-validation-script">2.2 Data Quality Validation Script</h3>
<p><strong>File: <code>validate_weather_data.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Optional
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)
</span></span><span style="display:flex;"><span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WeatherDataValidator</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, bucket_name: str):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bucket_name <span style="color:#f92672">=</span> bucket_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_recent_files</span>(self, data_type: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;current-weather&#39;</span>, hours_back: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">-&gt;</span> List[str]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Get weather data files from the last N hours.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        files <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        now <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> hour_offset <span style="color:#f92672">in</span> range(hours_back):
</span></span><span style="display:flex;"><span>            check_time <span style="color:#f92672">=</span> now <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span>hour_offset)
</span></span><span style="display:flex;"><span>            prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;raw/</span><span style="color:#e6db74">{</span>data_type<span style="color:#e6db74">}</span><span style="color:#e6db74">/year=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>year<span style="color:#e6db74">}</span><span style="color:#e6db74">/month=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>month<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/day=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>day<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> data_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;current-weather&#39;</span>:
</span></span><span style="display:flex;"><span>                prefix <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;hour=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>hour<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>s3<span style="color:#f92672">.</span>list_objects_v2(
</span></span><span style="display:flex;"><span>                    Bucket<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bucket_name,
</span></span><span style="display:flex;"><span>                    Prefix<span style="color:#f92672">=</span>prefix
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> obj <span style="color:#f92672">in</span> response<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Contents&#39;</span>, []):
</span></span><span style="display:flex;"><span>                    files<span style="color:#f92672">.</span>append(obj[<span style="color:#e6db74">&#39;Key&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Could not list objects for </span><span style="color:#e6db74">{</span>prefix<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> files
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate_current_weather_file</span>(self, file_key: str) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Validate a current weather data file.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>s3<span style="color:#f92672">.</span>get_object(Bucket<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bucket_name, Key<span style="color:#f92672">=</span>file_key)
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response[<span style="color:#e6db74">&#39;Body&#39;</span>]<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            validation_results <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;file_key&#39;</span>: file_key,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid&#39;</span>: <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;errors&#39;</span>: [],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Required fields validation</span>
</span></span><span style="display:flex;"><span>            required_fields <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;coord&#39;</span>, <span style="color:#e6db74">&#39;weather&#39;</span>, <span style="color:#e6db74">&#39;main&#39;</span>, <span style="color:#e6db74">&#39;wind&#39;</span>, <span style="color:#e6db74">&#39;clouds&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;dt&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>, <span style="color:#e6db74">&#39;timezone&#39;</span>, <span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;cod&#39;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> field <span style="color:#f92672">in</span> required_fields:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> field <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;errors&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Missing required field: </span><span style="color:#e6db74">{</span>field<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;valid&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Temperature validation</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;main&#39;</span> <span style="color:#f92672">in</span> data <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;temp&#39;</span> <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#39;main&#39;</span>]:
</span></span><span style="display:flex;"><span>                temp <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;main&#39;</span>][<span style="color:#e6db74">&#39;temp&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">50</span> <span style="color:#f92672">&lt;=</span> temp <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">60</span>):  <span style="color:#75715e"># Reasonable temperature range in Celsius</span>
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;warnings&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Temperature seems unusual: </span><span style="color:#e6db74">{</span>temp<span style="color:#e6db74">}</span><span style="color:#e6db74">°C&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Humidity validation</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;main&#39;</span> <span style="color:#f92672">in</span> data <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;humidity&#39;</span> <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#39;main&#39;</span>]:
</span></span><span style="display:flex;"><span>                humidity <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;main&#39;</span>][<span style="color:#e6db74">&#39;humidity&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> (<span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> humidity <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;errors&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid humidity value: </span><span style="color:#e6db74">{</span>humidity<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;valid&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Collection metadata validation</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;collection_metadata&#39;</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                metadata <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;collection_metadata&#39;</span>]
</span></span><span style="display:flex;"><span>                required_metadata <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;collection_time&#39;</span>, <span style="color:#e6db74">&#39;data_source&#39;</span>, <span style="color:#e6db74">&#39;api_version&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> field <span style="color:#f92672">in</span> required_metadata:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> field <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> metadata:
</span></span><span style="display:flex;"><span>                        validation_results[<span style="color:#e6db74">&#39;warnings&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Missing metadata field: </span><span style="color:#e6db74">{</span>field<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                validation_results[<span style="color:#e6db74">&#39;warnings&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;Missing collection_metadata&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Data freshness check</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;dt&#39;</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                data_timestamp <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>fromtimestamp(data[<span style="color:#e6db74">&#39;dt&#39;</span>])
</span></span><span style="display:flex;"><span>                age_hours <span style="color:#f92672">=</span> (datetime<span style="color:#f92672">.</span>utcnow() <span style="color:#f92672">-</span> data_timestamp)<span style="color:#f92672">.</span>total_seconds() <span style="color:#f92672">/</span> <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> age_hours <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>:  <span style="color:#75715e"># Data older than 2 hours</span>
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;warnings&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Data is </span><span style="color:#e6db74">{</span>age_hours<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> hours old&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> validation_results
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;file_key&#39;</span>: file_key,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid&#39;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;errors&#39;</span>: [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Failed to parse file: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate_forecast_file</span>(self, file_key: str) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Validate a forecast data file.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>s3<span style="color:#f92672">.</span>get_object(Bucket<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bucket_name, Key<span style="color:#f92672">=</span>file_key)
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response[<span style="color:#e6db74">&#39;Body&#39;</span>]<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            validation_results <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;file_key&#39;</span>: file_key,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid&#39;</span>: <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;errors&#39;</span>: [],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Required fields for forecast</span>
</span></span><span style="display:flex;"><span>            required_fields <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;cod&#39;</span>, <span style="color:#e6db74">&#39;message&#39;</span>, <span style="color:#e6db74">&#39;cnt&#39;</span>, <span style="color:#e6db74">&#39;list&#39;</span>, <span style="color:#e6db74">&#39;city&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> field <span style="color:#f92672">in</span> required_fields:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> field <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;errors&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Missing required field: </span><span style="color:#e6db74">{</span>field<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;valid&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Validate forecast list</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;list&#39;</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                forecast_list <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;list&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> len(forecast_list) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;errors&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;Empty forecast list&#34;</span>)
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;valid&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Check first few forecast items</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> i, forecast_item <span style="color:#f92672">in</span> enumerate(forecast_list[:<span style="color:#ae81ff">3</span>]):
</span></span><span style="display:flex;"><span>                    required_item_fields <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;dt&#39;</span>, <span style="color:#e6db74">&#39;main&#39;</span>, <span style="color:#e6db74">&#39;weather&#39;</span>, <span style="color:#e6db74">&#39;wind&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> field <span style="color:#f92672">in</span> required_item_fields:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> field <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> forecast_item:
</span></span><span style="display:flex;"><span>                            validation_results[<span style="color:#e6db74">&#39;errors&#39;</span>]<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Forecast item </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74"> missing field: </span><span style="color:#e6db74">{</span>field<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                            )
</span></span><span style="display:flex;"><span>                            validation_results[<span style="color:#e6db74">&#39;valid&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> validation_results
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;file_key&#39;</span>: file_key,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid&#39;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;errors&#39;</span>: [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Failed to parse file: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_validation_report</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Generate comprehensive validation report.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        report <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;timestamp&#39;</span>: datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;current_weather&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;files_checked&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;invalid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;total_errors&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;total_warnings&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;details&#39;</span>: []
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;forecast&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;files_checked&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;invalid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;total_errors&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;total_warnings&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;details&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Validate current weather files</span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Validating current weather files...&#34;</span>)
</span></span><span style="display:flex;"><span>        current_files <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_recent_files(<span style="color:#e6db74">&#39;current-weather&#39;</span>, <span style="color:#ae81ff">6</span>)  <span style="color:#75715e"># Last 6 hours</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> file_key <span style="color:#f92672">in</span> current_files:
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>validate_current_weather_file(file_key)
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;files_checked&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;details&#39;</span>]<span style="color:#f92672">.</span>append(result)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;valid&#39;</span>]:
</span></span><span style="display:flex;"><span>                report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;valid_files&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;invalid_files&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;total_errors&#39;</span>] <span style="color:#f92672">+=</span> len(result[<span style="color:#e6db74">&#39;errors&#39;</span>])
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;total_warnings&#39;</span>] <span style="color:#f92672">+=</span> len(result[<span style="color:#e6db74">&#39;warnings&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Validate forecast files</span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Validating forecast files...&#34;</span>)
</span></span><span style="display:flex;"><span>        forecast_files <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_recent_files(<span style="color:#e6db74">&#39;forecast&#39;</span>, <span style="color:#ae81ff">24</span>)  <span style="color:#75715e"># Last 24 hours</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> file_key <span style="color:#f92672">in</span> forecast_files:
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>validate_forecast_file(file_key)
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;files_checked&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;details&#39;</span>]<span style="color:#f92672">.</span>append(result)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;valid&#39;</span>]:
</span></span><span style="display:flex;"><span>                report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;valid_files&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;invalid_files&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;total_errors&#39;</span>] <span style="color:#f92672">+=</span> len(result[<span style="color:#e6db74">&#39;errors&#39;</span>])
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;total_warnings&#39;</span>] <span style="color:#f92672">+=</span> len(result[<span style="color:#e6db74">&#39;warnings&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> report
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Initialize validator</span>
</span></span><span style="display:flex;"><span>    validator <span style="color:#f92672">=</span> WeatherDataValidator(<span style="color:#e6db74">&#39;weather-data-lake-123456789012&#39;</span>)  <span style="color:#75715e"># Replace with your bucket</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate validation report</span>
</span></span><span style="display:flex;"><span>    report <span style="color:#f92672">=</span> validator<span style="color:#f92672">.</span>generate_validation_report()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Print summary</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;WEATHER DATA VALIDATION REPORT&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Report Generated: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;timestamp&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;CURRENT WEATHER DATA:&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Files Checked: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;files_checked&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Valid Files: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;valid_files&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Invalid Files: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;invalid_files&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Total Errors: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;total_errors&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Total Warnings: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;total_warnings&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">FORECAST DATA:&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Files Checked: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;files_checked&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Valid Files: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;valid_files&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Invalid Files: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;invalid_files&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Total Errors: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;total_errors&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Total Warnings: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;total_warnings&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Show first few errors/warnings</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">DETAILED ISSUES:&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> data_type <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;current_weather&#39;</span>, <span style="color:#e6db74">&#39;forecast&#39;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> detail <span style="color:#f92672">in</span> report[data_type][<span style="color:#e6db74">&#39;details&#39;</span>][:<span style="color:#ae81ff">3</span>]:  <span style="color:#75715e"># Show first 3</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> detail[<span style="color:#e6db74">&#39;errors&#39;</span>] <span style="color:#f92672">or</span> detail[<span style="color:#e6db74">&#39;warnings&#39;</span>]:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">File: </span><span style="color:#e6db74">{</span>detail[<span style="color:#e6db74">&#39;file_key&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> error <span style="color:#f92672">in</span> detail[<span style="color:#e6db74">&#39;errors&#39;</span>]:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  ERROR: </span><span style="color:#e6db74">{</span>error<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> warning <span style="color:#f92672">in</span> detail[<span style="color:#e6db74">&#39;warnings&#39;</span>]:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  WARNING: </span><span style="color:#e6db74">{</span>warning<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><h2 id="step-3-performance-testing">Step 3: Performance Testing</h2>
<h3 id="31-lambda-performance-analysis">3.1 Lambda Performance Analysis</h3>
<p><strong>Create Performance Monitoring Script: <code>monitor_lambda_performance.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LambdaPerformanceMonitor</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, region: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;us-east-1&#39;</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cloudwatch <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cloudwatch&#39;</span>, region_name<span style="color:#f92672">=</span>region)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>lambda_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;lambda&#39;</span>, region_name<span style="color:#f92672">=</span>region)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_lambda_metrics</span>(self, function_name: str, hours_back: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">-&gt;</span> pd<span style="color:#f92672">.</span>DataFrame:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Get Lambda performance metrics.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        end_time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>        start_time <span style="color:#f92672">=</span> end_time <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span>hours_back)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        metrics <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Duration&#39;</span>, <span style="color:#e6db74">&#39;Errors&#39;</span>, <span style="color:#e6db74">&#39;Invocations&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Throttles&#39;</span>, <span style="color:#e6db74">&#39;ConcurrentExecutions&#39;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        all_data <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> metric <span style="color:#f92672">in</span> metrics:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>                    Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;AWS/Lambda&#39;</span>,
</span></span><span style="display:flex;"><span>                    MetricName<span style="color:#f92672">=</span>metric,
</span></span><span style="display:flex;"><span>                    Dimensions<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;FunctionName&#39;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#39;Value&#39;</span>: function_name
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    ],
</span></span><span style="display:flex;"><span>                    StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>                    EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>                    Period<span style="color:#f92672">=</span><span style="color:#ae81ff">3600</span>,  <span style="color:#75715e"># 1 hour periods</span>
</span></span><span style="display:flex;"><span>                    Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Average&#39;</span>, <span style="color:#e6db74">&#39;Maximum&#39;</span>, <span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> datapoint <span style="color:#f92672">in</span> response<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Datapoints&#39;</span>, []):
</span></span><span style="display:flex;"><span>                    all_data<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Timestamp&#39;</span>: datapoint[<span style="color:#e6db74">&#39;Timestamp&#39;</span>],
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;MetricName&#39;</span>: metric,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Average&#39;</span>: datapoint<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Average&#39;</span>, <span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Maximum&#39;</span>: datapoint<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Maximum&#39;</span>, <span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Sum&#39;</span>: datapoint<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Sum&#39;</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error getting metric </span><span style="color:#e6db74">{</span>metric<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> pd<span style="color:#f92672">.</span>DataFrame(all_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">analyze_performance</span>(self, function_name: str) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Analyze Lambda function performance.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        df <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_lambda_metrics(function_name, <span style="color:#ae81ff">24</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> df<span style="color:#f92672">.</span>empty:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;error&#39;</span>: <span style="color:#e6db74">&#39;No metrics data available&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        analysis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;function_name&#39;</span>: function_name,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;analysis_time&#39;</span>: datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;metrics&#39;</span>: {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Duration analysis</span>
</span></span><span style="display:flex;"><span>        duration_data <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;MetricName&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Duration&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> duration_data<span style="color:#f92672">.</span>empty:
</span></span><span style="display:flex;"><span>            analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>][<span style="color:#e6db74">&#39;duration&#39;</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;avg_duration_ms&#39;</span>: duration_data[<span style="color:#e6db74">&#39;Average&#39;</span>]<span style="color:#f92672">.</span>mean(),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_duration_ms&#39;</span>: duration_data[<span style="color:#e6db74">&#39;Maximum&#39;</span>]<span style="color:#f92672">.</span>max(),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;performance_trend&#39;</span>: <span style="color:#e6db74">&#39;stable&#39;</span> <span style="color:#66d9ef">if</span> duration_data[<span style="color:#e6db74">&#39;Average&#39;</span>]<span style="color:#f92672">.</span>std() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1000</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;variable&#39;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Error analysis</span>
</span></span><span style="display:flex;"><span>        error_data <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;MetricName&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Errors&#39;</span>]
</span></span><span style="display:flex;"><span>        total_errors <span style="color:#f92672">=</span> error_data[<span style="color:#e6db74">&#39;Sum&#39;</span>]<span style="color:#f92672">.</span>sum() <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> error_data<span style="color:#f92672">.</span>empty <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        invocation_data <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;MetricName&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Invocations&#39;</span>]
</span></span><span style="display:flex;"><span>        total_invocations <span style="color:#f92672">=</span> invocation_data[<span style="color:#e6db74">&#39;Sum&#39;</span>]<span style="color:#f92672">.</span>sum() <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> invocation_data<span style="color:#f92672">.</span>empty <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        error_rate <span style="color:#f92672">=</span> (total_errors <span style="color:#f92672">/</span> total_invocations <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">if</span> total_invocations <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>][<span style="color:#e6db74">&#39;reliability&#39;</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;total_invocations&#39;</span>: total_invocations,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;total_errors&#39;</span>: total_errors,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;error_rate_percent&#39;</span>: error_rate,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;reliability_status&#39;</span>: <span style="color:#e6db74">&#39;good&#39;</span> <span style="color:#66d9ef">if</span> error_rate <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;needs_attention&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Throttling analysis</span>
</span></span><span style="display:flex;"><span>        throttle_data <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;MetricName&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Throttles&#39;</span>]
</span></span><span style="display:flex;"><span>        total_throttles <span style="color:#f92672">=</span> throttle_data[<span style="color:#e6db74">&#39;Sum&#39;</span>]<span style="color:#f92672">.</span>sum() <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> throttle_data<span style="color:#f92672">.</span>empty <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>][<span style="color:#e6db74">&#39;scaling&#39;</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;total_throttles&#39;</span>: total_throttles,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;throttling_status&#39;</span>: <span style="color:#e6db74">&#39;none&#39;</span> <span style="color:#66d9ef">if</span> total_throttles <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;occurring&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> analysis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_lambda_performance</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Run performance tests on weather collection functions.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    monitor <span style="color:#f92672">=</span> LambdaPerformanceMonitor()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    functions <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;weather-current-collector&#39;</span>, <span style="color:#e6db74">&#39;weather-forecast-collector&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;LAMBDA PERFORMANCE ANALYSIS&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> function_name <span style="color:#f92672">in</span> functions:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Analyzing: </span><span style="color:#e6db74">{</span>function_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        analysis <span style="color:#f92672">=</span> monitor<span style="color:#f92672">.</span>analyze_performance(function_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;error&#39;</span> <span style="color:#f92672">in</span> analysis:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Error: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;error&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Duration metrics</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;duration&#39;</span> <span style="color:#f92672">in</span> analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>]:
</span></span><span style="display:flex;"><span>            duration <span style="color:#f92672">=</span> analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>][<span style="color:#e6db74">&#39;duration&#39;</span>]
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Average Duration: </span><span style="color:#e6db74">{</span>duration[<span style="color:#e6db74">&#39;avg_duration_ms&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.0f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Max Duration: </span><span style="color:#e6db74">{</span>duration[<span style="color:#e6db74">&#39;max_duration_ms&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.0f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Performance: </span><span style="color:#e6db74">{</span>duration[<span style="color:#e6db74">&#39;performance_trend&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Reliability metrics</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;reliability&#39;</span> <span style="color:#f92672">in</span> analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>]:
</span></span><span style="display:flex;"><span>            reliability <span style="color:#f92672">=</span> analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>][<span style="color:#e6db74">&#39;reliability&#39;</span>]
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Total Invocations: </span><span style="color:#e6db74">{</span>reliability[<span style="color:#e6db74">&#39;total_invocations&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Error Rate: </span><span style="color:#e6db74">{</span>reliability[<span style="color:#e6db74">&#39;error_rate_percent&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Status: </span><span style="color:#e6db74">{</span>reliability[<span style="color:#e6db74">&#39;reliability_status&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Scaling metrics</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;scaling&#39;</span> <span style="color:#f92672">in</span> analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>]:
</span></span><span style="display:flex;"><span>            scaling <span style="color:#f92672">=</span> analysis[<span style="color:#e6db74">&#39;metrics&#39;</span>][<span style="color:#e6db74">&#39;scaling&#39;</span>]
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Throttles: </span><span style="color:#e6db74">{</span>scaling[<span style="color:#e6db74">&#39;total_throttles&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Scaling Status: </span><span style="color:#e6db74">{</span>scaling[<span style="color:#e6db74">&#39;throttling_status&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    test_lambda_performance()
</span></span></code></pre></div><h3 id="32-api-usage-tracking">3.2 API Usage Tracking</h3>
<p><strong>Create API monitoring script: <code>track_api_usage.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_api_usage_limits</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Monitor OpenWeatherMap API usage against limits.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    cloudwatch <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cloudwatch&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get API usage for last 24 hours</span>
</span></span><span style="display:flex;"><span>    end_time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> end_time <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">24</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>            Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Weather/APIUsage&#39;</span>,
</span></span><span style="display:flex;"><span>            MetricName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;APICalls&#39;</span>,
</span></span><span style="display:flex;"><span>            Dimensions<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;Provider&#39;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;OpenWeatherMap&#39;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>            EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>            Period<span style="color:#f92672">=</span><span style="color:#ae81ff">86400</span>,  <span style="color:#75715e"># Daily period</span>
</span></span><span style="display:flex;"><span>            Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        daily_usage <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>]:
</span></span><span style="display:flex;"><span>            daily_usage <span style="color:#f92672">=</span> response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># OpenWeatherMap free tier: 1000 calls/day</span>
</span></span><span style="display:flex;"><span>        usage_percentage <span style="color:#f92672">=</span> (daily_usage <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;API USAGE MONITORING&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;24-hour API calls: </span><span style="color:#e6db74">{</span>daily_usage<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Daily limit: 1,000&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Usage: </span><span style="color:#e6db74">{</span>usage_percentage<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> usage_percentage <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">80</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;⚠️  WARNING: Approaching daily limit!&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> usage_percentage <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">95</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;🚨 CRITICAL: Very close to daily limit!&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;✅ Usage within safe limits&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Calculate hourly rate</span>
</span></span><span style="display:flex;"><span>        hourly_rate <span style="color:#f92672">=</span> daily_usage <span style="color:#f92672">/</span> <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>        projected_daily <span style="color:#f92672">=</span> hourly_rate <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Projected daily usage: </span><span style="color:#e6db74">{</span>projected_daily<span style="color:#e6db74">:</span><span style="color:#e6db74">.0f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> calls&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Average hourly rate: </span><span style="color:#e6db74">{</span>hourly_rate<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> calls/hour&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;daily_usage&#39;</span>: daily_usage,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;usage_percentage&#39;</span>: usage_percentage,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;hourly_rate&#39;</span>: hourly_rate
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error checking API usage: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    check_api_usage_limits()
</span></span></code></pre></div><h2 id="step-4-error-scenario-testing">Step 4: Error Scenario Testing</h2>
<h3 id="41-test-api-key-failure">4.1 Test API Key Failure</h3>
<p><strong>Create test with invalid API key:</strong></p>
<ol>
<li>
<p><strong>Temporarily modify API key in Parameter Store</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ssm put-parameter <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name <span style="color:#e6db74">&#34;/weather-etl/openweathermap/api-key&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --value <span style="color:#e6db74">&#34;invalid-key-for-testing&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --type <span style="color:#e6db74">&#34;SecureString&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --overwrite
</span></span></code></pre></div></li>
<li>
<p><strong>Trigger Lambda function manually</strong></p>
</li>
<li>
<p><strong>Verify error handling and CloudWatch logs</strong></p>
</li>
<li>
<p><strong>Restore correct API key</strong></p>
</li>
</ol>
<h3 id="42-test-network-failure-simulation">4.2 Test Network Failure Simulation</h3>
<p><strong>Create network failure test script: <code>test_error_scenarios.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_lambda_error_handling</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test error handling in Lambda functions.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    lambda_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;lambda&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Test cases</span>
</span></span><span style="display:flex;"><span>    test_cases <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;API Timeout Simulation&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;payload&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;test_scenario&#39;</span>: <span style="color:#e6db74">&#39;api_timeout&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;cities&#39;</span>: [<span style="color:#e6db74">&#39;Ho Chi Minh City&#39;</span>]
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;Invalid City Test&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;payload&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;test_scenario&#39;</span>: <span style="color:#e6db74">&#39;invalid_city&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;cities&#39;</span>: [<span style="color:#e6db74">&#39;NonExistentCity&#39;</span>]
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;S3 Permission Test&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;payload&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;test_scenario&#39;</span>: <span style="color:#e6db74">&#39;s3_permission_test&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;cities&#39;</span>: [<span style="color:#e6db74">&#39;Singapore&#39;</span>]
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    functions <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;weather-current-collector&#39;</span>, <span style="color:#e6db74">&#39;weather-forecast-collector&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;ERROR SCENARIO TESTING&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">40</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> function_name <span style="color:#f92672">in</span> functions:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Testing function: </span><span style="color:#e6db74">{</span>function_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> test_case <span style="color:#f92672">in</span> test_cases:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Running: </span><span style="color:#e6db74">{</span>test_case[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                response <span style="color:#f92672">=</span> lambda_client<span style="color:#f92672">.</span>invoke(
</span></span><span style="display:flex;"><span>                    FunctionName<span style="color:#f92672">=</span>function_name,
</span></span><span style="display:flex;"><span>                    InvocationType<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RequestResponse&#39;</span>,
</span></span><span style="display:flex;"><span>                    Payload<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(test_case[<span style="color:#e6db74">&#39;payload&#39;</span>])
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                payload <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response[<span style="color:#e6db74">&#39;Payload&#39;</span>]<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>                status_code <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;statusCode&#39;</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">&#34;    ✅ Handled gracefully&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">&#34;    ⚠️  Error occurred (expected for error tests)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;    ❌ Test failed: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    test_lambda_error_handling()
</span></span></code></pre></div><h2 id="step-5-comprehensive-monitoring-setup">Step 5: Comprehensive Monitoring Setup</h2>
<h3 id="51-create-cloudwatch-dashboard">5.1 Create CloudWatch Dashboard</h3>
<p><strong>Dashboard JSON for comprehensive monitoring:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;widgets&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;metric&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>          [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;AWS/Lambda&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Invocations&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;FunctionName&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;weather-current-collector&#34;</span>
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;Errors&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;Duration&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;Invocations&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;weather-forecast-collector&#34;</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;Errors&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;Duration&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>]
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;period&#34;</span>: <span style="color:#ae81ff">3600</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;stat&#34;</span>: <span style="color:#e6db74">&#34;Sum&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;us-east-1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Lambda Function Metrics&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;metric&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>          [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Weather/ETL&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;SuccessfulCollections&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;DataType&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;CurrentWeather&#34;</span>
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;FailedCollections&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;SuccessfulCollections&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;Forecast&#34;</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;FailedCollections&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>]
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;period&#34;</span>: <span style="color:#ae81ff">3600</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;stat&#34;</span>: <span style="color:#e6db74">&#34;Sum&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;us-east-1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Collection Success Metrics&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;metric&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;Weather/APIUsage&#34;</span>, <span style="color:#e6db74">&#34;APICalls&#34;</span>, <span style="color:#e6db74">&#34;Provider&#34;</span>, <span style="color:#e6db74">&#34;OpenWeatherMap&#34;</span>]
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;period&#34;</span>: <span style="color:#ae81ff">86400</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;stat&#34;</span>: <span style="color:#e6db74">&#34;Sum&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;us-east-1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Daily API Usage&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="52-set-up-automated-testing">5.2 Set Up Automated Testing</h3>
<p><strong>Create scheduled validation function: <code>weather-data-validator</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lambda_handler</span>(event, context):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Scheduled data validation function.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># This function runs daily to validate data quality</span>
</span></span><span style="display:flex;"><span>    validator <span style="color:#f92672">=</span> WeatherDataValidator(<span style="color:#e6db74">&#39;weather-data-lake-123456789012&#39;</span>)
</span></span><span style="display:flex;"><span>    report <span style="color:#f92672">=</span> validator<span style="color:#f92672">.</span>generate_validation_report()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check for issues</span>
</span></span><span style="display:flex;"><span>    total_errors <span style="color:#f92672">=</span> (report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;total_errors&#39;</span>] <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                   report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;total_errors&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> total_errors <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send alert to SNS</span>
</span></span><span style="display:flex;"><span>        sns <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sns&#39;</span>)
</span></span><span style="display:flex;"><span>        sns<span style="color:#f92672">.</span>publish(
</span></span><span style="display:flex;"><span>            TopicArn<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;arn:aws:sns:us-east-1:123456789012:weather-collection-alerts&#39;</span>,
</span></span><span style="display:flex;"><span>            Subject<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Weather Data Quality Issues Detected&#39;</span>,
</span></span><span style="display:flex;"><span>            Message<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Data validation found </span><span style="color:#e6db74">{</span>total_errors<span style="color:#e6db74">}</span><span style="color:#e6db74"> errors. Please check the dashboard.&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Store validation report in S3</span>
</span></span><span style="display:flex;"><span>    s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>    report_key <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;validation-reports/</span><span style="color:#e6db74">{</span>datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y/%m/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">/validation-report.json&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    s3<span style="color:#f92672">.</span>put_object(
</span></span><span style="display:flex;"><span>        Bucket<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;weather-data-lake-123456789012&#39;</span>,
</span></span><span style="display:flex;"><span>        Key<span style="color:#f92672">=</span>report_key,
</span></span><span style="display:flex;"><span>        Body<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(report, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>),
</span></span><span style="display:flex;"><span>        ContentType<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;statusCode&#39;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;body&#39;</span>: json<span style="color:#f92672">.</span>dumps({
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;validation_completed&#39;</span>: <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;total_errors&#39;</span>: total_errors,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;report_location&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;s3://weather-data-lake-123456789012/</span><span style="color:#e6db74">{</span>report_key<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h2 id="step-6-cost-monitoring">Step 6: Cost Monitoring</h2>
<h3 id="61-daily-cost-tracking">6.1 Daily Cost Tracking</h3>
<p><strong>Create cost monitoring script: <code>monitor_daily_costs.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">estimate_weather_collection_costs</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Estimate daily costs for weather collection system.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get CloudWatch metrics for cost estimation</span>
</span></span><span style="display:flex;"><span>    cloudwatch <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cloudwatch&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    end_time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> end_time <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">24</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    costs <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;lambda_invocations&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;lambda_duration&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;api_calls&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;s3_storage&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;cloudwatch_metrics&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;total_estimated&#39;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Lambda invocations cost</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> function_name <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;weather-current-collector&#39;</span>, <span style="color:#e6db74">&#39;weather-forecast-collector&#39;</span>]:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>                Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;AWS/Lambda&#39;</span>,
</span></span><span style="display:flex;"><span>                MetricName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Invocations&#39;</span>,
</span></span><span style="display:flex;"><span>                Dimensions<span style="color:#f92672">=</span>[{<span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;FunctionName&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: function_name}],
</span></span><span style="display:flex;"><span>                StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>                EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>                Period<span style="color:#f92672">=</span><span style="color:#ae81ff">86400</span>,
</span></span><span style="display:flex;"><span>                Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>]:
</span></span><span style="display:flex;"><span>                invocations <span style="color:#f92672">=</span> response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>                costs[<span style="color:#e6db74">&#39;lambda_invocations&#39;</span>] <span style="color:#f92672">+=</span> invocations <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000002</span>  <span style="color:#75715e"># $0.20 per 1M requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Lambda duration cost</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> function_name <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;weather-current-collector&#39;</span>, <span style="color:#e6db74">&#39;weather-forecast-collector&#39;</span>]:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>                Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;AWS/Lambda&#39;</span>,
</span></span><span style="display:flex;"><span>                MetricName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Duration&#39;</span>,
</span></span><span style="display:flex;"><span>                Dimensions<span style="color:#f92672">=</span>[{<span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;FunctionName&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: function_name}],
</span></span><span style="display:flex;"><span>                StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>                EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>                Period<span style="color:#f92672">=</span><span style="color:#ae81ff">86400</span>,
</span></span><span style="display:flex;"><span>                Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>]:
</span></span><span style="display:flex;"><span>                total_duration_ms <span style="color:#f92672">=</span> response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>                gb_seconds <span style="color:#f92672">=</span> (total_duration_ms <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">256</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">1024</span>)  <span style="color:#75715e"># 256MB memory</span>
</span></span><span style="display:flex;"><span>                costs[<span style="color:#e6db74">&#39;lambda_duration&#39;</span>] <span style="color:#f92672">+=</span> gb_seconds <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000166667</span>  <span style="color:#75715e"># $0.0000166667 per GB-second</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Estimate S3 storage cost (approximate)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Each weather file is ~2KB, 6 cities * 24 hours = 144 files/day for current weather</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 6 cities * 4 times/day = 24 files/day for forecast</span>
</span></span><span style="display:flex;"><span>        daily_files <span style="color:#f92672">=</span> (<span style="color:#ae81ff">6</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">+</span> (<span style="color:#ae81ff">6</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span>)  <span style="color:#75715e"># 168 files</span>
</span></span><span style="display:flex;"><span>        daily_storage_gb <span style="color:#f92672">=</span> (daily_files <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024</span>)  <span style="color:#75715e"># Convert KB to GB</span>
</span></span><span style="display:flex;"><span>        costs[<span style="color:#e6db74">&#39;s3_storage&#39;</span>] <span style="color:#f92672">=</span> daily_storage_gb <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.023</span>  <span style="color:#75715e"># $0.023 per GB/month, daily portion</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># OpenWeatherMap API is free tier (up to 1000 calls/day)</span>
</span></span><span style="display:flex;"><span>        costs[<span style="color:#e6db74">&#39;api_calls&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># CloudWatch metrics cost (approximate)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Custom metrics: $0.30 per metric per month</span>
</span></span><span style="display:flex;"><span>        custom_metrics <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>  <span style="color:#75715e"># APICalls, SuccessfulCollections, FailedCollections</span>
</span></span><span style="display:flex;"><span>        costs[<span style="color:#e6db74">&#39;cloudwatch_metrics&#39;</span>] <span style="color:#f92672">=</span> (custom_metrics <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.30</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">30</span>  <span style="color:#75715e"># Daily portion</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        costs[<span style="color:#e6db74">&#39;total_estimated&#39;</span>] <span style="color:#f92672">=</span> sum(costs<span style="color:#f92672">.</span>values())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;DAILY COST ESTIMATION&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Lambda Invocations: $</span><span style="color:#e6db74">{</span>costs[<span style="color:#e6db74">&#39;lambda_invocations&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Lambda Duration: $</span><span style="color:#e6db74">{</span>costs[<span style="color:#e6db74">&#39;lambda_duration&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;S3 Storage: $</span><span style="color:#e6db74">{</span>costs[<span style="color:#e6db74">&#39;s3_storage&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;API Calls: $</span><span style="color:#e6db74">{</span>costs[<span style="color:#e6db74">&#39;api_calls&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (Free Tier)&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;CloudWatch Metrics: $</span><span style="color:#e6db74">{</span>costs[<span style="color:#e6db74">&#39;cloudwatch_metrics&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Total Daily Cost: $</span><span style="color:#e6db74">{</span>costs[<span style="color:#e6db74">&#39;total_estimated&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Monthly Projection: $</span><span style="color:#e6db74">{</span>costs[<span style="color:#e6db74">&#39;total_estimated&#39;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span><span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> costs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error calculating costs: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    estimate_weather_collection_costs()
</span></span></code></pre></div><h2 id="step-7-testing-results-summary">Step 7: Testing Results Summary</h2>
<h3 id="expected-test-results">Expected Test Results</h3>
<p><strong>✅ Successful Test Indicators:</strong></p>
<ol>
<li>
<p><strong>Lambda Functions:</strong></p>
<ul>
<li>Current weather function executes in &lt; 30 seconds</li>
<li>Forecast function executes in &lt; 45 seconds</li>
<li>Error rate &lt; 1%</li>
<li>No throttling issues</li>
</ul>
</li>
<li>
<p><strong>Data Quality:</strong></p>
<ul>
<li>All required fields present in JSON</li>
<li>Temperature values within reasonable range (-50°C to +60°C)</li>
<li>Humidity values 0-100%</li>
<li>Timestamps within expected range</li>
</ul>
</li>
<li>
<p><strong>Scheduling:</strong></p>
<ul>
<li>CloudWatch Events trigger correctly</li>
<li>Functions execute on schedule</li>
<li>No missed executions</li>
</ul>
</li>
<li>
<p><strong>Cost Efficiency:</strong></p>
<ul>
<li>Daily cost &lt; $0.10</li>
<li>Monthly projection &lt; $3.00</li>
<li>API usage &lt; 500 calls/day (50% of free tier)</li>
</ul>
</li>
</ol>
<h3 id="troubleshooting-common-issues">Troubleshooting Common Issues</h3>
<p><strong>Issue 1: Lambda Timeout</strong></p>
<ul>
<li>Increase timeout to 5 minutes</li>
<li>Check network connectivity</li>
<li>Optimize API request handling</li>
</ul>
<p><strong>Issue 2: Invalid Weather Data</strong></p>
<ul>
<li>Verify API key validity</li>
<li>Check city coordinates</li>
<li>Validate JSON parsing</li>
</ul>
<p><strong>Issue 3: S3 Permission Errors</strong></p>
<ul>
<li>Review IAM role permissions</li>
<li>Check bucket policy</li>
<li>Verify bucket exists</li>
</ul>
<p><strong>Issue 4: High API Usage</strong></p>
<ul>
<li>Reduce collection frequency</li>
<li>Implement smart caching</li>
<li>Monitor daily limits</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<p>Excellent! You now have a fully tested weather data collection system with comprehensive monitoring. The system is ready for production use.</p>

<div class="notices success" ><p><strong>Testing Completed:</strong></p>
<ul>
<li>✅ Manual function testing</li>
<li>✅ Data quality validation</li>
<li>✅ Performance monitoring</li>
<li>✅ Error scenario testing</li>
<li>✅ Cost tracking</li>
<li>✅ Automated monitoring setup</li>
</ul>
</div>


<div class="notices tip" ><p><strong>Production Monitoring:</strong></p>
<ul>
<li>Set up daily validation reports</li>
<li>Monitor API usage trends</li>
<li>Review cost projections weekly</li>
<li>Test error scenarios monthly</li>
<li>Update city lists as needed</li>
</ul>
</div>

<p>In the next module, we&rsquo;ll build serverless data processing with Lambda to transform and analyze this weather data!</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/2-data-collection-openweathermap/2.3-automated-scheduling/" title="Automated Scheduling with CloudWatch Events"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/2-data-collection-openweathermap/2.2-lambda-weather-collector/" title="Building Lambda Weather Collector" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1751594757"></script>
    <script src="/js/perfect-scrollbar.min.js?1751594757"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1751594757"></script>
    <script src="/js/jquery.sticky.js?1751594757"></script>
    <script src="/js/featherlight.min.js?1751594757"></script>
    <script src="/js/highlight.pack.js?1751594757"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1751594757"></script>
    <script src="/js/learn.js?1751594757"></script>
    <script src="/js/hugo-learn.js?1751594757"></script>

    <link href="/mermaid/mermaid.css?1751594757" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1751594757"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
