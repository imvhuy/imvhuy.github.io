<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.147.8">
    <meta name="description" content="Build a complete weather data ETL pipeline using AWS Lambda, S3, Athena, and QuickSight">
<meta name="author" content="Dang Van Huy">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Testing và Monitoring Thu thập Thời tiết :: Hệ thống ETL Dữ liệu Thời tiết với AWS</title>

    
    <link href="/css/nucleus.css?1752242330" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1752242330" rel="stylesheet">
    <link href="/css/hybrid.css?1752242330" rel="stylesheet">
    <link href="/css/featherlight.min.css?1752242330" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1752242330" rel="stylesheet">
    <link href="/css/auto-complete.css?1752242330" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1752242330" rel="stylesheet">
    <link href="/css/theme.css?1752242330" rel="stylesheet">
    <link href="/css/hugo-theme.css?1752242330" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1752242330" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1752242330"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/2-data-collection-openweathermap/2.4-testing-monitoring/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1752242330"></script>
<script type="text/javascript" src="/js/auto-complete.js?1752242330"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1752242330"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduction/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduction/">
          <b>1. </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-data-collection-openweathermap/" title="Thu thập Dữ liệu Thời tiết với OpenWeatherMap" class="dd-item 
        parent
        
        
        ">
      <a href="/vi/2-data-collection-openweathermap/">
          <b>2. </b>Thu thập Dữ liệu Thời tiết với OpenWeatherMap
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-data-collection-openweathermap/2.1-openweathermap-setup/" title="Thiết lập OpenWeatherMap API" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-data-collection-openweathermap/2.1-openweathermap-setup/">
          Thiết lập OpenWeatherMap API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-data-collection-openweathermap/2.2-lambda-weather-collector/" title="Xây dựng Lambda Weather Collector" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-data-collection-openweathermap/2.2-lambda-weather-collector/">
          Xây dựng Lambda Weather Collector
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-data-collection-openweathermap/2.3-automated-scheduling/" title="Lập lịch Tự động với CloudWatch Events" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-data-collection-openweathermap/2.3-automated-scheduling/">
          Lập lịch Tự động với CloudWatch Events
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-data-collection-openweathermap/2.4-testing-monitoring/" title="Testing và Monitoring Thu thập Thời tiết" class="dd-item 
        
        active
        
        ">
      <a href="/vi/2-data-collection-openweathermap/2.4-testing-monitoring/">
          Testing và Monitoring Thu thập Thời tiết
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-serverless-processing-lambda/" title="Xử lý và Chuyển đổi Dữ liệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-serverless-processing-lambda/">
          <b>3. </b>Xử lý và Chuyển đổi Dữ liệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-data-storage-solutions/" title="Phân tích Dữ liệu với Athena" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-data-storage-solutions/">
          <b>4. </b>Phân tích Dữ liệu với Athena
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-analytics-visualization/" title="Trực quan hóa Dữ liệu với QuickSight" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-analytics-visualization/">
          <b>5. </b>Trực quan hóa Dữ liệu với QuickSight
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-cleanup-next-steps/" title="Dọn dẹp Tài nguyên và Bước tiếp theo" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-cleanup-next-steps/">
          <b>6. </b>Dọn dẹp Tài nguyên và Bước tiếp theo
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/2-data-collection-openweathermap/2.4-testing-monitoring/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
     
    
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>23-06-2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Author </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/imvhuy/"  style="color:orange">Đặng Văn Huy</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vi/'>Xây dựng Pipeline ETL Thời tiết Serverless</a> > <a href='/vi/2-data-collection-openweathermap/'>Thu thập Dữ liệu Thời tiết với OpenWeatherMap</a> > Testing và Monitoring Thu thập Thời tiết
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#tổng-quan-testing-strategy">Tổng quan Testing Strategy</a></li>
    <li><a href="#bước-1-manual-function-testing">Bước 1: Manual Function Testing</a>
      <ul>
        <li><a href="#11-test-current-weather-function">1.1 Test Current Weather Function</a></li>
        <li><a href="#12-test-weather-forecast-function">1.2 Test Weather Forecast Function</a></li>
      </ul>
    </li>
    <li><a href="#bước-2-data-quality-validation">Bước 2: Data Quality Validation</a>
      <ul>
        <li><a href="#21-s3-data-structure-verification">2.1 S3 Data Structure Verification</a></li>
        <li><a href="#22-data-quality-validation-script">2.2 Data Quality Validation Script</a></li>
      </ul>
    </li>
    <li><a href="#bước-3-performance-testing">Bước 3: Performance Testing</a>
      <ul>
        <li><a href="#31-load-testing-script">3.1 Load Testing Script</a></li>
      </ul>
    </li>
    <li><a href="#bước-4-error-scenario-testing">Bước 4: Error Scenario Testing</a>
      <ul>
        <li><a href="#41-api-key-error-test">4.1 API Key Error Test</a></li>
        <li><a href="#42-network-timeout-test">4.2 Network Timeout Test</a></li>
      </ul>
    </li>
    <li><a href="#bước-5-monitoring-dashboard-setup">Bước 5: Monitoring Dashboard Setup</a>
      <ul>
        <li><a href="#51-cloudwatch-dashboard-json">5.1 CloudWatch Dashboard JSON</a></li>
      </ul>
    </li>
    <li><a href="#bước-6-automated-testing-pipeline">Bước 6: Automated Testing Pipeline</a>
      <ul>
        <li><a href="#61-daily-health-check-lambda">6.1 Daily Health Check Lambda</a></li>
        <li><a href="#62-schedule-health-check">6.2 Schedule Health Check</a></li>
      </ul>
    </li>
    <li><a href="#tóm-tắt">Tóm tắt</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Testing và Monitoring Thu thập Thời tiết
            </h1>
          

        



	<h1 id="testing-và-monitoring-thu-thập-thời-tiết">Testing và Monitoring Thu thập Thời tiết</h1>
<p>Bây giờ chúng ta đã có các Lambda functions và automated scheduling được cấu hình, đã đến lúc test toàn diện pipeline thu thập thời tiết và thiết lập monitoring chi tiết. Chúng ta sẽ validate data quality, performance, và đảm bảo hệ thống chạy đáng tin cậy.</p>
<h2 id="tổng-quan-testing-strategy">Tổng quan Testing Strategy</h2>
<p>Chúng ta sẽ test hệ thống thu thập thời tiết bằng:</p>
<ol>
<li><strong>Manual Function Testing</strong> - Gọi Lambda trực tiếp</li>
<li><strong>Scheduled Execution Testing</strong> - Validate CloudWatch Events</li>
<li><strong>Data Quality Validation</strong> - Kiểm tra dữ liệu S3</li>
<li><strong>Performance Testing</strong> - Phân tích load và timing</li>
<li><strong>Error Scenario Testing</strong> - Validate xử lý lỗi</li>
</ol>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
    A[Manual Tests] --&gt; B[Lambda Functions]
    C[Scheduled Tests] --&gt; D[CloudWatch Events]
    E[Data Quality Tests] --&gt; F[S3 Storage]
    G[Performance Tests] --&gt; H[CloudWatch Metrics]
    I[Error Tests] --&gt; J[Error Handling]

    style B fill:#ff9900,stroke:#232f3e,stroke-width:3px
    style F fill:#f3e5f5
    style H fill:#e8f5e8
</code></pre><h2 id="bước-1-manual-function-testing">Bước 1: Manual Function Testing</h2>
<h3 id="11-test-current-weather-function">1.1 Test Current Weather Function</h3>
<ol>
<li>
<p><strong>Điều hướng đến Lambda Console</strong></p>
<ul>
<li>AWS Console → Lambda → Functions</li>
<li>Click <code>weather-current-collector</code></li>
</ul>
</li>
<li>
<p><strong>Tạo Test Event</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;manual-test&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail-type&#34;</span>: <span style="color:#e6db74">&#34;Manual Test Event&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;test_mode&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cities_to_test&#34;</span>: [<span style="color:#e6db74">&#34;Ho Chi Minh City&#34;</span>, <span style="color:#e6db74">&#34;Singapore&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p><strong>Chạy Test</strong></p>
<ul>
<li>Click nút &ldquo;Test&rdquo;</li>
<li>Đợi execution hoàn tất</li>
<li>Review kết quả execution</li>
</ul>
</li>
</ol>
<p><strong>Kết quả Mong đợi:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;statusCode&#34;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;body&#34;</span>: <span style="color:#e6db74">&#34;{\&#34;message\&#34;: \&#34;Thu thập thời tiết hoàn tất\&#34;, \&#34;successful_collections\&#34;: 6, \&#34;failed_collections\&#34;: 0, \&#34;results\&#34;: [...]}&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="12-test-weather-forecast-function">1.2 Test Weather Forecast Function</h3>
<ol>
<li>
<p><strong>Điều hướng đến forecast function</strong></p>
<ul>
<li>Click <code>weather-forecast-collector</code></li>
</ul>
</li>
<li>
<p><strong>Tạo Test Event</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;manual-test&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail-type&#34;</span>: <span style="color:#e6db74">&#34;Manual Test Event&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;detail&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;test_mode&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;include_extended_forecast&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p><strong>Verify Test Results</strong></p>
<ul>
<li>Kiểm tra execution logs trong CloudWatch</li>
<li>Verify S3 objects được tạo</li>
<li>Validate cấu trúc JSON</li>
</ul>
</li>
</ol>
<h2 id="bước-2-data-quality-validation">Bước 2: Data Quality Validation</h2>
<h3 id="21-s3-data-structure-verification">2.1 S3 Data Structure Verification</h3>
<p><strong>Kiểm tra S3 Bucket Structure:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws s3 ls s3://weather-data-123456789012/ --recursive
</span></span></code></pre></div><p><strong>Cấu trúc Mong đợi:</strong></p>
<pre tabindex="0"><code>weather-data-123456789012/
├── raw/
│   ├── current-weather/
│   │   └── year=2025/month=01/day=03/hour=14/
│   │       ├── ho_chi_minh_city_20250103_140532.json
│   │       ├── hanoi_20250103_140534.json
│   │       ├── singapore_20250103_140536.json
│   │       ├── bangkok_20250103_140538.json
│   │       ├── jakarta_20250103_140540.json
│   │       └── kuala_lumpur_20250103_140542.json
│   └── forecast/
│       └── year=2025/month=01/day=03/
│           ├── ho_chi_minh_city_20250103_140612.json
│           └── ...
</code></pre><h3 id="22-data-quality-validation-script">2.2 Data Quality Validation Script</h3>
<p><strong>File: <code>validate_weather_data.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Optional
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)
</span></span><span style="display:flex;"><span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WeatherDataValidator</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, bucket_name: str):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bucket_name <span style="color:#f92672">=</span> bucket_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_recent_files</span>(self, data_type: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;current-weather&#39;</span>, hours_back: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">-&gt;</span> List[str]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Lấy các file dữ liệu thời tiết từ N giờ trước.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        files <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        now <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> hour_offset <span style="color:#f92672">in</span> range(hours_back):
</span></span><span style="display:flex;"><span>            check_time <span style="color:#f92672">=</span> now <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span>hour_offset)
</span></span><span style="display:flex;"><span>            prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;raw/</span><span style="color:#e6db74">{</span>data_type<span style="color:#e6db74">}</span><span style="color:#e6db74">/year=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>year<span style="color:#e6db74">}</span><span style="color:#e6db74">/month=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>month<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/day=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>day<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> data_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;current-weather&#39;</span>:
</span></span><span style="display:flex;"><span>                prefix <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;hour=</span><span style="color:#e6db74">{</span>check_time<span style="color:#f92672">.</span>hour<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>s3<span style="color:#f92672">.</span>list_objects_v2(
</span></span><span style="display:flex;"><span>                    Bucket<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bucket_name,
</span></span><span style="display:flex;"><span>                    Prefix<span style="color:#f92672">=</span>prefix
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> obj <span style="color:#f92672">in</span> response<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Contents&#39;</span>, []):
</span></span><span style="display:flex;"><span>                    files<span style="color:#f92672">.</span>append(obj[<span style="color:#e6db74">&#39;Key&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Không thể list objects cho </span><span style="color:#e6db74">{</span>prefix<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> files
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate_current_weather_file</span>(self, file_key: str) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Validate một file dữ liệu thời tiết hiện tại.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>s3<span style="color:#f92672">.</span>get_object(Bucket<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bucket_name, Key<span style="color:#f92672">=</span>file_key)
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response[<span style="color:#e6db74">&#39;Body&#39;</span>]<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            validation_results <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;file_key&#39;</span>: file_key,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid&#39;</span>: <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;errors&#39;</span>: [],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Required fields validation</span>
</span></span><span style="display:flex;"><span>            required_fields <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;coord&#39;</span>, <span style="color:#e6db74">&#39;weather&#39;</span>, <span style="color:#e6db74">&#39;main&#39;</span>, <span style="color:#e6db74">&#39;wind&#39;</span>, <span style="color:#e6db74">&#39;clouds&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;dt&#39;</span>, <span style="color:#e6db74">&#39;sys&#39;</span>, <span style="color:#e6db74">&#39;timezone&#39;</span>, <span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;cod&#39;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> field <span style="color:#f92672">in</span> required_fields:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> field <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;errors&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Thiếu field bắt buộc: </span><span style="color:#e6db74">{</span>field<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;valid&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Temperature validation</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;main&#39;</span> <span style="color:#f92672">in</span> data <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;temp&#39;</span> <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#39;main&#39;</span>]:
</span></span><span style="display:flex;"><span>                temp <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;main&#39;</span>][<span style="color:#e6db74">&#39;temp&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">50</span> <span style="color:#f92672">&lt;=</span> temp <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">60</span>):  <span style="color:#75715e"># Khoảng nhiệt độ hợp lý (Celsius)</span>
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;warnings&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Nhiệt độ có vẻ bất thường: </span><span style="color:#e6db74">{</span>temp<span style="color:#e6db74">}</span><span style="color:#e6db74">°C&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Humidity validation</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;main&#39;</span> <span style="color:#f92672">in</span> data <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;humidity&#39;</span> <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#39;main&#39;</span>]:
</span></span><span style="display:flex;"><span>                humidity <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;main&#39;</span>][<span style="color:#e6db74">&#39;humidity&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> (<span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> humidity <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;errors&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Độ ẩm không hợp lệ: </span><span style="color:#e6db74">{</span>humidity<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
</span></span><span style="display:flex;"><span>                    validation_results[<span style="color:#e6db74">&#39;valid&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Metadata validation</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;collection_timestamp&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                validation_results[<span style="color:#e6db74">&#39;warnings&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;Thiếu collection_timestamp&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;city_metadata&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>                validation_results[<span style="color:#e6db74">&#39;warnings&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;Thiếu city_metadata&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> validation_results
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;file_key&#39;</span>: file_key,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid&#39;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;errors&#39;</span>: [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Lỗi đọc file: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_validation_report</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Chạy báo cáo validation toàn diện.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        report <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;timestamp&#39;</span>: datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;current_weather&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;total_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;invalid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;details&#39;</span>: []
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;forecast&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;total_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;valid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;invalid_files&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;warnings&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;details&#39;</span>: []
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Validate current weather files</span>
</span></span><span style="display:flex;"><span>        current_files <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_recent_files(<span style="color:#e6db74">&#39;current-weather&#39;</span>, <span style="color:#ae81ff">24</span>)
</span></span><span style="display:flex;"><span>        report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;total_files&#39;</span>] <span style="color:#f92672">=</span> len(current_files)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> file_key <span style="color:#f92672">in</span> current_files:
</span></span><span style="display:flex;"><span>            validation <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>validate_current_weather_file(file_key)
</span></span><span style="display:flex;"><span>            report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;details&#39;</span>]<span style="color:#f92672">.</span>append(validation)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> validation[<span style="color:#e6db74">&#39;valid&#39;</span>]:
</span></span><span style="display:flex;"><span>                report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;valid_files&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;invalid_files&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> validation[<span style="color:#e6db74">&#39;warnings&#39;</span>]:
</span></span><span style="display:flex;"><span>                report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;warnings&#39;</span>] <span style="color:#f92672">+=</span> len(validation[<span style="color:#e6db74">&#39;warnings&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Validate forecast files</span>
</span></span><span style="display:flex;"><span>        forecast_files <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_recent_files(<span style="color:#e6db74">&#39;forecast&#39;</span>, <span style="color:#ae81ff">24</span>)
</span></span><span style="display:flex;"><span>        report[<span style="color:#e6db74">&#39;forecast&#39;</span>][<span style="color:#e6db74">&#39;total_files&#39;</span>] <span style="color:#f92672">=</span> len(forecast_files)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Validation hoàn tất: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;valid_files&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;current_weather&#39;</span>][<span style="color:#e6db74">&#39;total_files&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> current weather files hợp lệ&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> report
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sử dụng validator</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    validator <span style="color:#f92672">=</span> WeatherDataValidator(<span style="color:#e6db74">&#39;weather-data-123456789012&#39;</span>)
</span></span><span style="display:flex;"><span>    report <span style="color:#f92672">=</span> validator<span style="color:#f92672">.</span>run_validation_report()
</span></span><span style="display:flex;"><span>    print(json<span style="color:#f92672">.</span>dumps(report, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>))
</span></span></code></pre></div><h2 id="bước-3-performance-testing">Bước 3: Performance Testing</h2>
<h3 id="31-load-testing-script">3.1 Load Testing Script</h3>
<p><strong>File: <code>load_test.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> concurrent.futures
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoadTester</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>lambda_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;lambda&#39;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cloudwatch <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cloudwatch&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">invoke_lambda_function</span>(self, function_name: str, payload: Dict) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Gọi Lambda function và đo thời gian response.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>lambda_client<span style="color:#f92672">.</span>invoke(
</span></span><span style="display:flex;"><span>                FunctionName<span style="color:#f92672">=</span>function_name,
</span></span><span style="display:flex;"><span>                InvocationType<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RequestResponse&#39;</span>,
</span></span><span style="display:flex;"><span>                Payload<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload)
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            end_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>            duration <span style="color:#f92672">=</span> (end_time <span style="color:#f92672">-</span> start_time) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>  <span style="color:#75715e"># milliseconds</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;duration_ms&#39;</span>: duration,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;status_code&#39;</span>: response[<span style="color:#e6db74">&#39;StatusCode&#39;</span>],
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;function_name&#39;</span>: function_name
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            end_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>            duration <span style="color:#f92672">=</span> (end_time <span style="color:#f92672">-</span> start_time) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;duration_ms&#39;</span>: duration,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;error&#39;</span>: str(e),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;function_name&#39;</span>: function_name
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_concurrent_test</span>(self, function_name: str, concurrent_calls: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">-&gt;</span> List[Dict]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Chạy nhiều lambda calls đồng thời.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        results <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;source&#39;</span>: <span style="color:#e6db74">&#39;load-test&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;detail-type&#39;</span>: <span style="color:#e6db74">&#39;Load Test Event&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;detail&#39;</span>: {<span style="color:#e6db74">&#39;test_id&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;load-test-</span><span style="color:#e6db74">{</span>int(time<span style="color:#f92672">.</span>time())<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> concurrent<span style="color:#f92672">.</span>futures<span style="color:#f92672">.</span>ThreadPoolExecutor(max_workers<span style="color:#f92672">=</span>concurrent_calls) <span style="color:#66d9ef">as</span> executor:
</span></span><span style="display:flex;"><span>            futures <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                executor<span style="color:#f92672">.</span>submit(self<span style="color:#f92672">.</span>invoke_lambda_function, function_name, payload)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(concurrent_calls)
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> future <span style="color:#f92672">in</span> concurrent<span style="color:#f92672">.</span>futures<span style="color:#f92672">.</span>as_completed(futures):
</span></span><span style="display:flex;"><span>                results<span style="color:#f92672">.</span>append(future<span style="color:#f92672">.</span>result())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">analyze_results</span>(self, results: List[Dict]) <span style="color:#f92672">-&gt;</span> Dict:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Phân tích kết quả load test.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        successful_calls <span style="color:#f92672">=</span> [r <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> results <span style="color:#66d9ef">if</span> r[<span style="color:#e6db74">&#39;success&#39;</span>]]
</span></span><span style="display:flex;"><span>        failed_calls <span style="color:#f92672">=</span> [r <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> results <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> r[<span style="color:#e6db74">&#39;success&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        durations <span style="color:#f92672">=</span> [r[<span style="color:#e6db74">&#39;duration_ms&#39;</span>] <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> successful_calls]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        analysis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;total_calls&#39;</span>: len(results),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;successful_calls&#39;</span>: len(successful_calls),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;failed_calls&#39;</span>: len(failed_calls),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;success_rate&#39;</span>: len(successful_calls) <span style="color:#f92672">/</span> len(results) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;avg_duration_ms&#39;</span>: sum(durations) <span style="color:#f92672">/</span> len(durations) <span style="color:#66d9ef">if</span> durations <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;min_duration_ms&#39;</span>: min(durations) <span style="color:#66d9ef">if</span> durations <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;max_duration_ms&#39;</span>: max(durations) <span style="color:#66d9ef">if</span> durations <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;errors&#39;</span>: [r[<span style="color:#e6db74">&#39;error&#39;</span>] <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> failed_calls]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> analysis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Chạy load test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    tester <span style="color:#f92672">=</span> LoadTester()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;🚀 Bắt đầu load test cho weather-current-collector...&#34;</span>)
</span></span><span style="display:flex;"><span>    results <span style="color:#f92672">=</span> tester<span style="color:#f92672">.</span>run_concurrent_test(<span style="color:#e6db74">&#39;weather-current-collector&#39;</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    analysis <span style="color:#f92672">=</span> tester<span style="color:#f92672">.</span>analyze_results(results)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;📊 Kết quả load test:&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;   Tổng calls: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;total_calls&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;   Thành công: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;successful_calls&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;   Thất bại: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;failed_calls&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;   Success rate: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;success_rate&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;   Avg duration: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;avg_duration_ms&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.0f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;   Min duration: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;min_duration_ms&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.0f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;   Max duration: </span><span style="color:#e6db74">{</span>analysis[<span style="color:#e6db74">&#39;max_duration_ms&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.0f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
</span></span></code></pre></div><h2 id="bước-4-error-scenario-testing">Bước 4: Error Scenario Testing</h2>
<h3 id="41-api-key-error-test">4.1 API Key Error Test</h3>
<p><strong>Test với API key không hợp lệ:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Test script để kiểm tra error handling khi API key sai</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ssm <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;ssm&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Backup API key hiện tại</span>
</span></span><span style="display:flex;"><span>original_key <span style="color:#f92672">=</span> ssm<span style="color:#f92672">.</span>get_parameter(
</span></span><span style="display:flex;"><span>    Name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/weather-etl/openweathermap/api-key&#39;</span>,
</span></span><span style="display:flex;"><span>    WithDecryption<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>)[<span style="color:#e6db74">&#39;Parameter&#39;</span>][<span style="color:#e6db74">&#39;Value&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set API key không hợp lệ</span>
</span></span><span style="display:flex;"><span>ssm<span style="color:#f92672">.</span>put_parameter(
</span></span><span style="display:flex;"><span>    Name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/weather-etl/openweathermap/api-key&#39;</span>,
</span></span><span style="display:flex;"><span>    Value<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;invalid-key-12345&#39;</span>,
</span></span><span style="display:flex;"><span>    Type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;SecureString&#39;</span>,
</span></span><span style="display:flex;"><span>    Overwrite<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Test Lambda function</span>
</span></span><span style="display:flex;"><span>lambda_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;lambda&#39;</span>)
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> lambda_client<span style="color:#f92672">.</span>invoke(
</span></span><span style="display:flex;"><span>    FunctionName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;weather-current-collector&#39;</span>,
</span></span><span style="display:flex;"><span>    InvocationType<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RequestResponse&#39;</span>,
</span></span><span style="display:flex;"><span>    Payload<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;source&#34;: &#34;error-test&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Response với API key không hợp lệ:&#34;</span>, json<span style="color:#f92672">.</span>loads(response[<span style="color:#e6db74">&#39;Payload&#39;</span>]<span style="color:#f92672">.</span>read()))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Restore original API key</span>
</span></span><span style="display:flex;"><span>ssm<span style="color:#f92672">.</span>put_parameter(
</span></span><span style="display:flex;"><span>    Name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/weather-etl/openweathermap/api-key&#39;</span>,
</span></span><span style="display:flex;"><span>    Value<span style="color:#f92672">=</span>original_key,
</span></span><span style="display:flex;"><span>    Type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;SecureString&#39;</span>,
</span></span><span style="display:flex;"><span>    Overwrite<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="42-network-timeout-test">4.2 Network Timeout Test</h3>
<p><strong>Test network timeout scenario:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Modify Lambda function để simulate network timeout</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Thêm vào Lambda function code:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_current_weather_with_timeout</span>(city: Dict, api_key: str) <span style="color:#f92672">-&gt;</span> Optional[Dict]:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test function với timeout ngắn.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    base_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.openweathermap.org/data/2.5/weather&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    params <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;lat&#39;</span>: city[<span style="color:#e6db74">&#39;lat&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;lon&#39;</span>: city[<span style="color:#e6db74">&#39;lon&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;appid&#39;</span>: api_key,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;units&#39;</span>: <span style="color:#e6db74">&#39;metric&#39;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Timeout rất ngắn để force error</span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(base_url, params<span style="color:#f92672">=</span>params, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>        response<span style="color:#f92672">.</span>raise_for_status()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>Timeout:
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Timeout cho </span><span style="color:#e6db74">{</span>city[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Lỗi khác cho </span><span style="color:#e6db74">{</span>city[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span></code></pre></div><h2 id="bước-5-monitoring-dashboard-setup">Bước 5: Monitoring Dashboard Setup</h2>
<h3 id="51-cloudwatch-dashboard-json">5.1 CloudWatch Dashboard JSON</h3>
<p><strong>Complete dashboard configuration:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;widgets&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;metric&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;Weather/ETL&#34;</span>, <span style="color:#e6db74">&#34;SuccessfulCollections&#34;</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;Weather/ETL&#34;</span>, <span style="color:#e6db74">&#34;FailedCollections&#34;</span>]
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;period&#34;</span>: <span style="color:#ae81ff">3600</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;stat&#34;</span>: <span style="color:#e6db74">&#34;Sum&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;us-east-1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Thu thập Thành công vs Thất bại&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;yAxis&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;left&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;min&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;metric&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;metrics&#34;</span>: [
</span></span><span style="display:flex;"><span>          [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;AWS/Lambda&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Duration&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;FunctionName&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;weather-current-collector&#34;</span>
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;AWS/Lambda&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Duration&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;FunctionName&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;weather-forecast-collector&#34;</span>
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;period&#34;</span>: <span style="color:#ae81ff">300</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;stat&#34;</span>: <span style="color:#e6db74">&#34;Average&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;us-east-1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Lambda Duration&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;log&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;query&#34;</span>: <span style="color:#e6db74">&#34;SOURCE &#39;/aws/lambda/weather-current-collector&#39;\n| fields @timestamp, @message\n| filter @message like /ERROR/\n| sort @timestamp desc\n| limit 20&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;us-east-1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Recent Errors&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;view&#34;</span>: <span style="color:#e6db74">&#34;table&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="bước-6-automated-testing-pipeline">Bước 6: Automated Testing Pipeline</h2>
<h3 id="61-daily-health-check-lambda">6.1 Daily Health Check Lambda</h3>
<p><strong>File: <code>health_check_lambda.py</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger()
</span></span><span style="display:flex;"><span>logger<span style="color:#f92672">.</span>setLevel(logging<span style="color:#f92672">.</span>INFO)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lambda_handler</span>(event, context):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Daily health check cho weather collection system.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Khởi tạo clients</span>
</span></span><span style="display:flex;"><span>    s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>    sns <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;sns&#39;</span>)
</span></span><span style="display:flex;"><span>    cloudwatch <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cloudwatch&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bucket_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;weather-data-123456789012&#39;</span>
</span></span><span style="display:flex;"><span>    sns_topic <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;arn:aws:sns:us-east-1:123456789012:weather-collection-alerts&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    health_status <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;timestamp&#39;</span>: datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;checks&#39;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;overall_status&#39;</span>: <span style="color:#e6db74">&#39;HEALTHY&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;issues&#39;</span>: []
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check 1: S3 data freshness</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        now <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>        yesterday <span style="color:#f92672">=</span> now <span style="color:#f92672">-</span> timedelta(days<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;raw/current-weather/year=</span><span style="color:#e6db74">{</span>yesterday<span style="color:#f92672">.</span>year<span style="color:#e6db74">}</span><span style="color:#e6db74">/month=</span><span style="color:#e6db74">{</span>yesterday<span style="color:#f92672">.</span>month<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/day=</span><span style="color:#e6db74">{</span>yesterday<span style="color:#f92672">.</span>day<span style="color:#e6db74">:</span><span style="color:#e6db74">02d</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> s3<span style="color:#f92672">.</span>list_objects_v2(
</span></span><span style="display:flex;"><span>            Bucket<span style="color:#f92672">=</span>bucket_name,
</span></span><span style="display:flex;"><span>            Prefix<span style="color:#f92672">=</span>prefix
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        file_count <span style="color:#f92672">=</span> len(response<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Contents&#39;</span>, []))
</span></span><span style="display:flex;"><span>        expected_files <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span>  <span style="color:#75715e"># 6 cities * 24 hours</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> file_count <span style="color:#f92672">&lt;</span> expected_files <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.8</span>:  <span style="color:#75715e"># Allow 20% tolerance</span>
</span></span><span style="display:flex;"><span>            health_status[<span style="color:#e6db74">&#39;overall_status&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UNHEALTHY&#39;</span>
</span></span><span style="display:flex;"><span>            health_status[<span style="color:#e6db74">&#39;issues&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Thiếu dữ liệu: </span><span style="color:#e6db74">{</span>file_count<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>expected_files<span style="color:#e6db74">}</span><span style="color:#e6db74"> files&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        health_status[<span style="color:#e6db74">&#39;checks&#39;</span>]<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;S3 Data Freshness&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;status&#39;</span>: <span style="color:#e6db74">&#39;PASS&#39;</span> <span style="color:#66d9ef">if</span> file_count <span style="color:#f92672">&gt;=</span> expected_files <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.8</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;FAIL&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;details&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>file_count<span style="color:#e6db74">}</span><span style="color:#e6db74"> files cho ngày </span><span style="color:#e6db74">{</span>yesterday<span style="color:#f92672">.</span>date()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        health_status[<span style="color:#e6db74">&#39;overall_status&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UNHEALTHY&#39;</span>
</span></span><span style="display:flex;"><span>        health_status[<span style="color:#e6db74">&#39;issues&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;S3 check failed: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check 2: Lambda errors in last 24h</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        end_time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()
</span></span><span style="display:flex;"><span>        start_time <span style="color:#f92672">=</span> end_time <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">24</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> cloudwatch<span style="color:#f92672">.</span>get_metric_statistics(
</span></span><span style="display:flex;"><span>            Namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;AWS/Lambda&#39;</span>,
</span></span><span style="display:flex;"><span>            MetricName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Errors&#39;</span>,
</span></span><span style="display:flex;"><span>            Dimensions<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#39;Name&#39;</span>: <span style="color:#e6db74">&#39;FunctionName&#39;</span>, <span style="color:#e6db74">&#39;Value&#39;</span>: <span style="color:#e6db74">&#39;weather-current-collector&#39;</span>}
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            StartTime<span style="color:#f92672">=</span>start_time,
</span></span><span style="display:flex;"><span>            EndTime<span style="color:#f92672">=</span>end_time,
</span></span><span style="display:flex;"><span>            Period<span style="color:#f92672">=</span><span style="color:#ae81ff">3600</span>,
</span></span><span style="display:flex;"><span>            Statistics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Sum&#39;</span>]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        total_errors <span style="color:#f92672">=</span> sum([point[<span style="color:#e6db74">&#39;Sum&#39;</span>] <span style="color:#66d9ef">for</span> point <span style="color:#f92672">in</span> response[<span style="color:#e6db74">&#39;Datapoints&#39;</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> total_errors <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>:  <span style="color:#75715e"># Threshold</span>
</span></span><span style="display:flex;"><span>            health_status[<span style="color:#e6db74">&#39;overall_status&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UNHEALTHY&#39;</span>
</span></span><span style="display:flex;"><span>            health_status[<span style="color:#e6db74">&#39;issues&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Quá nhiều Lambda errors: </span><span style="color:#e6db74">{</span>total_errors<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        health_status[<span style="color:#e6db74">&#39;checks&#39;</span>]<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;Lambda Error Rate&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;status&#39;</span>: <span style="color:#e6db74">&#39;PASS&#39;</span> <span style="color:#66d9ef">if</span> total_errors <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;FAIL&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;details&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>total_errors<span style="color:#e6db74">}</span><span style="color:#e6db74"> errors trong 24h&#34;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        health_status[<span style="color:#e6db74">&#39;overall_status&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UNHEALTHY&#39;</span>
</span></span><span style="display:flex;"><span>        health_status[<span style="color:#e6db74">&#39;issues&#39;</span>]<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;CloudWatch check failed: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Gửi alert nếu có vấn đề</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> health_status[<span style="color:#e6db74">&#39;overall_status&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;UNHEALTHY&#39;</span>:
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Weather ETL Health Check FAILED</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">Issues:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(health_status[<span style="color:#e6db74">&#39;issues&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sns<span style="color:#f92672">.</span>publish(
</span></span><span style="display:flex;"><span>            TopicArn<span style="color:#f92672">=</span>sns_topic,
</span></span><span style="display:flex;"><span>            Message<span style="color:#f92672">=</span>message,
</span></span><span style="display:flex;"><span>            Subject<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;⚠️ Weather ETL Health Check Alert&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Health check completed: </span><span style="color:#e6db74">{</span>health_status[<span style="color:#e6db74">&#39;overall_status&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;statusCode&#39;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;body&#39;</span>: json<span style="color:#f92672">.</span>dumps(health_status, ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="62-schedule-health-check">6.2 Schedule Health Check</h3>
<p><strong>CloudWatch Events Rule cho daily health check:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;weather-etl-daily-health-check&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;ScheduleExpression&#34;</span>: <span style="color:#e6db74">&#34;cron(0 8 * * ? *)&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;State&#34;</span>: <span style="color:#e6db74">&#34;ENABLED&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Description&#34;</span>: <span style="color:#e6db74">&#34;Daily health check lúc 8:00 UTC (15:00 VN)&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Targets&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Arn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:lambda:us-east-1:123456789012:function:weather-health-check&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Input&#34;</span>: <span style="color:#e6db74">&#34;{\&#34;source\&#34;: \&#34;daily-health-check\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="tóm-tắt">Tóm tắt</h2>
<p>Trong phần này, chúng ta đã:</p>
<p>✅ Thiết lập comprehensive testing strategy<br>
✅ Tạo manual và automated tests cho Lambda functions<br>
✅ Implement data quality validation<br>
✅ Chạy performance và load testing<br>
✅ Test error scenarios và error handling<br>
✅ Thiết lập CloudWatch monitoring dashboard<br>
✅ Tạo automated daily health checks<br>
✅ Cấu hình alerts cho issues</p>
<p><strong>Kết quả</strong>: Hệ thống weather collection giờ đã có monitoring và testing toàn diện, đảm bảo chạy ổn định và đáng tin cậy.</p>
<p><strong>Tiếp theo</strong>: Trong Module 3, chúng ta sẽ xây dựng data processing và transformation pipeline để xử lý dữ liệu thời tiết thô này thành format phù hợp cho analysis.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/2-data-collection-openweathermap/2.3-automated-scheduling/" title="Lập lịch Tự động với CloudWatch Events"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/3-serverless-processing-lambda/" title="Xử lý và Chuyển đổi Dữ liệu" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1752242330"></script>
    <script src="/js/perfect-scrollbar.min.js?1752242330"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1752242330"></script>
    <script src="/js/jquery.sticky.js?1752242330"></script>
    <script src="/js/featherlight.min.js?1752242330"></script>
    <script src="/js/highlight.pack.js?1752242330"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1752242330"></script>
    <script src="/js/learn.js?1752242330"></script>
    <script src="/js/hugo-learn.js?1752242330"></script>

    <link href="/mermaid/mermaid.css?1752242330" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1752242330"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
