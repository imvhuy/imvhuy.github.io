[
{
	"uri": "//localhost:1313/vi/",
	"title": "X√¢y d·ª±ng Pipeline ETL Th·ªùi ti·∫øt Serverless",
	"tags": [],
	"description": "",
	"content": "X√¢y d·ª±ng ETL Data Pipeline cho ph√¢n t√≠ch th·ªùi ti·∫øt tr√™n AWS T·ªïng quan Workshop Trong workshop n√†y, em s·∫Ω t·∫°o m·ªôt pipeline d·ªØ li·ªáu th·ªùi ti·∫øt ƒë∆°n gi·∫£n nh∆∞ng ho√†n ch·ªânh, minh h·ªça c√°c kh√°i ni·ªám ETL c·ªët l√µi s·ª≠ d·ª•ng c√¥ng ngh·ªá serverless c·ªßa AWS.\nWorkshop n√†y tr√¨nh b√†y c√°ch x√¢y d·ª±ng m·ªôt pipeline ETL ƒë∆°n gi·∫£n s·ª≠ d·ª•ng c√¥ng ngh·ªá serverless c·ªßa AWS:\nThu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt t·ª´ OpenWeatherMap API s·ª≠ d·ª•ng AWS Lambda X·ª≠ l√Ω v√† chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu th√¥ th√†nh ƒë·ªãnh d·∫°ng ph√¢n t√≠ch L∆∞u tr·ªØ d·ªØ li·ªáu trong Amazon S3 cho c·∫£ d·ªØ li·ªáu th√¥ v√† ƒë√£ x·ª≠ l√Ω Ph√¢n t√≠ch d·ªØ li·ªáu s·ª≠ d·ª•ng Amazon Athena v·ªõi truy v·∫•n SQL Tr·ª±c quan h√≥a insights th√¥ng qua Amazon QuickSight dashboard D·ªçn d·∫πp t√†i nguy√™n ƒë·ªÉ t·ªëi ∆∞u chi ph√≠ C√¥ng ngh·ªá s·ª≠ d·ª•ng: Workshop s·ª≠ d·ª•ng AWS Lambda, S3, Athena, QuickSight k·∫øt h·ª£p v·ªõi OpenWeatherMap API ƒë·ªÉ x√¢y d·ª±ng pipeline ETL serverless thu th·∫≠p v√† ph√¢n t√≠ch d·ªØ li·ªáu th·ªùi ti·∫øt. C√°c ph·∫ßn ch√≠nh 1. Gi·ªõi thi·ªáu T·ªïng quan workshop v√† m·ª•c ti√™u h·ªçc t·∫≠p Thi·∫øt k·∫ø ki·∫øn tr√∫c v√† gi·ªõi thi·ªáu c√°c d·ªãch v·ª• AWS Y√™u c·∫ßu ti√™n quy·∫øt v√† thi·∫øt l·∫≠p 2. Thu th·∫≠p D·ªØ li·ªáu Th·ªùi ti·∫øt v·ªõi OpenWeatherMap Thi·∫øt l·∫≠p t√†i kho·∫£n OpenWeatherMap API T·∫°o Lambda function cho thu th·∫≠p d·ªØ li·ªáu C·∫•u h√¨nh t·ª± ƒë·ªông l·∫•y d·ªØ li·ªáu Ki·ªÉm tra v√† gi√°m s√°t qu√° tr√¨nh thu th·∫≠p 3. X·ª≠ l√Ω D·ªØ li·ªáu Serverless v·ªõi Lambda X√¢y d·ª±ng Lambda function chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu Chuy·ªÉn ƒë·ªïi JSON th·ªùi ti·∫øt th√¥ sang ƒë·ªãnh d·∫°ng ph√¢n t√≠ch Tri·ªÉn khai x√°c th·ª±c v√† l√†m gi√†u d·ªØ li·ªáu Thi·∫øt l·∫≠p triggers x·ª≠ l√Ω 4. Ph√¢n t√≠ch D·ªØ li·ªáu v·ªõi Amazon Athena T·∫°o c·∫•u tr√∫c data lake S3 Thi·∫øt l·∫≠p b·∫£ng v√† schema Athena Vi·∫øt truy v·∫•n SQL cho ph√¢n t√≠ch th·ªùi ti·∫øt Kh√°m ph√° c√°c m·∫´u v√† th√¥ng tin chi ti·∫øt t·ª´ d·ªØ li·ªáu 5. Tr·ª±c quan h√≥a D·ªØ li·ªáu v·ªõi QuickSight Thi·∫øt l·∫≠p Amazon QuickSight T·∫°o dashboard th·ªùi ti·∫øt X√¢y d·ª±ng tr·ª±c quan h√≥a t∆∞∆°ng t√°c Chia s·∫ª v√† xu·∫•t b·∫£n dashboard 6. D·ªçn d·∫πp T√†i nguy√™n v√† B∆∞·ªõc ti·∫øp theo Danh s√°ch ki·ªÉm tra d·ªçn d·∫πp to√†n di·ªán Chi·∫øn l∆∞·ª£c t·ªëi ∆∞u chi ph√≠ ƒê·ªÅ xu·∫•t c·∫£i ti·∫øn v√† m·ªü r·ªông T√†i nguy√™n h·ªçc t·∫≠p b·ªï sung "
},
{
	"uri": "//localhost:1313/vi/2-data-collection-openweathermap/2.1-openweathermap-setup/",
	"title": "Thi·∫øt l·∫≠p OpenWeatherMap API",
	"tags": [],
	"description": "",
	"content": "Thi·∫øt l·∫≠p OpenWeatherMap API Trong ph·∫ßn ƒë∆°n gi·∫£n h√≥a n√†y, ch√∫ng ta s·∫Ω nhanh ch√≥ng thi·∫øt l·∫≠p t√†i kho·∫£n OpenWeatherMap API ƒë·ªÉ thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt cho pipeline c·ªßa ch√∫ng ta.\nB∆∞·ªõc 1: ƒêƒÉng k√Ω OpenWeatherMap T·∫°o t√†i kho·∫£n Truy c·∫≠p https://openweathermap.org v√† nh·∫•p v√†o \u0026ldquo;Sign Up\u0026rdquo; Ho√†n th√†nh ƒëƒÉng k√Ω v·ªõi email c·ªßa b·∫°n X√°c minh email v√† ƒëƒÉng nh·∫≠p B∆∞·ªõc 2: L·∫•y API Key Truy c·∫≠p API Keys Sau khi ƒëƒÉng nh·∫≠p, ƒëi ƒë·∫øn ph·∫ßn \u0026ldquo;API keys\u0026rdquo; Ghi ch√∫ API key m·∫∑c ƒë·ªãnh ho·∫∑c t·∫°o key m·ªõi v·ªõi t√™n \u0026ldquo;weather-data-collection\u0026rdquo; G√≥i mi·ªÖn ph√≠ bao g·ªìm 1,000 l·ªánh g·ªçi API m·ªói ng√†y v√† 60 l·ªánh g·ªçi m·ªói ph√∫t, t·ª´ng n√†y l√† ƒë·ªß cho workshop c·ªßa t√¥i.\nB∆∞·ªõc 3: Ki·ªÉm tra API Key Ki·ªÉm tra API key c·ªßa b·∫°n b·∫±ng m·ªôt trong c√°c ph∆∞∆°ng ph√°p sau:\nPh∆∞∆°ng ph√°p tr√¨nh duy·ªát:\nhttps://api.openweathermap.org/data/2.5/weather?lat=10.7769\u0026amp;lon=106.7009\u0026amp;appid=YOUR_API_KEY Ph∆∞∆°ng ph√°p cURL:\ncurl \u0026#34;https://api.openweathermap.org/data/2.5/weather?lat=10.7769\u0026amp;lon=106.7009\u0026amp;appid=YOUR_API_KEY\u0026#34; B·∫°n s·∫Ω th·∫•y ph·∫£n h·ªìi JSON v·ªõi d·ªØ li·ªáu th·ªùi ti·∫øt hi·ªán t·∫°i c·ªßa Th√†nh ph·ªë H·ªì Ch√≠ Minh.\nC√°c API Endpoints ch√≠nh s·∫Ω s·ª≠ d·ª•ng # Th·ªùi ti·∫øt hi·ªán t·∫°i\rhttps://api.openweathermap.org/data/2.5/weather?q={city}\u0026amp;appid={API key}\r# D·ª± b√°o 5 ng√†y (kho·∫£ng th·ªùi gian 3 gi·ªù)\rhttps://api.openweathermap.org/data/2.5/forecast?q={city}\u0026amp;appid={API key} C√°c b∆∞·ªõc ti·∫øp theo V·∫≠y l√† xong! B·∫°n ƒë√£ c√≥ API key OpenWeatherMap ho·∫°t ƒë·ªông ƒë∆∞·ª£c l∆∞u tr·ªØ an to√†n trong Parameter Store. Trong ph·∫ßn ti·∫øp theo, ch√∫ng ta s·∫Ω t·∫°o m·ªôt Lambda function ƒë·ªÉ thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt.\nƒê√£ ho√†n th√†nh:\nT·∫°o t√†i kho·∫£n OpenWeatherMap L·∫•y API key L∆∞u tr·ªØ API key trong AWS Parameter Store "
},
{
	"uri": "//localhost:1313/vi/2-data-collection-openweathermap/2.2-lambda-weather-collector/",
	"title": "X√¢y d·ª±ng Lambda Weather Collector",
	"tags": [],
	"description": "",
	"content": "Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω t·∫°o c√°c h√†m AWS Lambda ƒë·ªÉ t·ª± ƒë·ªông thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt t·ª´ OpenWeatherMap API v√† l∆∞u tr·ªØ v√†o S3. Nh·ªØng h√†m n√†y s·∫Ω l√† l√µi c·ªßa h·ªá th·ªëng thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt.\nT·∫°i sao c·∫ßn IAM Role? IAM Role gi·ªëng nh∆∞ m·ªôt \u0026ldquo;th·∫ª cƒÉn c∆∞·ªõc\u0026rdquo; cho Lambda function, cho ph√©p n√≥ truy c·∫≠p c√°c d·ªãch v·ª• AWS kh√°c. Kh√¥ng c√≥ IAM Role, Lambda function s·∫Ω:\nKH√îNG TH·ªÇ l∆∞u file v√†o S3\nKH√îNG TH·ªÇ ƒë·ªçc API key t·ª´ Parameter Store\nKH√îNG TH·ªÇ ghi logs v√†o CloudWatch\nKH√îNG TH·ªÇ g·ª≠i metrics cho monitoring\nV·ªõi IAM Role ph√π h·ª£p:\nLambda c√≥ th·ªÉ l∆∞u d·ªØ li·ªáu th·ªùi ti·∫øt v√†o S3\nLambda c√≥ th·ªÉ ƒë·ªçc API key an to√†n\nLambda c√≥ th·ªÉ ghi logs ƒë·ªÉ debug\nLambda c√≥ th·ªÉ g·ª≠i metrics ƒë·ªÉ monitoring\nB∆∞·ªõc 1: T·∫°o IAM Role cho Lambda 1.1 T·∫°o Lambda Execution Role ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn IAM Console\nAWS Console ‚Üí IAM ‚Üí Roles Click \u0026ldquo;Create role\u0026rdquo; Ch·ªçn Trusted Entity\nService: Lambda Click \u0026ldquo;Next\u0026rdquo; C·∫•u h√¨nh Role\nRole Name: WeatherCollectorLambdaRole Description: Execution role for weather data collection Lambda functions 1.2 G·∫Øn AWS Managed Policies AWS Managed Policy l√† g√¨?\nAWS ƒë√£ t·∫°o s·∫µn nhi·ªÅu policies ph·ªï bi·∫øn m√† ch√∫ng ta c√≥ th·ªÉ \u0026ldquo;g·∫Øn\u0026rdquo; (attach) v√†o Role thay v√¨ t·ª± vi·∫øt t·ª´ ƒë·∫ßu. ƒêi·ªÅu n√†y ti·∫øt ki·ªám th·ªùi gian v√† ƒë·∫£m b·∫£o b·∫£o m·∫≠t.\nC√°ch g·∫Øn c√°c policies trong AWS Console:\nKhi t·∫°o Role WeatherCollectorLambdaRole, ·ªü b∆∞·ªõc \u0026ldquo;Add permissions\u0026rdquo; Tab \u0026ldquo;Permissions\u0026rdquo; ‚Üí Click \u0026ldquo;Attach policies directly\u0026rdquo; T√¨m ki·∫øm v√† ch·ªçn t·ª´ng policy sau: ‚úÖ G√µ AWSLambdaBasicExecutionRole ‚Üí tick ch·ªçn ‚úÖ G√µ AmazonS3FullAccess ‚Üí tick ch·ªçn ‚úÖ G√µ AmazonSSMReadOnlyAccess ‚Üí tick ch·ªçn ‚úÖ G√µ CloudWatchAgentServerPolicy ‚Üí tick ch·ªçn Click \u0026ldquo;Add Permissions\u0026rdquo; v√† ho√†n th√†nh t·∫°o role K·∫øt qu·∫£: Role WeatherCollectorLambdaRole s·∫Ω c√≥ 4 managed policies\nPolicy n√†y cho ph√©p Lambda:\nT·∫°o CloudWatch Log Group ƒë·ªÉ ghi logs Ghi logs v√†o CloudWatch khi function ch·∫°y Basic networking ƒë·ªÉ Lambda ho·∫°t ƒë·ªông B∆∞·ªõc 2: T·∫°o S3 Bucket cho D·ªØ li·ªáu Th·ªùi ti·∫øt 2.1 T·∫°o Weather Data Bucket ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn S3 Console\nAWS Console ‚Üí S3 ‚Üí Create bucket C·∫•u h√¨nh Bucket\nBucket Name: weather-data-{your-account-id} (thay th·∫ø b·∫±ng AWS account ID c·ªßa b·∫°n) Region: us-east-1 (ho·∫∑c region ∆∞a th√≠ch c·ªßa b·∫°n) Block Public Access: Gi·ªØ t·∫•t c·∫£ c√†i ƒë·∫∑t ƒë∆∞·ª£c b·∫≠t (khuy·∫øn ngh·ªã) C·∫•u tr√∫c Bucket\nweather-data-123456789012/\r‚îú‚îÄ‚îÄ raw/\r‚îÇ ‚îú‚îÄ‚îÄ current-weather/\r‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ year=2025/month=01/day=03/hour=10/\r‚îÇ ‚îî‚îÄ‚îÄ forecast/\r‚îÇ ‚îî‚îÄ‚îÄ year=2025/month=01/day=03/\r‚îî‚îÄ‚îÄ processed/\r‚îú‚îÄ‚îÄ current-weather/\r‚îî‚îÄ‚îÄ forecast/ B∆∞·ªõc 3: Lambda Function cho Current Weather 3.1 T·∫°o Current Weather Function ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn Lambda Console\nAWS Console ‚Üí Lambda ‚Üí Create function C·∫•u h√¨nh Function\nFunction Name: weather-current-collector Runtime: Python 3.11 Architecture: x86_64 Execution Role: Use existing role ‚Üí WeatherCollectorLambdaRole 3.2 Function Code File: lambda_function.py\nimport json import boto3 import requests import os from datetime import datetime, timezone from typing import Dict, List, Optional import logging # C·∫•u h√¨nh logging logger = logging.getLogger() logger.setLevel(logging.INFO) # AWS clients s3_client = boto3.client(\u0026#39;s3\u0026#39;) ssm_client = boto3.client(\u0026#39;ssm\u0026#39;) cloudwatch = boto3.client(\u0026#39;cloudwatch\u0026#39;) # C·∫•u h√¨nh BUCKET_NAME = os.environ.get(\u0026#39;WEATHER_BUCKET_NAME\u0026#39;) API_KEY_PARAMETER = \u0026#39;/weather-etl/openweathermap/api-key\u0026#39; # C√°c th√†nh ph·ªë m·ª•c ti√™u ƒë·ªÉ thu th·∫≠p th·ªùi ti·∫øt CITIES = [ {\u0026#39;name\u0026#39;: \u0026#39;Ho Chi Minh City\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;VN\u0026#39;, \u0026#39;lat\u0026#39;: 10.8231, \u0026#39;lon\u0026#39;: 106.6297}, {\u0026#39;name\u0026#39;: \u0026#39;Hanoi\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;VN\u0026#39;, \u0026#39;lat\u0026#39;: 21.0285, \u0026#39;lon\u0026#39;: 105.8542}, {\u0026#39;name\u0026#39;: \u0026#39;Singapore\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;SG\u0026#39;, \u0026#39;lat\u0026#39;: 1.3521, \u0026#39;lon\u0026#39;: 103.8198}, {\u0026#39;name\u0026#39;: \u0026#39;Bangkok\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;TH\u0026#39;, \u0026#39;lat\u0026#39;: 13.7563, \u0026#39;lon\u0026#39;: 100.5018}, {\u0026#39;name\u0026#39;: \u0026#39;Jakarta\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;ID\u0026#39;, \u0026#39;lat\u0026#39;: -6.2088, \u0026#39;lon\u0026#39;: 106.8456}, {\u0026#39;name\u0026#39;: \u0026#39;Kuala Lumpur\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;MY\u0026#39;, \u0026#39;lat\u0026#39;: 3.1390, \u0026#39;lon\u0026#39;: 101.6869} ] def get_api_key() -\u0026gt; str: \u0026#34;\u0026#34;\u0026#34;L·∫•y OpenWeatherMap API key t·ª´ Parameter Store.\u0026#34;\u0026#34;\u0026#34; try: response = ssm_client.get_parameter( Name=API_KEY_PARAMETER, WithDecryption=True ) return response[\u0026#39;Parameter\u0026#39;][\u0026#39;Value\u0026#39;] except Exception as e: logger.error(f\u0026#34;Kh√¥ng th·ªÉ l·∫•y API key: {e}\u0026#34;) raise def fetch_current_weather(city: Dict, api_key: str) -\u0026gt; Optional[Dict]: \u0026#34;\u0026#34;\u0026#34;L·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt hi·ªán t·∫°i cho m·ªôt th√†nh ph·ªë.\u0026#34;\u0026#34;\u0026#34; base_url = \u0026#34;https://api.openweathermap.org/data/2.5/weather\u0026#34; params = { \u0026#39;lat\u0026#39;: city[\u0026#39;lat\u0026#39;], \u0026#39;lon\u0026#39;: city[\u0026#39;lon\u0026#39;], \u0026#39;appid\u0026#39;: api_key, \u0026#39;units\u0026#39;: \u0026#39;metric\u0026#39;, \u0026#39;lang\u0026#39;: \u0026#39;vi\u0026#39; } try: response = requests.get(base_url, params=params, timeout=30) response.raise_for_status() data = response.json() # Th√™m metadata data[\u0026#39;collection_timestamp\u0026#39;] = datetime.now(timezone.utc).isoformat() data[\u0026#39;city_metadata\u0026#39;] = city return data except requests.exceptions.RequestException as e: logger.error(f\u0026#34;L·ªói API cho {city[\u0026#39;name\u0026#39;]}: {e}\u0026#34;) return None except json.JSONDecodeError as e: logger.error(f\u0026#34;L·ªói JSON decode cho {city[\u0026#39;name\u0026#39;]}: {e}\u0026#34;) return None def save_to_s3(data: Dict, city_name: str) -\u0026gt; bool: \u0026#34;\u0026#34;\u0026#34;L∆∞u d·ªØ li·ªáu th·ªùi ti·∫øt v√†o S3.\u0026#34;\u0026#34;\u0026#34; try: now = datetime.now(timezone.utc) # T·∫°o S3 key v·ªõi partition theo th·ªùi gian city_safe = city_name.lower().replace(\u0026#39; \u0026#39;, \u0026#39;_\u0026#39;).replace(\u0026#39;.\u0026#39;, \u0026#39;\u0026#39;) key = f\u0026#34;raw/current-weather/year={now.year}/month={now.month:02d}/day={now.day:02d}/hour={now.hour:02d}/{city_safe}_{now.strftime(\u0026#39;%Y%m%d_%H%M%S\u0026#39;)}.json\u0026#34; # Upload file s3_client.put_object( Bucket=BUCKET_NAME, Key=key, Body=json.dumps(data, ensure_ascii=False, indent=2), ContentType=\u0026#39;application/json\u0026#39;, Metadata={ \u0026#39;city\u0026#39;: city_name, \u0026#39;collection_time\u0026#39;: now.isoformat(), \u0026#39;data_type\u0026#39;: \u0026#39;current_weather\u0026#39; } ) logger.info(f\u0026#34;ƒê√£ l∆∞u d·ªØ li·ªáu cho {city_name} t·∫°i {key}\u0026#34;) return True except Exception as e: logger.error(f\u0026#34;L·ªói l∆∞u S3 cho {city_name}: {e}\u0026#34;) return False def send_metrics(metric_name: str, value: float, unit: str = \u0026#39;Count\u0026#39;): \u0026#34;\u0026#34;\u0026#34;G·ª≠i metrics t√πy ch·ªânh t·ªõi CloudWatch.\u0026#34;\u0026#34;\u0026#34; try: cloudwatch.put_metric_data( Namespace=\u0026#39;Weather/ETL\u0026#39;, MetricData=[ { \u0026#39;MetricName\u0026#39;: metric_name, \u0026#39;Value\u0026#39;: value, \u0026#39;Unit\u0026#39;: unit, \u0026#39;Timestamp\u0026#39;: datetime.now(timezone.utc) } ] ) except Exception as e: logger.error(f\u0026#34;L·ªói g·ª≠i metric {metric_name}: {e}\u0026#34;) def lambda_handler(event, context): \u0026#34;\u0026#34;\u0026#34;Handler ch√≠nh cho Lambda function.\u0026#34;\u0026#34;\u0026#34; logger.info(f\u0026#34;B·∫Øt ƒë·∫ßu thu th·∫≠p th·ªùi ti·∫øt: {json.dumps(event)}\u0026#34;) successful_collections = 0 failed_collections = 0 results = [] try: # L·∫•y API key api_key = get_api_key() # Thu th·∫≠p d·ªØ li·ªáu cho t·ª´ng th√†nh ph·ªë for city in CITIES: logger.info(f\u0026#34;Thu th·∫≠p d·ªØ li·ªáu cho {city[\u0026#39;name\u0026#39;]}\u0026#34;) # Fetch weather data weather_data = fetch_current_weather(city, api_key) if weather_data: # L∆∞u v√†o S3 if save_to_s3(weather_data, city[\u0026#39;name\u0026#39;]): successful_collections += 1 results.append({ \u0026#39;city\u0026#39;: city[\u0026#39;name\u0026#39;], \u0026#39;status\u0026#39;: \u0026#39;success\u0026#39;, \u0026#39;temperature\u0026#39;: weather_data.get(\u0026#39;main\u0026#39;, {}).get(\u0026#39;temp\u0026#39;), \u0026#39;description\u0026#39;: weather_data.get(\u0026#39;weather\u0026#39;, [{}])[0].get(\u0026#39;description\u0026#39;) }) else: failed_collections += 1 results.append({ \u0026#39;city\u0026#39;: city[\u0026#39;name\u0026#39;], \u0026#39;status\u0026#39;: \u0026#39;failed\u0026#39;, \u0026#39;error\u0026#39;: \u0026#39;S3 save failed\u0026#39; }) else: failed_collections += 1 results.append({ \u0026#39;city\u0026#39;: city[\u0026#39;name\u0026#39;], \u0026#39;status\u0026#39;: \u0026#39;failed\u0026#39;, \u0026#39;error\u0026#39;: \u0026#39;API fetch failed\u0026#39; }) # G·ª≠i metrics send_metrics(\u0026#39;SuccessfulCollections\u0026#39;, successful_collections) send_metrics(\u0026#39;FailedCollections\u0026#39;, failed_collections) send_metrics(\u0026#39;TotalCollections\u0026#39;, successful_collections + failed_collections) # Log k·∫øt qu·∫£ logger.info(f\u0026#34;Thu th·∫≠p ho√†n t·∫•t - Th√†nh c√¥ng: {successful_collections}, Th·∫•t b·∫°i: {failed_collections}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps({ \u0026#39;message\u0026#39;: \u0026#39;Thu th·∫≠p th·ªùi ti·∫øt ho√†n t·∫•t\u0026#39;, \u0026#39;successful_collections\u0026#39;: successful_collections, \u0026#39;failed_collections\u0026#39;: failed_collections, \u0026#39;results\u0026#39;: results }, ensure_ascii=False) } except Exception as e: logger.error(f\u0026#34;L·ªói trong lambda handler: {e}\u0026#34;) send_metrics(\u0026#39;LambdaErrors\u0026#39;, 1) return { \u0026#39;statusCode\u0026#39;: 500, \u0026#39;body\u0026#39;: json.dumps({ \u0026#39;error\u0026#39;: \u0026#39;L·ªói n·ªôi b·ªô\u0026#39;, \u0026#39;message\u0026#39;: str(e) }, ensure_ascii=False) } 3.3 Bi·∫øn M√¥i tr∆∞·ªùng Trong Lambda Console, th√™m bi·∫øn m√¥i tr∆∞·ªùng:\nWEATHER_BUCKET_NAME: weather-data-{your-account-id} 3.4 C·∫•u h√¨nh Function Memory: 256 MB Timeout: 5 minutes Reserved Concurrency: 2 B∆∞·ªõc 4: Lambda Function cho Weather Forecast 4.1 T·∫°o Forecast Function T·∫°o function m·ªõi Function Name: weather-forecast-collector Runtime: Python 3.11 Execution Role: WeatherCollectorLambdaRole 4.2 Forecast Function Code import json import boto3 import requests import os from datetime import datetime, timezone from typing import Dict, List, Optional import logging logger = logging.getLogger() logger.setLevel(logging.INFO) s3_client = boto3.client(\u0026#39;s3\u0026#39;) ssm_client = boto3.client(\u0026#39;ssm\u0026#39;) cloudwatch = boto3.client(\u0026#39;cloudwatch\u0026#39;) BUCKET_NAME = os.environ.get(\u0026#39;WEATHER_BUCKET_NAME\u0026#39;) API_KEY_PARAMETER = \u0026#39;/weather-etl/openweathermap/api-key\u0026#39; CITIES = [ {\u0026#39;name\u0026#39;: \u0026#39;Ho Chi Minh City\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;VN\u0026#39;, \u0026#39;lat\u0026#39;: 10.8231, \u0026#39;lon\u0026#39;: 106.6297}, {\u0026#39;name\u0026#39;: \u0026#39;Hanoi\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;VN\u0026#39;, \u0026#39;lat\u0026#39;: 21.0285, \u0026#39;lon\u0026#39;: 105.8542}, {\u0026#39;name\u0026#39;: \u0026#39;Singapore\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;SG\u0026#39;, \u0026#39;lat\u0026#39;: 1.3521, \u0026#39;lon\u0026#39;: 103.8198}, {\u0026#39;name\u0026#39;: \u0026#39;Bangkok\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;TH\u0026#39;, \u0026#39;lat\u0026#39;: 13.7563, \u0026#39;lon\u0026#39;: 100.5018}, {\u0026#39;name\u0026#39;: \u0026#39;Jakarta\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;ID\u0026#39;, \u0026#39;lat\u0026#39;: -6.2088, \u0026#39;lon\u0026#39;: 106.8456}, {\u0026#39;name\u0026#39;: \u0026#39;Kuala Lumpur\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;MY\u0026#39;, \u0026#39;lat\u0026#39;: 3.1390, \u0026#39;lon\u0026#39;: 101.6869} ] def get_api_key() -\u0026gt; str: \u0026#34;\u0026#34;\u0026#34;L·∫•y OpenWeatherMap API key t·ª´ Parameter Store.\u0026#34;\u0026#34;\u0026#34; try: response = ssm_client.get_parameter( Name=API_KEY_PARAMETER, WithDecryption=True ) return response[\u0026#39;Parameter\u0026#39;][\u0026#39;Value\u0026#39;] except Exception as e: logger.error(f\u0026#34;Kh√¥ng th·ªÉ l·∫•y API key: {e}\u0026#34;) raise def fetch_weather_forecast(city: Dict, api_key: str) -\u0026gt; Optional[Dict]: \u0026#34;\u0026#34;\u0026#34;L·∫•y d·ªØ li·ªáu d·ª± b√°o th·ªùi ti·∫øt 5 ng√†y cho m·ªôt th√†nh ph·ªë.\u0026#34;\u0026#34;\u0026#34; base_url = \u0026#34;https://api.openweathermap.org/data/2.5/forecast\u0026#34; params = { \u0026#39;lat\u0026#39;: city[\u0026#39;lat\u0026#39;], \u0026#39;lon\u0026#39;: city[\u0026#39;lon\u0026#39;], \u0026#39;appid\u0026#39;: api_key, \u0026#39;units\u0026#39;: \u0026#39;metric\u0026#39;, \u0026#39;lang\u0026#39;: \u0026#39;vi\u0026#39;, \u0026#39;cnt\u0026#39;: 40 # 5 ng√†y x 8 d·ª± b√°o (m·ªói 3 gi·ªù) } try: response = requests.get(base_url, params=params, timeout=30) response.raise_for_status() data = response.json() # Th√™m metadata data[\u0026#39;collection_timestamp\u0026#39;] = datetime.now(timezone.utc).isoformat() data[\u0026#39;city_metadata\u0026#39;] = city return data except requests.exceptions.RequestException as e: logger.error(f\u0026#34;L·ªói API forecast cho {city[\u0026#39;name\u0026#39;]}: {e}\u0026#34;) return None except json.JSONDecodeError as e: logger.error(f\u0026#34;L·ªói JSON decode forecast cho {city[\u0026#39;name\u0026#39;]}: {e}\u0026#34;) return None def save_forecast_to_s3(data: Dict, city_name: str) -\u0026gt; bool: \u0026#34;\u0026#34;\u0026#34;L∆∞u d·ªØ li·ªáu d·ª± b√°o th·ªùi ti·∫øt v√†o S3.\u0026#34;\u0026#34;\u0026#34; try: now = datetime.now(timezone.utc) city_safe = city_name.lower().replace(\u0026#39; \u0026#39;, \u0026#39;_\u0026#39;).replace(\u0026#39;.\u0026#39;, \u0026#39;\u0026#39;) key = f\u0026#34;raw/forecast/year={now.year}/month={now.month:02d}/day={now.day:02d}/{city_safe}_{now.strftime(\u0026#39;%Y%m%d_%H%M%S\u0026#39;)}.json\u0026#34; s3_client.put_object( Bucket=BUCKET_NAME, Key=key, Body=json.dumps(data, ensure_ascii=False, indent=2), ContentType=\u0026#39;application/json\u0026#39;, Metadata={ \u0026#39;city\u0026#39;: city_name, \u0026#39;collection_time\u0026#39;: now.isoformat(), \u0026#39;data_type\u0026#39;: \u0026#39;forecast\u0026#39;, \u0026#39;forecast_count\u0026#39;: str(len(data.get(\u0026#39;list\u0026#39;, []))) } ) logger.info(f\u0026#34;ƒê√£ l∆∞u d·ª± b√°o cho {city_name} t·∫°i {key}\u0026#34;) return True except Exception as e: logger.error(f\u0026#34;L·ªói l∆∞u forecast S3 cho {city_name}: {e}\u0026#34;) return False def lambda_handler(event, context): \u0026#34;\u0026#34;\u0026#34;Handler ch√≠nh cho forecast Lambda function.\u0026#34;\u0026#34;\u0026#34; logger.info(f\u0026#34;B·∫Øt ƒë·∫ßu thu th·∫≠p d·ª± b√°o th·ªùi ti·∫øt: {json.dumps(event)}\u0026#34;) successful_collections = 0 failed_collections = 0 results = [] try: api_key = get_api_key() for city in CITIES: logger.info(f\u0026#34;Thu th·∫≠p d·ª± b√°o cho {city[\u0026#39;name\u0026#39;]}\u0026#34;) forecast_data = fetch_weather_forecast(city, api_key) if forecast_data: if save_forecast_to_s3(forecast_data, city[\u0026#39;name\u0026#39;]): successful_collections += 1 results.append({ \u0026#39;city\u0026#39;: city[\u0026#39;name\u0026#39;], \u0026#39;status\u0026#39;: \u0026#39;success\u0026#39;, \u0026#39;forecast_points\u0026#39;: len(forecast_data.get(\u0026#39;list\u0026#39;, [])) }) else: failed_collections += 1 results.append({ \u0026#39;city\u0026#39;: city[\u0026#39;name\u0026#39;], \u0026#39;status\u0026#39;: \u0026#39;failed\u0026#39;, \u0026#39;error\u0026#39;: \u0026#39;S3 save failed\u0026#39; }) else: failed_collections += 1 results.append({ \u0026#39;city\u0026#39;: city[\u0026#39;name\u0026#39;], \u0026#39;status\u0026#39;: \u0026#39;failed\u0026#39;, \u0026#39;error\u0026#39;: \u0026#39;API fetch failed\u0026#39; }) # G·ª≠i metrics cloudwatch.put_metric_data( Namespace=\u0026#39;Weather/ETL\u0026#39;, MetricData=[ { \u0026#39;MetricName\u0026#39;: \u0026#39;SuccessfulForecastCollections\u0026#39;, \u0026#39;Value\u0026#39;: successful_collections, \u0026#39;Unit\u0026#39;: \u0026#39;Count\u0026#39; }, { \u0026#39;MetricName\u0026#39;: \u0026#39;FailedForecastCollections\u0026#39;, \u0026#39;Value\u0026#39;: failed_collections, \u0026#39;Unit\u0026#39;: \u0026#39;Count\u0026#39; } ] ) logger.info(f\u0026#34;Thu th·∫≠p d·ª± b√°o ho√†n t·∫•t - Th√†nh c√¥ng: {successful_collections}, Th·∫•t b·∫°i: {failed_collections}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps({ \u0026#39;message\u0026#39;: \u0026#39;Thu th·∫≠p d·ª± b√°o th·ªùi ti·∫øt ho√†n t·∫•t\u0026#39;, \u0026#39;successful_collections\u0026#39;: successful_collections, \u0026#39;failed_collections\u0026#39;: failed_collections, \u0026#39;results\u0026#39;: results }, ensure_ascii=False) } except Exception as e: logger.error(f\u0026#34;L·ªói trong forecast lambda handler: {e}\u0026#34;) cloudwatch.put_metric_data( Namespace=\u0026#39;Weather/ETL\u0026#39;, MetricData=[ { \u0026#39;MetricName\u0026#39;: \u0026#39;ForecastLambdaErrors\u0026#39;, \u0026#39;Value\u0026#39;: 1, \u0026#39;Unit\u0026#39;: \u0026#39;Count\u0026#39; } ] ) return { \u0026#39;statusCode\u0026#39;: 500, \u0026#39;body\u0026#39;: json.dumps({ \u0026#39;error\u0026#39;: \u0026#39;L·ªói n·ªôi b·ªô forecast\u0026#39;, \u0026#39;message\u0026#39;: str(e) }, ensure_ascii=False) } B∆∞·ªõc 5: Testing Lambda Functions 5.1 Test Manual Test current weather function\nV√†o Lambda Console ‚Üí weather-current-collector T·∫°o test event v·ªõi payload r·ªóng {} Click \u0026ldquo;Test\u0026rdquo; v√† ki·ªÉm tra logs Test forecast function\nV√†o Lambda Console ‚Üí weather-forecast-collector T·∫°o test event v·ªõi payload r·ªóng {} Click \u0026ldquo;Test\u0026rdquo; v√† ki·ªÉm tra logs 5.2 Verify S3 Data Ki·ªÉm tra d·ªØ li·ªáu trong S3 bucket:\naws s3 ls s3://weather-data-{your-account-id}/raw/ --recursive B·∫°n s·∫Ω th·∫•y c√°c file JSON ƒë∆∞·ª£c t·∫°o trong c·∫•u tr√∫c partition theo th·ªùi gian.\nT√≥m t·∫Øt Trong ph·∫ßn n√†y, ch√∫ng ta ƒë√£:\n‚úÖ T·∫°o IAM roles v√† policies cho Lambda functions\n‚úÖ Thi·∫øt l·∫≠p S3 bucket v·ªõi c·∫•u tr√∫c partition\n‚úÖ X√¢y d·ª±ng Lambda function thu th·∫≠p th·ªùi ti·∫øt hi·ªán t·∫°i\n‚úÖ X√¢y d·ª±ng Lambda function thu th·∫≠p d·ª± b√°o th·ªùi ti·∫øt\n‚úÖ C·∫•u h√¨nh error handling v√† CloudWatch metrics\n‚úÖ Test c√°c functions th√†nh c√¥ng\nTi·∫øp theo: Trong module 2.3, ch√∫ng ta s·∫Ω thi·∫øt l·∫≠p automated scheduling v·ªõi CloudWatch Events ƒë·ªÉ ch·∫°y c√°c functions n√†y theo l·ªãch tr√¨nh.\n"
},
{
	"uri": "//localhost:1313/vi/2-data-collection-openweathermap/2.3-automated-scheduling/",
	"title": "L·∫≠p l·ªãch T·ª± ƒë·ªông v·ªõi CloudWatch Events",
	"tags": [],
	"description": "",
	"content": "L·∫≠p l·ªãch T·ª± ƒë·ªông v·ªõi CloudWatch Events Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω thi·∫øt l·∫≠p l·∫≠p l·ªãch t·ª± ƒë·ªông cho vi·ªác thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt b·∫±ng Amazon CloudWatch Events (gi·ªù ƒë∆∞·ª£c g·ªçi l√† Amazon EventBridge). ƒêi·ªÅu n√†y s·∫Ω ƒë·∫£m b·∫£o c√°c Lambda functions ch·∫°y theo l·ªãch tr√¨nh ƒë·ªÅu ƒë·∫∑n ƒë·ªÉ thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt m·ªôt c√°ch nh·∫•t qu√°n.\nT·ªïng quan Ki·∫øn tr√∫c graph TD A[CloudWatch Events Rules] --\u0026gt; B[Current Weather Schedule\u0026lt;br/\u0026gt;M·ªói Gi·ªù] A --\u0026gt; C[Forecast Schedule\u0026lt;br/\u0026gt;M·ªói 6 Gi·ªù] B --\u0026gt; D[Lambda: weather-current-collector] C --\u0026gt; E[Lambda: weather-forecast-collector] D --\u0026gt; F[S3: Current Weather Data] E --\u0026gt; G[S3: Forecast Data] H[CloudWatch Alarms] --\u0026gt; I[SNS Notifications] style A fill:#e8f5e8 style D fill:#ff9900,stroke:#232f3e,stroke-width:3px style E fill:#ff9900,stroke:#232f3e,stroke-width:3px B∆∞·ªõc 1: T·∫°o CloudWatch Events Rules 1.1 L·ªãch tr√¨nh cho Current Weather Collection ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn CloudWatch Console\nAWS Console ‚Üí CloudWatch ‚Üí Events ‚Üí Rules Click \u0026ldquo;Create rule\u0026rdquo; C·∫•u h√¨nh Event Source\nEvent Source: Schedule Schedule Expression: rate(1 hour) Description: \u0026ldquo;Trigger current weather collection every hour\u0026rdquo; C·∫•u h√¨nh Target\nTarget: Lambda function Function: weather-current-collector Configure input: Constant (JSON text) Input JSON:\n{ \u0026#34;source\u0026#34;: \u0026#34;cloudwatch-events\u0026#34;, \u0026#34;detail-type\u0026#34;: \u0026#34;Scheduled Event\u0026#34;, \u0026#34;detail\u0026#34;: { \u0026#34;collection_type\u0026#34;: \u0026#34;current_weather\u0026#34;, \u0026#34;scheduled_time\u0026#34;: \u0026#34;hourly\u0026#34; } } Chi ti·∫øt Rule Name: weather-current-hourly Description: \u0026ldquo;Thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt hi·ªán t·∫°i h√†ng gi·ªù cho 6 th√†nh ph·ªë\u0026rdquo; State: Enabled 1.2 L·ªãch tr√¨nh cho Weather Forecast Collection T·∫°o Rule th·ª© hai\nEvent Source: Schedule Schedule Expression: rate(6 hours) Description: \u0026ldquo;Trigger weather forecast collection every 6 hours\u0026rdquo; C·∫•u h√¨nh Target\nTarget: Lambda function Function: weather-forecast-collector Input JSON:\n{ \u0026#34;source\u0026#34;: \u0026#34;cloudwatch-events\u0026#34;, \u0026#34;detail-type\u0026#34;: \u0026#34;Scheduled Event\u0026#34;, \u0026#34;detail\u0026#34;: { \u0026#34;collection_type\u0026#34;: \u0026#34;forecast\u0026#34;, \u0026#34;scheduled_time\u0026#34;: \u0026#34;every_6_hours\u0026#34; } } Chi ti·∫øt Rule Name: weather-forecast-6hourly Description: \u0026ldquo;Thu th·∫≠p d·ªØ li·ªáu d·ª± b√°o th·ªùi ti·∫øt 6 gi·ªù m·ªôt l·∫ßn\u0026rdquo; State: Enabled B∆∞·ªõc 2: T√πy ch·ªçn L·∫≠p l·ªãch N√¢ng cao 2.1 S·ª≠ d·ª•ng Cron Expressions ƒê·ªÉ l·∫≠p l·ªãch ch√≠nh x√°c h∆°n, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng cron expressions:\nCurrent Weather t·∫°i c√°c th·ªùi ƒëi·ªÉm c·ª• th·ªÉ:\ncron(0 0,6,12,18 * * ? *) Ch·∫°y l√∫c 00:00, 06:00, 12:00, v√† 18:00 UTC h√†ng ng√†y.\nForecast l√∫c 06:00 v√† 18:00 UTC:\ncron(0 6,18 * * ? *) H√†ng gi·ªù trong gi·ªù l√†m vi·ªác (UTC+7):\ncron(0 1-14 * * ? *) Ch·∫°y h√†ng gi·ªù t·ª´ 01:00 ƒë·∫øn 14:00 UTC (08:00 ƒë·∫øn 21:00 gi·ªù Vi·ªát Nam).\n2.2 L·ªãch tr√¨nh Kh√°c nhau cho C√°c Th√†nh ph·ªë Kh√°c nhau T·∫°o c√°c rules theo th√†nh ph·ªë:\nRule cho C√°c Th√†nh ph·ªë Ch√¢u √Å (UTC+7/+8):\n{ \u0026#34;source\u0026#34;: \u0026#34;cloudwatch-events\u0026#34;, \u0026#34;detail\u0026#34;: { \u0026#34;cities\u0026#34;: [\u0026#34;Ho Chi Minh City\u0026#34;, \u0026#34;Hanoi\u0026#34;, \u0026#34;Singapore\u0026#34;, \u0026#34;Bangkok\u0026#34;], \u0026#34;timezone\u0026#34;: \u0026#34;Asia/Ho_Chi_Minh\u0026#34; } } Schedule: cron(0 1,7,13,19 * * ? *) (Gi·ªù cao ƒëi·ªÉm ·ªü ch√¢u √Å)\nB∆∞·ªõc 3: T·∫°o SNS Topic cho Th√¥ng b√°o 3.1 Thi·∫øt l·∫≠p SNS Topic ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn SNS Console\nAWS Console ‚Üí SNS ‚Üí Topics Click \u0026ldquo;Create topic\u0026rdquo; C·∫•u h√¨nh Topic\nType: Standard Name: weather-collection-alerts Display Name: \u0026ldquo;Weather Collection Alerts\u0026rdquo; T·∫°o Subscription\nProtocol: Email Endpoint: ƒê·ªãa ch·ªâ email c·ªßa b·∫°n X√°c nh·∫≠n subscription qua email 3.2 SNS Topic Policy { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Sid\u0026#34;: \u0026#34;AllowCloudWatchAlarmsToPublish\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;cloudwatch.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;SNS:Publish\u0026#34;, \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:sns:us-east-1:123456789012:weather-collection-alerts\u0026#34; } ] } B∆∞·ªõc 4: Thi·∫øt l·∫≠p Monitoring v√† Alarms 4.1 Lambda Function Alarms Error Rate Alarm:\n{ \u0026#34;AlarmName\u0026#34;: \u0026#34;WeatherCollection-HighErrorRate\u0026#34;, \u0026#34;AlarmDescription\u0026#34;: \u0026#34;T·ª∑ l·ªá l·ªói cao trong c√°c functions thu th·∫≠p th·ªùi ti·∫øt\u0026#34;, \u0026#34;MetricName\u0026#34;: \u0026#34;Errors\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Statistic\u0026#34;: \u0026#34;Sum\u0026#34;, \u0026#34;Period\u0026#34;: 3600, \u0026#34;EvaluationPeriods\u0026#34;: 1, \u0026#34;Threshold\u0026#34;: 2, \u0026#34;ComparisonOperator\u0026#34;: \u0026#34;GreaterThanOrEqualToThreshold\u0026#34;, \u0026#34;Dimensions\u0026#34;: [ { \u0026#34;Name\u0026#34;: \u0026#34;FunctionName\u0026#34;, \u0026#34;Value\u0026#34;: \u0026#34;weather-current-collector\u0026#34; } ], \u0026#34;AlarmActions\u0026#34;: [ \u0026#34;arn:aws:sns:us-east-1:123456789012:weather-collection-alerts\u0026#34; ] } Duration Alarm:\n{ \u0026#34;AlarmName\u0026#34;: \u0026#34;WeatherCollection-LongDuration\u0026#34;, \u0026#34;AlarmDescription\u0026#34;: \u0026#34;Th·ªùi gian th·ª±c thi Lambda qu√° l√¢u\u0026#34;, \u0026#34;MetricName\u0026#34;: \u0026#34;Duration\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Statistic\u0026#34;: \u0026#34;Average\u0026#34;, \u0026#34;Period\u0026#34;: 300, \u0026#34;EvaluationPeriods\u0026#34;: 2, \u0026#34;Threshold\u0026#34;: 240000, \u0026#34;ComparisonOperator\u0026#34;: \u0026#34;GreaterThanThreshold\u0026#34;, \u0026#34;Unit\u0026#34;: \u0026#34;Milliseconds\u0026#34; } 4.2 Custom Metrics Alarms Collection Success Rate:\n{ \u0026#34;AlarmName\u0026#34;: \u0026#34;WeatherCollection-LowSuccessRate\u0026#34;, \u0026#34;AlarmDescription\u0026#34;: \u0026#34;T·ª∑ l·ªá th√†nh c√¥ng thu th·∫≠p th·∫•p\u0026#34;, \u0026#34;MetricName\u0026#34;: \u0026#34;SuccessfulCollections\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;Weather/ETL\u0026#34;, \u0026#34;Statistic\u0026#34;: \u0026#34;Sum\u0026#34;, \u0026#34;Period\u0026#34;: 3600, \u0026#34;EvaluationPeriods\u0026#34;: 1, \u0026#34;Threshold\u0026#34;: 4, \u0026#34;ComparisonOperator\u0026#34;: \u0026#34;LessThanThreshold\u0026#34; } API Call Failures:\n{ \u0026#34;AlarmName\u0026#34;: \u0026#34;WeatherAPI-HighFailureRate\u0026#34;, \u0026#34;AlarmDescription\u0026#34;: \u0026#34;T·ª∑ l·ªá th·∫•t b·∫°i API cao\u0026#34;, \u0026#34;MetricName\u0026#34;: \u0026#34;FailedCollections\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;Weather/ETL\u0026#34;, \u0026#34;Statistic\u0026#34;: \u0026#34;Sum\u0026#34;, \u0026#34;Period\u0026#34;: 1800, \u0026#34;EvaluationPeriods\u0026#34;: 2, \u0026#34;Threshold\u0026#34;: 3, \u0026#34;ComparisonOperator\u0026#34;: \u0026#34;GreaterThanThreshold\u0026#34; } B∆∞·ªõc 5: CloudWatch Dashboard 5.1 T·∫°o Weather ETL Dashboard ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn CloudWatch Console\nAWS Console ‚Üí CloudWatch ‚Üí Dashboards Click \u0026ldquo;Create dashboard\u0026rdquo; Dashboard Configuration\nDashboard Name: Weather-ETL-Monitoring Description: \u0026ldquo;Weather data collection monitoring dashboard\u0026rdquo; 5.2 Dashboard Widgets Widget 1: Collection Success Rate\n{ \u0026#34;type\u0026#34;: \u0026#34;metric\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;metrics\u0026#34;: [ [\u0026#34;Weather/ETL\u0026#34;, \u0026#34;SuccessfulCollections\u0026#34;], [\u0026#34;Weather/ETL\u0026#34;, \u0026#34;FailedCollections\u0026#34;] ], \u0026#34;period\u0026#34;: 3600, \u0026#34;stat\u0026#34;: \u0026#34;Sum\u0026#34;, \u0026#34;region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;T·ª∑ l·ªá Thu th·∫≠p Th√†nh c√¥ng\u0026#34;, \u0026#34;yAxis\u0026#34;: { \u0026#34;left\u0026#34;: { \u0026#34;min\u0026#34;: 0 } } } } Widget 2: Lambda Performance\n{ \u0026#34;type\u0026#34;: \u0026#34;metric\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;metrics\u0026#34;: [ [\u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Duration\u0026#34;, \u0026#34;FunctionName\u0026#34;, \u0026#34;weather-current-collector\u0026#34;], [\u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Duration\u0026#34;, \u0026#34;FunctionName\u0026#34;, \u0026#34;weather-forecast-collector\u0026#34;] ], \u0026#34;period\u0026#34;: 300, \u0026#34;stat\u0026#34;: \u0026#34;Average\u0026#34;, \u0026#34;region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Th·ªùi gian Th·ª±c thi Lambda\u0026#34;, \u0026#34;yAxis\u0026#34;: { \u0026#34;left\u0026#34;: { \u0026#34;min\u0026#34;: 0 } } } } Widget 3: Error Rate\n{ \u0026#34;type\u0026#34;: \u0026#34;metric\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;metrics\u0026#34;: [ [\u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Errors\u0026#34;, \u0026#34;FunctionName\u0026#34;, \u0026#34;weather-current-collector\u0026#34;], [\u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Errors\u0026#34;, \u0026#34;FunctionName\u0026#34;, \u0026#34;weather-forecast-collector\u0026#34;] ], \u0026#34;period\u0026#34;: 3600, \u0026#34;stat\u0026#34;: \u0026#34;Sum\u0026#34;, \u0026#34;region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;T·ª∑ l·ªá L·ªói Lambda\u0026#34; } } B∆∞·ªõc 6: Cost Optimization 6.1 Optimized Scheduling Strategy Gi·ªù cao ƒëi·ªÉm vs. Gi·ªù th·∫•p ƒëi·ªÉm:\nGi·ªù cao ƒëi·ªÉm (7:00-22:00 VN): Thu th·∫≠p m·ªói gi·ªù Gi·ªù th·∫•p ƒëi·ªÉm (22:00-7:00 VN): Thu th·∫≠p m·ªói 3 gi·ªù Cron Expression cho Gi·ªù cao ƒëi·ªÉm:\ncron(0 0-15 * * ? *) Cron Expression cho Gi·ªù th·∫•p ƒëi·ªÉm:\ncron(0 16,19,22 * * ? *) 6.2 Regional Data Collection Khu v·ª±c ƒê√¥ng Nam √Å:\ncron(0 1,7,13,19 * * ? *) Global Collection (bao g·ªìm multiple regions):\ncron(0 0,6,12,18 * * ? *) B∆∞·ªõc 7: Testing Scheduled Execution 7.1 Verify Rule Execution Check CloudWatch Events Console\nAWS Console ‚Üí CloudWatch ‚Üí Events ‚Üí Rules Verify rules are enabled and showing recent invocations Check Lambda Function Metrics\nAWS Console ‚Üí Lambda ‚Üí Functions Check Invocations v√† Duration metrics 7.2 Manual Rule Testing Test Current Weather Rule:\naws events put-events --entries Source=manual-test,DetailType=\u0026#34;Manual Test\u0026#34;,Detail=\u0026#39;{\u0026#34;test\u0026#34;: true}\u0026#39; Check S3 for New Data:\naws s3 ls s3://weather-data-123456789012/raw/current-weather/ --recursive --human-readable Troubleshooting 7.3 Common Issues Rule kh√¥ng trigger:\nKi·ªÉm tra IAM permissions cho CloudWatch Events Verify Lambda function permissions Check rule state (Enabled/Disabled) Lambda timeout:\nTƒÉng timeout setting (hi·ªán t·∫°i: 5 minutes) Optimize code ho·∫∑c gi·∫£m s·ªë l∆∞·ª£ng cities API rate limits:\nMonitor OpenWeatherMap API usage Implement exponential backoff Consider upgrading API plan n·∫øu c·∫ßn T√≥m t·∫Øt Trong ph·∫ßn n√†y, ch√∫ng ta ƒë√£:\n‚úÖ Thi·∫øt l·∫≠p CloudWatch Events rules cho automated scheduling\n‚úÖ C·∫•u h√¨nh l·ªãch tr√¨nh h√†ng gi·ªù cho current weather\n‚úÖ C·∫•u h√¨nh l·ªãch tr√¨nh 6 gi·ªù/l·∫ßn cho forecast data\n‚úÖ T·∫°o SNS topic ƒë·ªÉ nh·∫≠n alerts\n‚úÖ Thi·∫øt l·∫≠p CloudWatch alarms v√† dashboard\n‚úÖ Optimize cost v·ªõi smart scheduling\n‚úÖ Test scheduled execution th√†nh c√¥ng\nTi·∫øp theo: Trong module 2.4, ch√∫ng ta s·∫Ω thi·∫øt l·∫≠p testing v√† monitoring to√†n di·ªán ƒë·ªÉ ƒë·∫£m b·∫£o h·ªá th·ªëng ch·∫°y ·ªïn ƒë·ªãnh v√† ƒë√°ng tin c·∫≠y.\n"
},
{
	"uri": "//localhost:1313/vi/2-data-collection-openweathermap/2.4-testing-monitoring/",
	"title": "Testing v√† Monitoring Thu th·∫≠p Th·ªùi ti·∫øt",
	"tags": [],
	"description": "",
	"content": "Testing v√† Monitoring Thu th·∫≠p Th·ªùi ti·∫øt B√¢y gi·ªù ch√∫ng ta ƒë√£ c√≥ c√°c Lambda functions v√† automated scheduling ƒë∆∞·ª£c c·∫•u h√¨nh, ƒë√£ ƒë·∫øn l√∫c test to√†n di·ªán pipeline thu th·∫≠p th·ªùi ti·∫øt v√† thi·∫øt l·∫≠p monitoring chi ti·∫øt. Ch√∫ng ta s·∫Ω validate data quality, performance, v√† ƒë·∫£m b·∫£o h·ªá th·ªëng ch·∫°y ƒë√°ng tin c·∫≠y.\nT·ªïng quan Testing Strategy Ch√∫ng ta s·∫Ω test h·ªá th·ªëng thu th·∫≠p th·ªùi ti·∫øt b·∫±ng:\nManual Function Testing - G·ªçi Lambda tr·ª±c ti·∫øp Scheduled Execution Testing - Validate CloudWatch Events Data Quality Validation - Ki·ªÉm tra d·ªØ li·ªáu S3 Performance Testing - Ph√¢n t√≠ch load v√† timing Error Scenario Testing - Validate x·ª≠ l√Ω l·ªói graph LR A[Manual Tests] --\u0026gt; B[Lambda Functions] C[Scheduled Tests] --\u0026gt; D[CloudWatch Events] E[Data Quality Tests] --\u0026gt; F[S3 Storage] G[Performance Tests] --\u0026gt; H[CloudWatch Metrics] I[Error Tests] --\u0026gt; J[Error Handling] style B fill:#ff9900,stroke:#232f3e,stroke-width:3px style F fill:#f3e5f5 style H fill:#e8f5e8 B∆∞·ªõc 1: Manual Function Testing 1.1 Test Current Weather Function ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn Lambda Console\nAWS Console ‚Üí Lambda ‚Üí Functions Click weather-current-collector T·∫°o Test Event\n{ \u0026#34;source\u0026#34;: \u0026#34;manual-test\u0026#34;, \u0026#34;detail-type\u0026#34;: \u0026#34;Manual Test Event\u0026#34;, \u0026#34;detail\u0026#34;: { \u0026#34;test_mode\u0026#34;: true, \u0026#34;cities_to_test\u0026#34;: [\u0026#34;Ho Chi Minh City\u0026#34;, \u0026#34;Singapore\u0026#34;] } } Ch·∫°y Test\nClick n√∫t \u0026ldquo;Test\u0026rdquo; ƒê·ª£i execution ho√†n t·∫•t Review k·∫øt qu·∫£ execution K·∫øt qu·∫£ Mong ƒë·ª£i:\n{ \u0026#34;statusCode\u0026#34;: 200, \u0026#34;body\u0026#34;: \u0026#34;{\\\u0026#34;message\\\u0026#34;: \\\u0026#34;Thu th·∫≠p th·ªùi ti·∫øt ho√†n t·∫•t\\\u0026#34;, \\\u0026#34;successful_collections\\\u0026#34;: 6, \\\u0026#34;failed_collections\\\u0026#34;: 0, \\\u0026#34;results\\\u0026#34;: [...]}\u0026#34; } 1.2 Test Weather Forecast Function ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn forecast function\nClick weather-forecast-collector T·∫°o Test Event\n{ \u0026#34;source\u0026#34;: \u0026#34;manual-test\u0026#34;, \u0026#34;detail-type\u0026#34;: \u0026#34;Manual Test Event\u0026#34;, \u0026#34;detail\u0026#34;: { \u0026#34;test_mode\u0026#34;: true, \u0026#34;include_extended_forecast\u0026#34;: true } } Verify Test Results\nKi·ªÉm tra execution logs trong CloudWatch Verify S3 objects ƒë∆∞·ª£c t·∫°o Validate c·∫•u tr√∫c JSON B∆∞·ªõc 2: Data Quality Validation 2.1 S3 Data Structure Verification Ki·ªÉm tra S3 Bucket Structure:\naws s3 ls s3://weather-data-123456789012/ --recursive C·∫•u tr√∫c Mong ƒë·ª£i:\nweather-data-123456789012/ ‚îú‚îÄ‚îÄ raw/ ‚îÇ ‚îú‚îÄ‚îÄ current-weather/ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ year=2025/month=01/day=03/hour=14/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ho_chi_minh_city_20250103_140532.json ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ hanoi_20250103_140534.json ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ singapore_20250103_140536.json ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ bangkok_20250103_140538.json ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ jakarta_20250103_140540.json ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ kuala_lumpur_20250103_140542.json ‚îÇ ‚îî‚îÄ‚îÄ forecast/ ‚îÇ ‚îî‚îÄ‚îÄ year=2025/month=01/day=03/ ‚îÇ ‚îú‚îÄ‚îÄ ho_chi_minh_city_20250103_140612.json ‚îÇ ‚îî‚îÄ‚îÄ ... 2.2 Data Quality Validation Script File: validate_weather_data.py\nimport boto3 import json import pandas as pd from datetime import datetime, timedelta from typing import Dict, List, Optional import logging logging.basicConfig(level=logging.INFO) logger = logging.getLogger(__name__) class WeatherDataValidator: def __init__(self, bucket_name: str): self.s3 = boto3.client(\u0026#39;s3\u0026#39;) self.bucket_name = bucket_name def get_recent_files(self, data_type: str = \u0026#39;current-weather\u0026#39;, hours_back: int = 24) -\u0026gt; List[str]: \u0026#34;\u0026#34;\u0026#34;L·∫•y c√°c file d·ªØ li·ªáu th·ªùi ti·∫øt t·ª´ N gi·ªù tr∆∞·ªõc.\u0026#34;\u0026#34;\u0026#34; files = [] now = datetime.utcnow() for hour_offset in range(hours_back): check_time = now - timedelta(hours=hour_offset) prefix = f\u0026#34;raw/{data_type}/year={check_time.year}/month={check_time.month:02d}/day={check_time.day:02d}/\u0026#34; if data_type == \u0026#39;current-weather\u0026#39;: prefix += f\u0026#34;hour={check_time.hour:02d}/\u0026#34; try: response = self.s3.list_objects_v2( Bucket=self.bucket_name, Prefix=prefix ) for obj in response.get(\u0026#39;Contents\u0026#39;, []): files.append(obj[\u0026#39;Key\u0026#39;]) except Exception as e: logger.warning(f\u0026#34;Kh√¥ng th·ªÉ list objects cho {prefix}: {e}\u0026#34;) return files def validate_current_weather_file(self, file_key: str) -\u0026gt; Dict: \u0026#34;\u0026#34;\u0026#34;Validate m·ªôt file d·ªØ li·ªáu th·ªùi ti·∫øt hi·ªán t·∫°i.\u0026#34;\u0026#34;\u0026#34; try: response = self.s3.get_object(Bucket=self.bucket_name, Key=file_key) data = json.loads(response[\u0026#39;Body\u0026#39;].read()) validation_results = { \u0026#39;file_key\u0026#39;: file_key, \u0026#39;valid\u0026#39;: True, \u0026#39;errors\u0026#39;: [], \u0026#39;warnings\u0026#39;: [] } # Required fields validation required_fields = [ \u0026#39;coord\u0026#39;, \u0026#39;weather\u0026#39;, \u0026#39;main\u0026#39;, \u0026#39;wind\u0026#39;, \u0026#39;clouds\u0026#39;, \u0026#39;dt\u0026#39;, \u0026#39;sys\u0026#39;, \u0026#39;timezone\u0026#39;, \u0026#39;id\u0026#39;, \u0026#39;name\u0026#39;, \u0026#39;cod\u0026#39; ] for field in required_fields: if field not in data: validation_results[\u0026#39;errors\u0026#39;].append(f\u0026#34;Thi·∫øu field b·∫Øt bu·ªôc: {field}\u0026#34;) validation_results[\u0026#39;valid\u0026#39;] = False # Temperature validation if \u0026#39;main\u0026#39; in data and \u0026#39;temp\u0026#39; in data[\u0026#39;main\u0026#39;]: temp = data[\u0026#39;main\u0026#39;][\u0026#39;temp\u0026#39;] if not (-50 \u0026lt;= temp \u0026lt;= 60): # Kho·∫£ng nhi·ªát ƒë·ªô h·ª£p l√Ω (Celsius) validation_results[\u0026#39;warnings\u0026#39;].append(f\u0026#34;Nhi·ªát ƒë·ªô c√≥ v·∫ª b·∫•t th∆∞·ªùng: {temp}¬∞C\u0026#34;) # Humidity validation if \u0026#39;main\u0026#39; in data and \u0026#39;humidity\u0026#39; in data[\u0026#39;main\u0026#39;]: humidity = data[\u0026#39;main\u0026#39;][\u0026#39;humidity\u0026#39;] if not (0 \u0026lt;= humidity \u0026lt;= 100): validation_results[\u0026#39;errors\u0026#39;].append(f\u0026#34;ƒê·ªô ·∫©m kh√¥ng h·ª£p l·ªá: {humidity}%\u0026#34;) validation_results[\u0026#39;valid\u0026#39;] = False # Metadata validation if \u0026#39;collection_timestamp\u0026#39; not in data: validation_results[\u0026#39;warnings\u0026#39;].append(\u0026#34;Thi·∫øu collection_timestamp\u0026#34;) if \u0026#39;city_metadata\u0026#39; not in data: validation_results[\u0026#39;warnings\u0026#39;].append(\u0026#34;Thi·∫øu city_metadata\u0026#34;) return validation_results except Exception as e: return { \u0026#39;file_key\u0026#39;: file_key, \u0026#39;valid\u0026#39;: False, \u0026#39;errors\u0026#39;: [f\u0026#34;L·ªói ƒë·ªçc file: {str(e)}\u0026#34;], \u0026#39;warnings\u0026#39;: [] } def run_validation_report(self) -\u0026gt; Dict: \u0026#34;\u0026#34;\u0026#34;Ch·∫°y b√°o c√°o validation to√†n di·ªán.\u0026#34;\u0026#34;\u0026#34; report = { \u0026#39;timestamp\u0026#39;: datetime.utcnow().isoformat(), \u0026#39;current_weather\u0026#39;: { \u0026#39;total_files\u0026#39;: 0, \u0026#39;valid_files\u0026#39;: 0, \u0026#39;invalid_files\u0026#39;: 0, \u0026#39;warnings\u0026#39;: 0, \u0026#39;details\u0026#39;: [] }, \u0026#39;forecast\u0026#39;: { \u0026#39;total_files\u0026#39;: 0, \u0026#39;valid_files\u0026#39;: 0, \u0026#39;invalid_files\u0026#39;: 0, \u0026#39;warnings\u0026#39;: 0, \u0026#39;details\u0026#39;: [] } } # Validate current weather files current_files = self.get_recent_files(\u0026#39;current-weather\u0026#39;, 24) report[\u0026#39;current_weather\u0026#39;][\u0026#39;total_files\u0026#39;] = len(current_files) for file_key in current_files: validation = self.validate_current_weather_file(file_key) report[\u0026#39;current_weather\u0026#39;][\u0026#39;details\u0026#39;].append(validation) if validation[\u0026#39;valid\u0026#39;]: report[\u0026#39;current_weather\u0026#39;][\u0026#39;valid_files\u0026#39;] += 1 else: report[\u0026#39;current_weather\u0026#39;][\u0026#39;invalid_files\u0026#39;] += 1 if validation[\u0026#39;warnings\u0026#39;]: report[\u0026#39;current_weather\u0026#39;][\u0026#39;warnings\u0026#39;] += len(validation[\u0026#39;warnings\u0026#39;]) # Validate forecast files forecast_files = self.get_recent_files(\u0026#39;forecast\u0026#39;, 24) report[\u0026#39;forecast\u0026#39;][\u0026#39;total_files\u0026#39;] = len(forecast_files) logger.info(f\u0026#34;Validation ho√†n t·∫•t: {report[\u0026#39;current_weather\u0026#39;][\u0026#39;valid_files\u0026#39;]}/{report[\u0026#39;current_weather\u0026#39;][\u0026#39;total_files\u0026#39;]} current weather files h·ª£p l·ªá\u0026#34;) return report # S·ª≠ d·ª•ng validator if __name__ == \u0026#34;__main__\u0026#34;: validator = WeatherDataValidator(\u0026#39;weather-data-123456789012\u0026#39;) report = validator.run_validation_report() print(json.dumps(report, indent=2, ensure_ascii=False)) B∆∞·ªõc 3: Performance Testing 3.1 Load Testing Script File: load_test.py\nimport boto3 import json import time import concurrent.futures from datetime import datetime import logging logger = logging.getLogger(__name__) class LoadTester: def __init__(self): self.lambda_client = boto3.client(\u0026#39;lambda\u0026#39;) self.cloudwatch = boto3.client(\u0026#39;cloudwatch\u0026#39;) def invoke_lambda_function(self, function_name: str, payload: Dict) -\u0026gt; Dict: \u0026#34;\u0026#34;\u0026#34;G·ªçi Lambda function v√† ƒëo th·ªùi gian response.\u0026#34;\u0026#34;\u0026#34; start_time = time.time() try: response = self.lambda_client.invoke( FunctionName=function_name, InvocationType=\u0026#39;RequestResponse\u0026#39;, Payload=json.dumps(payload) ) end_time = time.time() duration = (end_time - start_time) * 1000 # milliseconds return { \u0026#39;success\u0026#39;: True, \u0026#39;duration_ms\u0026#39;: duration, \u0026#39;status_code\u0026#39;: response[\u0026#39;StatusCode\u0026#39;], \u0026#39;function_name\u0026#39;: function_name } except Exception as e: end_time = time.time() duration = (end_time - start_time) * 1000 return { \u0026#39;success\u0026#39;: False, \u0026#39;duration_ms\u0026#39;: duration, \u0026#39;error\u0026#39;: str(e), \u0026#39;function_name\u0026#39;: function_name } def run_concurrent_test(self, function_name: str, concurrent_calls: int = 5) -\u0026gt; List[Dict]: \u0026#34;\u0026#34;\u0026#34;Ch·∫°y nhi·ªÅu lambda calls ƒë·ªìng th·ªùi.\u0026#34;\u0026#34;\u0026#34; results = [] payload = { \u0026#39;source\u0026#39;: \u0026#39;load-test\u0026#39;, \u0026#39;detail-type\u0026#39;: \u0026#39;Load Test Event\u0026#39;, \u0026#39;detail\u0026#39;: {\u0026#39;test_id\u0026#39;: f\u0026#39;load-test-{int(time.time())}\u0026#39;} } with concurrent.futures.ThreadPoolExecutor(max_workers=concurrent_calls) as executor: futures = [ executor.submit(self.invoke_lambda_function, function_name, payload) for _ in range(concurrent_calls) ] for future in concurrent.futures.as_completed(futures): results.append(future.result()) return results def analyze_results(self, results: List[Dict]) -\u0026gt; Dict: \u0026#34;\u0026#34;\u0026#34;Ph√¢n t√≠ch k·∫øt qu·∫£ load test.\u0026#34;\u0026#34;\u0026#34; successful_calls = [r for r in results if r[\u0026#39;success\u0026#39;]] failed_calls = [r for r in results if not r[\u0026#39;success\u0026#39;]] durations = [r[\u0026#39;duration_ms\u0026#39;] for r in successful_calls] analysis = { \u0026#39;total_calls\u0026#39;: len(results), \u0026#39;successful_calls\u0026#39;: len(successful_calls), \u0026#39;failed_calls\u0026#39;: len(failed_calls), \u0026#39;success_rate\u0026#39;: len(successful_calls) / len(results) * 100, \u0026#39;avg_duration_ms\u0026#39;: sum(durations) / len(durations) if durations else 0, \u0026#39;min_duration_ms\u0026#39;: min(durations) if durations else 0, \u0026#39;max_duration_ms\u0026#39;: max(durations) if durations else 0, \u0026#39;errors\u0026#39;: [r[\u0026#39;error\u0026#39;] for r in failed_calls] } return analysis # Ch·∫°y load test if __name__ == \u0026#34;__main__\u0026#34;: tester = LoadTester() print(\u0026#34;üöÄ B·∫Øt ƒë·∫ßu load test cho weather-current-collector...\u0026#34;) results = tester.run_concurrent_test(\u0026#39;weather-current-collector\u0026#39;, 3) analysis = tester.analyze_results(results) print(f\u0026#34;üìä K·∫øt qu·∫£ load test:\u0026#34;) print(f\u0026#34; T·ªïng calls: {analysis[\u0026#39;total_calls\u0026#39;]}\u0026#34;) print(f\u0026#34; Th√†nh c√¥ng: {analysis[\u0026#39;successful_calls\u0026#39;]}\u0026#34;) print(f\u0026#34; Th·∫•t b·∫°i: {analysis[\u0026#39;failed_calls\u0026#39;]}\u0026#34;) print(f\u0026#34; Success rate: {analysis[\u0026#39;success_rate\u0026#39;]:.1f}%\u0026#34;) print(f\u0026#34; Avg duration: {analysis[\u0026#39;avg_duration_ms\u0026#39;]:.0f}ms\u0026#34;) print(f\u0026#34; Min duration: {analysis[\u0026#39;min_duration_ms\u0026#39;]:.0f}ms\u0026#34;) print(f\u0026#34; Max duration: {analysis[\u0026#39;max_duration_ms\u0026#39;]:.0f}ms\u0026#34;) B∆∞·ªõc 4: Error Scenario Testing 4.1 API Key Error Test Test v·ªõi API key kh√¥ng h·ª£p l·ªá:\n# Test script ƒë·ªÉ ki·ªÉm tra error handling khi API key sai import boto3 ssm = boto3.client(\u0026#39;ssm\u0026#39;) # Backup API key hi·ªán t·∫°i original_key = ssm.get_parameter( Name=\u0026#39;/weather-etl/openweathermap/api-key\u0026#39;, WithDecryption=True )[\u0026#39;Parameter\u0026#39;][\u0026#39;Value\u0026#39;] # Set API key kh√¥ng h·ª£p l·ªá ssm.put_parameter( Name=\u0026#39;/weather-etl/openweathermap/api-key\u0026#39;, Value=\u0026#39;invalid-key-12345\u0026#39;, Type=\u0026#39;SecureString\u0026#39;, Overwrite=True ) # Test Lambda function lambda_client = boto3.client(\u0026#39;lambda\u0026#39;) response = lambda_client.invoke( FunctionName=\u0026#39;weather-current-collector\u0026#39;, InvocationType=\u0026#39;RequestResponse\u0026#39;, Payload=\u0026#39;{\u0026#34;source\u0026#34;: \u0026#34;error-test\u0026#34;}\u0026#39; ) print(\u0026#34;Response v·ªõi API key kh√¥ng h·ª£p l·ªá:\u0026#34;, json.loads(response[\u0026#39;Payload\u0026#39;].read())) # Restore original API key ssm.put_parameter( Name=\u0026#39;/weather-etl/openweathermap/api-key\u0026#39;, Value=original_key, Type=\u0026#39;SecureString\u0026#39;, Overwrite=True ) 4.2 Network Timeout Test Test network timeout scenario:\n# Modify Lambda function ƒë·ªÉ simulate network timeout # Th√™m v√†o Lambda function code: def fetch_current_weather_with_timeout(city: Dict, api_key: str) -\u0026gt; Optional[Dict]: \u0026#34;\u0026#34;\u0026#34;Test function v·ªõi timeout ng·∫Øn.\u0026#34;\u0026#34;\u0026#34; base_url = \u0026#34;https://api.openweathermap.org/data/2.5/weather\u0026#34; params = { \u0026#39;lat\u0026#39;: city[\u0026#39;lat\u0026#39;], \u0026#39;lon\u0026#39;: city[\u0026#39;lon\u0026#39;], \u0026#39;appid\u0026#39;: api_key, \u0026#39;units\u0026#39;: \u0026#39;metric\u0026#39; } try: # Timeout r·∫•t ng·∫Øn ƒë·ªÉ force error response = requests.get(base_url, params=params, timeout=0.1) response.raise_for_status() return response.json() except requests.exceptions.Timeout: logger.error(f\u0026#34;Timeout cho {city[\u0026#39;name\u0026#39;]}\u0026#34;) return None except Exception as e: logger.error(f\u0026#34;L·ªói kh√°c cho {city[\u0026#39;name\u0026#39;]}: {e}\u0026#34;) return None B∆∞·ªõc 5: Monitoring Dashboard Setup 5.1 CloudWatch Dashboard JSON Complete dashboard configuration:\n{ \u0026#34;widgets\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;metric\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;metrics\u0026#34;: [ [\u0026#34;Weather/ETL\u0026#34;, \u0026#34;SuccessfulCollections\u0026#34;], [\u0026#34;Weather/ETL\u0026#34;, \u0026#34;FailedCollections\u0026#34;] ], \u0026#34;period\u0026#34;: 3600, \u0026#34;stat\u0026#34;: \u0026#34;Sum\u0026#34;, \u0026#34;region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Thu th·∫≠p Th√†nh c√¥ng vs Th·∫•t b·∫°i\u0026#34;, \u0026#34;yAxis\u0026#34;: { \u0026#34;left\u0026#34;: { \u0026#34;min\u0026#34;: 0 } } } }, { \u0026#34;type\u0026#34;: \u0026#34;metric\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;metrics\u0026#34;: [ [ \u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Duration\u0026#34;, \u0026#34;FunctionName\u0026#34;, \u0026#34;weather-current-collector\u0026#34; ], [ \u0026#34;AWS/Lambda\u0026#34;, \u0026#34;Duration\u0026#34;, \u0026#34;FunctionName\u0026#34;, \u0026#34;weather-forecast-collector\u0026#34; ] ], \u0026#34;period\u0026#34;: 300, \u0026#34;stat\u0026#34;: \u0026#34;Average\u0026#34;, \u0026#34;region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Lambda Duration\u0026#34; } }, { \u0026#34;type\u0026#34;: \u0026#34;log\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;query\u0026#34;: \u0026#34;SOURCE \u0026#39;/aws/lambda/weather-current-collector\u0026#39;\\n| fields @timestamp, @message\\n| filter @message like /ERROR/\\n| sort @timestamp desc\\n| limit 20\u0026#34;, \u0026#34;region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Recent Errors\u0026#34;, \u0026#34;view\u0026#34;: \u0026#34;table\u0026#34; } } ] } B∆∞·ªõc 6: Automated Testing Pipeline 6.1 Daily Health Check Lambda File: health_check_lambda.py\nimport json import boto3 from datetime import datetime, timedelta import logging logger = logging.getLogger() logger.setLevel(logging.INFO) def lambda_handler(event, context): \u0026#34;\u0026#34;\u0026#34;Daily health check cho weather collection system.\u0026#34;\u0026#34;\u0026#34; # Kh·ªüi t·∫°o clients s3 = boto3.client(\u0026#39;s3\u0026#39;) sns = boto3.client(\u0026#39;sns\u0026#39;) cloudwatch = boto3.client(\u0026#39;cloudwatch\u0026#39;) bucket_name = \u0026#39;weather-data-123456789012\u0026#39; sns_topic = \u0026#39;arn:aws:sns:us-east-1:123456789012:weather-collection-alerts\u0026#39; health_status = { \u0026#39;timestamp\u0026#39;: datetime.utcnow().isoformat(), \u0026#39;checks\u0026#39;: [], \u0026#39;overall_status\u0026#39;: \u0026#39;HEALTHY\u0026#39;, \u0026#39;issues\u0026#39;: [] } # Check 1: S3 data freshness try: now = datetime.utcnow() yesterday = now - timedelta(days=1) prefix = f\u0026#34;raw/current-weather/year={yesterday.year}/month={yesterday.month:02d}/day={yesterday.day:02d}/\u0026#34; response = s3.list_objects_v2( Bucket=bucket_name, Prefix=prefix ) file_count = len(response.get(\u0026#39;Contents\u0026#39;, [])) expected_files = 6 * 24 # 6 cities * 24 hours if file_count \u0026lt; expected_files * 0.8: # Allow 20% tolerance health_status[\u0026#39;overall_status\u0026#39;] = \u0026#39;UNHEALTHY\u0026#39; health_status[\u0026#39;issues\u0026#39;].append(f\u0026#34;Thi·∫øu d·ªØ li·ªáu: {file_count}/{expected_files} files\u0026#34;) health_status[\u0026#39;checks\u0026#39;].append({ \u0026#39;name\u0026#39;: \u0026#39;S3 Data Freshness\u0026#39;, \u0026#39;status\u0026#39;: \u0026#39;PASS\u0026#39; if file_count \u0026gt;= expected_files * 0.8 else \u0026#39;FAIL\u0026#39;, \u0026#39;details\u0026#39;: f\u0026#34;{file_count} files cho ng√†y {yesterday.date()}\u0026#34; }) except Exception as e: health_status[\u0026#39;overall_status\u0026#39;] = \u0026#39;UNHEALTHY\u0026#39; health_status[\u0026#39;issues\u0026#39;].append(f\u0026#34;S3 check failed: {str(e)}\u0026#34;) # Check 2: Lambda errors in last 24h try: end_time = datetime.utcnow() start_time = end_time - timedelta(hours=24) response = cloudwatch.get_metric_statistics( Namespace=\u0026#39;AWS/Lambda\u0026#39;, MetricName=\u0026#39;Errors\u0026#39;, Dimensions=[ {\u0026#39;Name\u0026#39;: \u0026#39;FunctionName\u0026#39;, \u0026#39;Value\u0026#39;: \u0026#39;weather-current-collector\u0026#39;} ], StartTime=start_time, EndTime=end_time, Period=3600, Statistics=[\u0026#39;Sum\u0026#39;] ) total_errors = sum([point[\u0026#39;Sum\u0026#39;] for point in response[\u0026#39;Datapoints\u0026#39;]]) if total_errors \u0026gt; 5: # Threshold health_status[\u0026#39;overall_status\u0026#39;] = \u0026#39;UNHEALTHY\u0026#39; health_status[\u0026#39;issues\u0026#39;].append(f\u0026#34;Qu√° nhi·ªÅu Lambda errors: {total_errors}\u0026#34;) health_status[\u0026#39;checks\u0026#39;].append({ \u0026#39;name\u0026#39;: \u0026#39;Lambda Error Rate\u0026#39;, \u0026#39;status\u0026#39;: \u0026#39;PASS\u0026#39; if total_errors \u0026lt;= 5 else \u0026#39;FAIL\u0026#39;, \u0026#39;details\u0026#39;: f\u0026#34;{total_errors} errors trong 24h\u0026#34; }) except Exception as e: health_status[\u0026#39;overall_status\u0026#39;] = \u0026#39;UNHEALTHY\u0026#39; health_status[\u0026#39;issues\u0026#39;].append(f\u0026#34;CloudWatch check failed: {str(e)}\u0026#34;) # G·ª≠i alert n·∫øu c√≥ v·∫•n ƒë·ªÅ if health_status[\u0026#39;overall_status\u0026#39;] == \u0026#39;UNHEALTHY\u0026#39;: message = f\u0026#34;Weather ETL Health Check FAILED\\n\\nIssues:\\n\u0026#34; + \u0026#34;\\n\u0026#34;.join(health_status[\u0026#39;issues\u0026#39;]) sns.publish( TopicArn=sns_topic, Message=message, Subject=\u0026#34;‚ö†Ô∏è Weather ETL Health Check Alert\u0026#34; ) logger.info(f\u0026#34;Health check completed: {health_status[\u0026#39;overall_status\u0026#39;]}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps(health_status, ensure_ascii=False) } 6.2 Schedule Health Check CloudWatch Events Rule cho daily health check:\n{ \u0026#34;Name\u0026#34;: \u0026#34;weather-etl-daily-health-check\u0026#34;, \u0026#34;ScheduleExpression\u0026#34;: \u0026#34;cron(0 8 * * ? *)\u0026#34;, \u0026#34;State\u0026#34;: \u0026#34;ENABLED\u0026#34;, \u0026#34;Description\u0026#34;: \u0026#34;Daily health check l√∫c 8:00 UTC (15:00 VN)\u0026#34;, \u0026#34;Targets\u0026#34;: [ { \u0026#34;Id\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;Arn\u0026#34;: \u0026#34;arn:aws:lambda:us-east-1:123456789012:function:weather-health-check\u0026#34;, \u0026#34;Input\u0026#34;: \u0026#34;{\\\u0026#34;source\\\u0026#34;: \\\u0026#34;daily-health-check\\\u0026#34;}\u0026#34; } ] } T√≥m t·∫Øt Trong ph·∫ßn n√†y, ch√∫ng ta ƒë√£:\n‚úÖ Thi·∫øt l·∫≠p comprehensive testing strategy\n‚úÖ T·∫°o manual v√† automated tests cho Lambda functions\n‚úÖ Implement data quality validation\n‚úÖ Ch·∫°y performance v√† load testing\n‚úÖ Test error scenarios v√† error handling\n‚úÖ Thi·∫øt l·∫≠p CloudWatch monitoring dashboard\n‚úÖ T·∫°o automated daily health checks\n‚úÖ C·∫•u h√¨nh alerts cho issues\nK·∫øt qu·∫£: H·ªá th·ªëng weather collection gi·ªù ƒë√£ c√≥ monitoring v√† testing to√†n di·ªán, ƒë·∫£m b·∫£o ch·∫°y ·ªïn ƒë·ªãnh v√† ƒë√°ng tin c·∫≠y.\nTi·∫øp theo: Trong Module 3, ch√∫ng ta s·∫Ω x√¢y d·ª±ng data processing v√† transformation pipeline ƒë·ªÉ x·ª≠ l√Ω d·ªØ li·ªáu th·ªùi ti·∫øt th√¥ n√†y th√†nh format ph√π h·ª£p cho analysis.\n"
},
{
	"uri": "//localhost:1313/vi/1-introduction/",
	"title": "Gi·ªõi thi·ªáu",
	"tags": [],
	"description": "",
	"content": "X√¢y d·ª±ng ETL Data Pipeline cho ph√¢n t√≠ch th·ªùi ti·∫øt tr√™n AWS M·ª•c ti√™u X√¢y d·ª±ng h·ªá th·ªëng thu th·∫≠p d·ªØ li·ªáu serverless s·ª≠ d·ª•ng AWS Lambda Tri·ªÉn khai quy tr√¨nh chuy·ªÉn ƒë·ªïi v√† x·ª≠ l√Ω d·ªØ li·ªáu L∆∞u tr·ªØ v√† truy v·∫•n d·ªØ li·ªáu s·ª≠ d·ª•ng Amazon S3 v√† Athena T·∫°o tr·ª±c quan h√≥a v·ªõi Amazon QuickSight √Åp d·ª•ng c√°c best practices c·ªßa AWS cho t·ªëi ∆∞u chi ph√≠ v√† d·ªçn d·∫πp t√†i nguy√™n T·ªïng quan Ki·∫øn tr√∫c Pipeline ETL th·ªùi ti·∫øt c·ªßa ch√∫ng ta tu√¢n theo ki·∫øn tr√∫c serverless ƒë∆°n gi·∫£n n√†y: C√°c th√†nh ph·∫ßn ch√≠nh:\nNgu·ªìn d·ªØ li·ªáu: OpenWeatherMap API cho d·ªØ li·ªáu th·ªùi ti·∫øt th·ªùi gian th·ª±c Thu th·∫≠p: AWS Lambda function ƒë·ªÉ l·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt L∆∞u tr·ªØ: Amazon S3 cho c·∫£ d·ªØ li·ªáu th√¥ v√† ƒë√£ x·ª≠ l√Ω X·ª≠ l√Ω: AWS Lambda cho chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu Ph√¢n t√≠ch: Amazon Athena cho truy v·∫•n SQL Tr·ª±c quan h√≥a: Amazon QuickSight cho dashboard Y√™u c·∫ßu Ti√™n quy·∫øt Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu workshop n√†y, h√£y ƒë·∫£m b·∫£o b·∫°n c√≥:\nT√†i kho·∫£n AWS v·ªõi quy·ªÅn truy c·∫≠p qu·∫£n tr·ªã Hi·ªÉu bi·∫øt c∆° b·∫£n v·ªÅ AWS console Hi·ªÉu bi·∫øt v·ªÅ c√°c kh√°i ni·ªám l·∫≠p tr√¨nh c∆° b·∫£n T√†i kho·∫£n OpenWeatherMap (tier mi·ªÖn ph√≠ l√† ƒë·ªß, ·ªü b√†i workshop n√†y em s·ª≠ d·ª•ng Developer plan) "
},
{
	"uri": "//localhost:1313/vi/2-data-collection-openweathermap/",
	"title": "Thu th·∫≠p D·ªØ li·ªáu Th·ªùi ti·∫øt v·ªõi OpenWeatherMap",
	"tags": [],
	"description": "",
	"content": "Trong ph·∫ßn n√†y, ta s·∫Ω h·ªçc c√°ch thi·∫øt l·∫≠p thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt t·ª± ƒë·ªông b·∫±ng OpenWeatherMap API v√† AWS Lambda. ƒê√¢y l√† n·ªÅn t·∫£ng c·ªßa pipeline ETL ph√¢n t√≠ch th·ªùi ti·∫øt, n∆°i ch√∫ng ta s·∫Ω x√¢y d·ª±ng h·ªá th·ªëng thu th·∫≠p d·ªØ li·ªáu serverless ƒë√°ng tin c·∫≠y.\n2.1 OpenWeatherMap Setup Thi·∫øt l·∫≠p API v√† Credentials\nThi·∫øt l·∫≠p t√†i kho·∫£n OpenWeatherMap, l·∫•y API key, v√† c·∫•u h√¨nh Systems Manager Parameter Store ƒë·ªÉ l∆∞u tr·ªØ credentials m·ªôt c√°ch b·∫£o m·∫≠t. B·∫°n s·∫Ω h·ªçc c√°ch qu·∫£n l√Ω API keys v√† test connectivity.\n2.2 Lambda Weather Collector X√¢y d·ª±ng Functions Thu th·∫≠p D·ªØ li·ªáu\nT·∫°o c√°c Lambda functions ƒë·ªÉ thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt hi·ªán t·∫°i v√† d·ª± b√°o t·ª´ OpenWeatherMap API. Bao g·ªìm IAM roles, S3 bucket setup, v√† function code v·ªõi error handling.\n2.3 Automated Scheduling L·∫≠p l·ªãch T·ª± ƒë·ªông v·ªõi CloudWatch Events\nThi·∫øt l·∫≠p CloudWatch Events ƒë·ªÉ ch·∫°y c√°c Lambda functions theo l·ªãch tr√¨nh t·ª± ƒë·ªông. C·∫•u h√¨nh monitoring, alarms, v√† notifications ƒë·ªÉ ƒë·∫£m b·∫£o h·ªá th·ªëng ch·∫°y ·ªïn ƒë·ªãnh.\n2.4 Testing v√† Monitoring Testing v√† Monitoring To√†n di·ªán\nThi·∫øt l·∫≠p testing strategy bao g·ªìm manual testing, data quality validation, performance testing, v√† automated health checks. T·∫°o dashboard ƒë·ªÉ monitor h·ªá th·ªëng.\nKi·∫øn tr√∫c T·ªïng quan graph LR A[OpenWeatherMap API] --\u0026gt; B[Lambda Weather Collector] C[CloudWatch Events] --\u0026gt; B B --\u0026gt; D[S3 Raw Data Storage] B --\u0026gt; E[CloudWatch Logs] F[Systems Manager] --\u0026gt; B G[SNS Alerts] --\u0026gt; H[Email Notifications] I[CloudWatch Alarms] --\u0026gt; G style A fill:#e1f5fe style B fill:#ff9900,stroke:#232f3e,stroke-width:3px style C fill:#e8f5e8 style D fill:#f3e5f5 style E fill:#fff3e0 style F fill:#e0f2f1 Lo·∫°i D·ªØ li·ªáu Thu th·∫≠p Thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt s·∫Ω t·∫≠p trung v√†o:\nTh·ªùi ti·∫øt Hi·ªán t·∫°i: ƒêi·ªÅu ki·ªán th·ªùi gian th·ª±c cho 6 t·ªânh th√†nh ·ªü Vi·ªát Nam l√†: H√† N·ªôi, H·ªì Ch√≠ Minh, ƒê√† N·∫µng, Gia Lai, C·∫ßn Th∆°, Hu·∫ø D·ª± b√°o 5 Ng√†y: D·ª± ƒëo√°n th·ªùi ti·∫øt m·ªói 3 gi·ªù Metadata: Timestamp, location, collection info L·ªãch tr√¨nh Thu th·∫≠p Th·ªùi ti·∫øt Hi·ªán t·∫°i: M·ªói gi·ªù (24 l·∫ßn/ng√†y)\nD·ª± b√°o Th·ªùi ti·∫øt: M·ªói 6 gi·ªù (4 l·∫ßn/ng√†y)\n∆Ø·ªõc t√≠nh Chi ph√≠ D·ªãch v·ª• S·ª≠ d·ª•ng Chi ph√≠ OpenWeatherMap API 1,000 calls/ng√†y Free Lambda Executions 4,000 invocations Free Tier S3 Storage 1 GB d·ªØ li·ªáu th·ªùi ti·∫øt Free Tier CloudWatch Logs 5 GB logs $2.50 T·ªïng ~$2.50/th√°ng OpenWeatherMap cung c·∫•p 1,000 l·ªùi g·ªçi API mi·ªÖn ph√≠ m·ªói ng√†y, ƒë·ªß cho workshop n√†y.\nK·∫øt qu·∫£ Mong ƒë·ª£i Sau khi ho√†n th√†nh module n√†y, b·∫°n s·∫Ω c√≥:\nH·ªá th·ªëng thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt serverless ho·∫°t ƒë·ªông 24/7 D·ªØ li·ªáu th·ªùi ti·∫øt ƒë∆∞·ª£c l∆∞u tr·ªØ c√≥ c·∫•u tr√∫c trong S3 Monitoring v√† alerting system ƒë·∫ßy ƒë·ªß Ki·∫øn th·ª©c v·ªÅ AWS Lambda, CloudWatch Events, v√† S3 integration B·∫Øt ƒë·∫ßu S·∫µn s√†ng x√¢y d·ª±ng h·ªá th·ªëng thu th·∫≠p d·ªØ li·ªáu th·ªùi ti·∫øt? B·∫Øt ƒë·∫ßu v·ªõi 2.1 OpenWeatherMap Setup ƒë·ªÉ thi·∫øt l·∫≠p API v√† credentials.\n"
},
{
	"uri": "//localhost:1313/vi/3-serverless-processing-lambda/",
	"title": "X·ª≠ l√Ω v√† Chuy·ªÉn ƒë·ªïi D·ªØ li·ªáu",
	"tags": [],
	"description": "",
	"content": "X·ª≠ l√Ω v√† Bi·∫øn ƒë·ªïi D·ªØ li·ªáu Trong module n√†y, b·∫°n s·∫Ω x√¢y d·ª±ng m·ªôt h√†m Lambda ƒë·ªÉ x·ª≠ l√Ω v√† bi·∫øn ƒë·ªïi d·ªØ li·ªáu th·ªùi ti·∫øt th√¥ ƒë∆∞·ª£c thu th·∫≠p t·ª´ OpenWeatherMap API th√†nh ƒë·ªãnh d·∫°ng th√¢n thi·ªán h∆°n v·ªõi ph√¢n t√≠ch. B∆∞·ªõc bi·∫øn ƒë·ªïi n√†y l√† c·∫ßn thi·∫øt trong b·∫•t k·ª≥ pipeline ETL n√†o ƒë·ªÉ chu·∫©n b·ªã d·ªØ li·ªáu cho vi·ªác ph√¢n t√≠ch hi·ªáu qu·∫£.\nT·ªïng quan Module D·ªØ li·ªáu th·ªùi ti·∫øt th√¥ t·ª´ API th∆∞·ªùng ch·ª©a c·∫•u tr√∫c l·ªìng nhau ph·ª©c t·∫°p, ƒë·ªãnh d·∫°ng kh√¥ng nh·∫•t qu√°n v√† th√¥ng tin kh√¥ng c·∫ßn thi·∫øt. Trong module n√†y, ch√∫ng ta s·∫Ω bi·∫øn ƒë·ªïi d·ªØ li·ªáu th√¥ n√†y th√†nh ƒë·ªãnh d·∫°ng c√≥ c·∫•u tr√∫c, s·∫°ch s·∫Ω ƒë∆∞·ª£c t·ªëi ∆∞u h√≥a cho ph√¢n t√≠ch.\nTh·ªùi gian: 45-60 ph√∫t\nChi ph√≠: ~$0.50\nNh·ªØng g√¨ b·∫°n s·∫Ω x√¢y d·ª±ng graph LR A[S3 Raw Data] --\u0026gt; B[Lambda Processor] B --\u0026gt; C[S3 Processed Data] D[CloudWatch Events] --\u0026gt; B style B fill:#ff9900,stroke:#232f3e,stroke-width:3px style A fill:#f3e5f5 style C fill:#f3e5f5 ƒêi·ªÅu ki·ªán ti√™n quy·∫øt ƒê√£ ho√†n th√†nh Module 2: Thu th·∫≠p D·ªØ li·ªáu Th·ªùi ti·∫øt D·ªØ li·ªáu th·ªùi ti·∫øt th√¥ ƒë√£ ƒë∆∞·ª£c thu th·∫≠p trong S3 AWS CLI ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh B∆∞·ªõc 1: T·∫°o H√†m Lambda X·ª≠ l√Ω D·ªØ li·ªáu 1.1 T·∫°o Th∆∞ m·ª•c H√†m Lambda T·∫°o th∆∞ m·ª•c m·ªõi cho h√†m Lambda c·ªßa b·∫°n:\nmkdir weather-processor cd weather-processor 1.2 T·∫°o H√†m Lambda Ho√†n ch·ªânh T·∫°o file lambda_function.py v·ªõi m√£ sau:\nimport json import boto3 import datetime import logging from decimal import Decimal import os # C·∫•u h√¨nh logging logger = logging.getLogger() logger.setLevel(logging.INFO) # Kh·ªüi t·∫°o AWS clients s3_client = boto3.client(\u0026#39;s3\u0026#39;) def lambda_handler(event, context): \u0026#34;\u0026#34;\u0026#34; Lambda handler ch√≠nh cho x·ª≠ l√Ω d·ªØ li·ªáu th·ªùi ti·∫øt \u0026#34;\u0026#34;\u0026#34; try: processed_bucket = os.environ[\u0026#39;PROCESSED_BUCKET\u0026#39;] processed_count = 0 # X·ª≠ l√Ω t·ª´ng S3 event record for record in event[\u0026#39;Records\u0026#39;]: try: # Tr√≠ch xu·∫•t bucket v√† key t·ª´ event source_bucket = record[\u0026#39;s3\u0026#39;][\u0026#39;bucket\u0026#39;][\u0026#39;name\u0026#39;] source_key = record[\u0026#39;s3\u0026#39;][\u0026#39;object\u0026#39;][\u0026#39;key\u0026#39;] logger.info(f\u0026#34;ƒêang x·ª≠ l√Ω file: {source_key} t·ª´ bucket: {source_bucket}\u0026#34;) # L·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt th√¥ t·ª´ S3 response = s3_client.get_object(Bucket=source_bucket, Key=source_key) raw_data = json.loads(response[\u0026#39;Body\u0026#39;].read().decode(\u0026#39;utf-8\u0026#39;)) # Bi·∫øn ƒë·ªïi d·ªØ li·ªáu th·ªùi ti·∫øt processed_data = transform_weather_data(raw_data) # T·∫°o key cho file ƒë√£ x·ª≠ l√Ω processed_key = source_key.replace(\u0026#39;raw/\u0026#39;, \u0026#39;processed/\u0026#39;).replace(\u0026#39;.json\u0026#39;, \u0026#39;_processed.json\u0026#39;) # L∆∞u d·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω v√†o S3 s3_client.put_object( Bucket=processed_bucket, Key=processed_key, Body=json.dumps(processed_data, indent=2, default=decimal_default), ContentType=\u0026#39;application/json\u0026#39; ) processed_count += 1 logger.info(f\u0026#34;ƒê√£ x·ª≠ l√Ω v√† l∆∞u th√†nh c√¥ng: {processed_key}\u0026#34;) except Exception as e: logger.error(f\u0026#34;L·ªói x·ª≠ l√Ω record {source_key}: {str(e)}\u0026#34;) continue return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps({ \u0026#39;message\u0026#39;: f\u0026#39;ƒê√£ x·ª≠ l√Ω th√†nh c√¥ng {processed_count} files\u0026#39;, \u0026#39;processedCount\u0026#39;: processed_count }) } except Exception as e: logger.error(f\u0026#34;L·ªói th·ª±c thi Lambda: {str(e)}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 500, \u0026#39;body\u0026#39;: json.dumps({ \u0026#39;error\u0026#39;: str(e) }) } def transform_weather_data(raw_data): \u0026#34;\u0026#34;\u0026#34; Bi·∫øn ƒë·ªïi d·ªØ li·ªáu OpenWeatherMap th√¥ th√†nh ƒë·ªãnh d·∫°ng th√¢n thi·ªán v·ªõi ph√¢n t√≠ch \u0026#34;\u0026#34;\u0026#34; try: # Tr√≠ch xu·∫•t timestamp timestamp = datetime.datetime.fromtimestamp(raw_data[\u0026#39;dt\u0026#39;]).isoformat() + \u0026#39;Z\u0026#39; collection_date = datetime.datetime.fromtimestamp(raw_data[\u0026#39;dt\u0026#39;]).strftime(\u0026#39;%Y-%m-%d\u0026#39;) # Tr√≠ch xu·∫•t th√¥ng tin v·ªã tr√≠ v√† th·ªùi ti·∫øt c∆° b·∫£n processed_data = { \u0026#39;timestamp\u0026#39;: timestamp, \u0026#39;city_name\u0026#39;: raw_data.get(\u0026#39;name\u0026#39;, \u0026#39;Unknown\u0026#39;), \u0026#39;country\u0026#39;: raw_data.get(\u0026#39;sys\u0026#39;, {}).get(\u0026#39;country\u0026#39;, \u0026#39;Unknown\u0026#39;), \u0026#39;latitude\u0026#39;: raw_data.get(\u0026#39;coord\u0026#39;, {}).get(\u0026#39;lat\u0026#39;), \u0026#39;longitude\u0026#39;: raw_data.get(\u0026#39;coord\u0026#39;, {}).get(\u0026#39;lon\u0026#39;), \u0026#39;data_collection_date\u0026#39;: collection_date } # Chuy·ªÉn ƒë·ªïi nhi·ªát ƒë·ªô temp_kelvin = raw_data.get(\u0026#39;main\u0026#39;, {}).get(\u0026#39;temp\u0026#39;) if temp_kelvin: processed_data[\u0026#39;temperature_kelvin\u0026#39;] = temp_kelvin processed_data[\u0026#39;temperature_celsius\u0026#39;] = round(temp_kelvin - 273.15, 2) processed_data[\u0026#39;temperature_fahrenheit\u0026#39;] = round((temp_kelvin - 273.15) * 9/5 + 32, 2) # Nhi·ªát ƒë·ªô c·∫£m nh·∫≠n feels_like_kelvin = raw_data.get(\u0026#39;main\u0026#39;, {}).get(\u0026#39;feels_like\u0026#39;) if feels_like_kelvin: processed_data[\u0026#39;feels_like_celsius\u0026#39;] = round(feels_like_kelvin - 273.15, 2) processed_data[\u0026#39;feels_like_fahrenheit\u0026#39;] = round((feels_like_kelvin - 273.15) * 9/5 + 32, 2) # C√°c th√¥ng s·ªë th·ªùi ti·∫øt kh√°c processed_data.update({ \u0026#39;humidity_percent\u0026#39;: raw_data.get(\u0026#39;main\u0026#39;, {}).get(\u0026#39;humidity\u0026#39;), \u0026#39;pressure_hpa\u0026#39;: raw_data.get(\u0026#39;main\u0026#39;, {}).get(\u0026#39;pressure\u0026#39;), \u0026#39;visibility_meters\u0026#39;: raw_data.get(\u0026#39;visibility\u0026#39;), \u0026#39;uv_index\u0026#39;: raw_data.get(\u0026#39;uvi\u0026#39;) # N·∫øu c√≥ }) # M√¥ t·∫£ th·ªùi ti·∫øt weather_list = raw_data.get(\u0026#39;weather\u0026#39;, []) if weather_list: weather = weather_list[0] processed_data.update({ \u0026#39;weather_id\u0026#39;: weather.get(\u0026#39;id\u0026#39;), \u0026#39;weather_main\u0026#39;: weather.get(\u0026#39;main\u0026#39;), \u0026#39;weather_description\u0026#39;: weather.get(\u0026#39;description\u0026#39;), \u0026#39;weather_icon\u0026#39;: weather.get(\u0026#39;icon\u0026#39;) }) # Th√¥ng tin gi√≥ wind_data = raw_data.get(\u0026#39;wind\u0026#39;, {}) processed_data.update({ \u0026#39;wind_speed_ms\u0026#39;: wind_data.get(\u0026#39;speed\u0026#39;), \u0026#39;wind_direction_deg\u0026#39;: wind_data.get(\u0026#39;deg\u0026#39;), \u0026#39;wind_gust_ms\u0026#39;: wind_data.get(\u0026#39;gust\u0026#39;) }) # Chuy·ªÉn ƒë·ªïi t·ªëc ƒë·ªô gi√≥ sang km/h v√† mph if wind_data.get(\u0026#39;speed\u0026#39;): processed_data[\u0026#39;wind_speed_kmh\u0026#39;] = round(wind_data[\u0026#39;speed\u0026#39;] * 3.6, 2) processed_data[\u0026#39;wind_speed_mph\u0026#39;] = round(wind_data[\u0026#39;speed\u0026#39;] * 2.237, 2) # ƒê·ªô che ph·ªß m√¢y processed_data[\u0026#39;cloud_coverage_percent\u0026#39;] = raw_data.get(\u0026#39;clouds\u0026#39;, {}).get(\u0026#39;all\u0026#39;) # L∆∞·ª£ng m∆∞a (n·∫øu c√≥) rain_data = raw_data.get(\u0026#39;rain\u0026#39;, {}) if rain_data: processed_data[\u0026#39;rain_1h_mm\u0026#39;] = rain_data.get(\u0026#39;1h\u0026#39;) processed_data[\u0026#39;rain_3h_mm\u0026#39;] = rain_data.get(\u0026#39;3h\u0026#39;) snow_data = raw_data.get(\u0026#39;snow\u0026#39;, {}) if snow_data: processed_data[\u0026#39;snow_1h_mm\u0026#39;] = snow_data.get(\u0026#39;1h\u0026#39;) processed_data[\u0026#39;snow_3h_mm\u0026#39;] = snow_data.get(\u0026#39;3h\u0026#39;) # Th√™m c√°c tr∆∞·ªùng d·∫´n xu·∫•t processed_data.update(calculate_derived_fields(processed_data)) return processed_data except Exception as e: logger.error(f\u0026#34;L·ªói bi·∫øn ƒë·ªïi d·ªØ li·ªáu th·ªùi ti·∫øt: {str(e)}\u0026#34;) raise def calculate_derived_fields(data): \u0026#34;\u0026#34;\u0026#34; T√≠nh to√°n c√°c ch·ªâ s·ªë th·ªùi ti·∫øt d·∫´n xu·∫•t \u0026#34;\u0026#34;\u0026#34; derived = {} try: # T√≠nh ch·ªâ s·ªë nhi·ªát (ƒë∆°n gi·∫£n h√≥a) temp_f = data.get(\u0026#39;temperature_fahrenheit\u0026#39;) humidity = data.get(\u0026#39;humidity_percent\u0026#39;) if temp_f and humidity: if temp_f \u0026gt;= 80: # Ch·ªâ s·ªë nhi·ªát ch·ªâ c√≥ √Ω nghƒ©a tr√™n 80¬∞F # C√¥ng th·ª©c ch·ªâ s·ªë nhi·ªát ƒë∆°n gi·∫£n heat_index_f = ( -42.379 + 2.04901523 * temp_f + 10.14333127 * humidity - 0.22475541 * temp_f * humidity - 6.83783e-3 * temp_f**2 - 5.481717e-2 * humidity**2 + 1.22874e-3 * temp_f**2 * humidity + 8.5282e-4 * temp_f * humidity**2 - 1.99e-6 * temp_f**2 * humidity**2 ) derived[\u0026#39;heat_index_fahrenheit\u0026#39;] = round(heat_index_f, 2) derived[\u0026#39;heat_index_celsius\u0026#39;] = round((heat_index_f - 32) * 5/9, 2) # M·ª©c ƒë·ªô tho·∫£i m√°i d·ª±a tr√™n nhi·ªát ƒë·ªô v√† ƒë·ªô ·∫©m temp_c = data.get(\u0026#39;temperature_celsius\u0026#39;) if temp_c and humidity: if temp_c \u0026lt; 10: comfort = \u0026#39;l·∫°nh\u0026#39; elif temp_c \u0026lt; 18: comfort = \u0026#39;m√°t\u0026#39; elif temp_c \u0026lt;= 24 and humidity \u0026lt;= 60: comfort = \u0026#39;tho·∫£i_m√°i\u0026#39; elif temp_c \u0026lt;= 30 and humidity \u0026lt;= 70: comfort = \u0026#39;·∫•m\u0026#39; else: comfort = \u0026#39;n√≥ng\u0026#39; derived[\u0026#39;comfort_level\u0026#39;] = comfort # T√¨nh tr·∫°ng gi√≥ wind_speed_kmh = data.get(\u0026#39;wind_speed_kmh\u0026#39;) if wind_speed_kmh: if wind_speed_kmh \u0026lt; 5: wind_condition = \u0026#39;tƒ©nh_l·∫∑ng\u0026#39; elif wind_speed_kmh \u0026lt; 20: wind_condition = \u0026#39;nh·∫π\u0026#39; elif wind_speed_kmh \u0026lt; 40: wind_condition = \u0026#39;v·ª´a\u0026#39; elif wind_speed_kmh \u0026lt; 60: wind_condition = \u0026#39;m·∫°nh\u0026#39; else: wind_condition = \u0026#39;r·∫•t_m·∫°nh\u0026#39; derived[\u0026#39;wind_condition\u0026#39;] = wind_condition # M·ª©c ƒë·ªô nghi√™m tr·ªçng th·ªùi ti·∫øt weather_main = data.get(\u0026#39;weather_main\u0026#39;, \u0026#39;\u0026#39;).lower() if weather_main: if weather_main in [\u0026#39;thunderstorm\u0026#39;, \u0026#39;tornado\u0026#39;]: severity = \u0026#39;nghi√™m_tr·ªçng\u0026#39; elif weather_main in [\u0026#39;rain\u0026#39;, \u0026#39;snow\u0026#39;, \u0026#39;drizzle\u0026#39;]: severity = \u0026#39;v·ª´a\u0026#39; elif weather_main in [\u0026#39;mist\u0026#39;, \u0026#39;fog\u0026#39;, \u0026#39;haze\u0026#39;]: severity = \u0026#39;nh·∫π\u0026#39; else: severity = \u0026#39;b√¨nh_th∆∞·ªùng\u0026#39; derived[\u0026#39;weather_severity\u0026#39;] = severity return derived except Exception as e: logger.error(f\u0026#34;L·ªói t√≠nh to√°n c√°c tr∆∞·ªùng d·∫´n xu·∫•t: {str(e)}\u0026#34;) return {} def decimal_default(obj): \u0026#34;\u0026#34;\u0026#34; JSON serializer cho c√°c ƒë·ªëi t∆∞·ª£ng kh√¥ng th·ªÉ serialize m·∫∑c ƒë·ªãnh \u0026#34;\u0026#34;\u0026#34; if isinstance(obj, Decimal): return float(obj) raise TypeError 1.3 T·∫°o File Requirements T·∫°o file requirements.txt:\nboto3==1.34.0 B∆∞·ªõc 2: T·∫°o S3 Bucket cho D·ªØ li·ªáu ƒê√£ X·ª≠ l√Ω # T·∫°o bucket cho d·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω aws s3 mb s3://your-weather-processed-bucket-name # B·∫≠t versioning aws s3api put-bucket-versioning \\ --bucket your-weather-processed-bucket-name \\ --versioning-configuration Status=Enabled B∆∞·ªõc 3: ƒê√≥ng g√≥i v√† Tri·ªÉn khai H√†m Lambda 3.1 T·∫°o G√≥i Tri·ªÉn khai # C√†i ƒë·∫∑t dependencies pip install -r requirements.txt -t . # T·∫°o g√≥i tri·ªÉn khai zip -r weather-processor.zip . 3.2 T·∫°o IAM Role cho Lambda T·∫°o file trust-policy.json:\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;lambda.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } T·∫°o file lambda-policy.json:\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;logs:CreateLogGroup\u0026#34;, \u0026#34;logs:CreateLogStream\u0026#34;, \u0026#34;logs:PutLogEvents\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:logs:*:*:*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [\u0026#34;s3:GetObject\u0026#34;, \u0026#34;s3:PutObject\u0026#34;], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:s3:::your-weather-raw-bucket/*\u0026#34;, \u0026#34;arn:aws:s3:::your-weather-processed-bucket/*\u0026#34; ] } ] } T·∫°o IAM role:\n# T·∫°o role aws iam create-role \\ --role-name WeatherProcessorRole \\ --assume-role-policy-document file://trust-policy.json # G·∫Øn policy aws iam put-role-policy \\ --role-name WeatherProcessorRole \\ --policy-name WeatherProcessorPolicy \\ --policy-document file://lambda-policy.json 3.3 Tri·ªÉn khai H√†m Lambda # T·∫°o h√†m Lambda aws lambda create-function \\ --function-name weather-data-processor \\ --runtime python3.9 \\ --role arn:aws:iam::YOUR-ACCOUNT-ID:role/WeatherProcessorRole \\ --handler lambda_function.lambda_handler \\ --zip-file fileb://weather-processor.zip \\ --timeout 60 \\ --memory-size 256 \\ --environment Variables=\u0026#39;{ \u0026#34;PROCESSED_BUCKET\u0026#34;:\u0026#34;your-weather-processed-bucket-name\u0026#34; }\u0026#39; B∆∞·ªõc 4: Thi·∫øt l·∫≠p S3 Event Trigger C·∫•u h√¨nh S3 ƒë·ªÉ k√≠ch ho·∫°t h√†m Lambda khi c√≥ file m·ªõi ƒë∆∞·ª£c upload:\n4.1 Th√™m Quy·ªÅn Lambda cho S3 aws lambda add-permission \\ --function-name weather-data-processor \\ --principal s3.amazonaws.com \\ --statement-id s3-trigger \\ --action lambda:InvokeFunction \\ --source-arn arn:aws:s3:::your-weather-raw-bucket 4.2 T·∫°o S3 Event Notification T·∫°o file notification-config.json:\n{ \u0026#34;LambdaConfigurations\u0026#34;: [ { \u0026#34;Id\u0026#34;: \u0026#34;weather-processor-trigger\u0026#34;, \u0026#34;LambdaFunctionArn\u0026#34;: \u0026#34;arn:aws:lambda:REGION:ACCOUNT-ID:function:weather-data-processor\u0026#34;, \u0026#34;Events\u0026#34;: [\u0026#34;s3:ObjectCreated:*\u0026#34;], \u0026#34;Filter\u0026#34;: { \u0026#34;Key\u0026#34;: { \u0026#34;FilterRules\u0026#34;: [ { \u0026#34;Name\u0026#34;: \u0026#34;prefix\u0026#34;, \u0026#34;Value\u0026#34;: \u0026#34;raw/\u0026#34; }, { \u0026#34;Name\u0026#34;: \u0026#34;suffix\u0026#34;, \u0026#34;Value\u0026#34;: \u0026#34;.json\u0026#34; } ] } } } ] } √Åp d·ª•ng c·∫•u h√¨nh:\naws s3api put-bucket-notification-configuration \\ --bucket your-weather-raw-bucket \\ --notification-configuration file://notification-config.json B∆∞·ªõc 5: Ki·ªÉm tra X·ª≠ l√Ω D·ªØ li·ªáu 5.1 Ki·ªÉm tra Th·ªß c√¥ng Ki·ªÉm tra v·ªõi file d·ªØ li·ªáu th·ªùi ti·∫øt m·∫´u:\n# Upload file test ƒë·ªÉ k√≠ch ho·∫°t x·ª≠ l√Ω aws s3 cp test-weather-data.json s3://your-weather-raw-bucket/raw/test-weather-data.json 5.2 Ki·ªÉm tra CloudWatch Logs # Xem logs c·ªßa Lambda aws logs describe-log-groups --log-group-name-prefix /aws/lambda/weather-data-processor 5.3 X√°c minh D·ªØ li·ªáu ƒê√£ X·ª≠ l√Ω # Li·ªát k√™ c√°c file ƒë√£ x·ª≠ l√Ω aws s3 ls s3://your-weather-processed-bucket/processed/ # T·∫£i v√† ki·ªÉm tra d·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω aws s3 cp s3://your-weather-processed-bucket/processed/test-weather-data_processed.json . cat test-weather-data_processed.json | jq . V√≠ d·ª• bi·∫øn ƒë·ªïi d·ªØ li·ªáu D·ªØ li·ªáu OpenWeatherMap th√¥ { \u0026#34;coord\u0026#34;: { \u0026#34;lon\u0026#34;: 106.6297, \u0026#34;lat\u0026#34;: 10.8231 }, \u0026#34;weather\u0026#34;: [ { \u0026#34;id\u0026#34;: 803, \u0026#34;main\u0026#34;: \u0026#34;Clouds\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;broken clouds\u0026#34;, \u0026#34;icon\u0026#34;: \u0026#34;04d\u0026#34; } ], \u0026#34;main\u0026#34;: { \u0026#34;temp\u0026#34;: 305.15, \u0026#34;feels_like\u0026#34;: 309.65, \u0026#34;temp_min\u0026#34;: 305.15, \u0026#34;temp_max\u0026#34;: 305.15, \u0026#34;pressure\u0026#34;: 1013, \u0026#34;humidity\u0026#34;: 74 }, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: 3.2, \u0026#34;deg\u0026#34;: 220 }, \u0026#34;clouds\u0026#34;: { \u0026#34;all\u0026#34;: 75 }, \u0026#34;dt\u0026#34;: 1642248000, \u0026#34;sys\u0026#34;: { \u0026#34;country\u0026#34;: \u0026#34;VN\u0026#34;, \u0026#34;sunrise\u0026#34;: 1642203600, \u0026#34;sunset\u0026#34;: 1642245600 }, \u0026#34;timezone\u0026#34;: 25200, \u0026#34;id\u0026#34;: 1566083, \u0026#34;name\u0026#34;: \u0026#34;Ho Chi Minh City\u0026#34; } D·ªØ li·ªáu ƒë√£ bi·∫øn ƒë·ªïi { \u0026#34;timestamp\u0026#34;: \u0026#34;2025-01-15T09:00:00Z\u0026#34;, \u0026#34;city_name\u0026#34;: \u0026#34;Ho Chi Minh City\u0026#34;, \u0026#34;country\u0026#34;: \u0026#34;VN\u0026#34;, \u0026#34;latitude\u0026#34;: 10.8231, \u0026#34;longitude\u0026#34;: 106.6297, \u0026#34;temperature_celsius\u0026#34;: 32.0, \u0026#34;temperature_fahrenheit\u0026#34;: 89.6, \u0026#34;feels_like_celsius\u0026#34;: 36.5, \u0026#34;feels_like_fahrenheit\u0026#34;: 97.7, \u0026#34;humidity_percent\u0026#34;: 74, \u0026#34;pressure_hpa\u0026#34;: 1013, \u0026#34;weather_main\u0026#34;: \u0026#34;Clouds\u0026#34;, \u0026#34;weather_description\u0026#34;: \u0026#34;broken clouds\u0026#34;, \u0026#34;wind_speed_ms\u0026#34;: 3.2, \u0026#34;wind_speed_kmh\u0026#34;: 11.52, \u0026#34;wind_speed_mph\u0026#34;: 7.16, \u0026#34;wind_direction_deg\u0026#34;: 220, \u0026#34;cloud_coverage_percent\u0026#34;: 75, \u0026#34;heat_index_celsius\u0026#34;: 38.2, \u0026#34;heat_index_fahrenheit\u0026#34;: 100.8, \u0026#34;comfort_level\u0026#34;: \u0026#34;n√≥ng\u0026#34;, \u0026#34;wind_condition\u0026#34;: \u0026#34;nh·∫π\u0026#34;, \u0026#34;weather_severity\u0026#34;: \u0026#34;b√¨nh_th∆∞·ªùng\u0026#34;, \u0026#34;data_collection_date\u0026#34;: \u0026#34;2025-01-15\u0026#34; } Gi√°m s√°t v√† Kh·∫Øc ph·ª•c S·ª± c·ªë CloudWatch Metrics Gi√°m s√°t c√°c ch·ªâ s·ªë quan tr·ªçng:\nS·ªë l·∫ßn g·ªçi Lambda L·ªói v√† th·ªùi gian th·ª±c thi Metrics c·ªßa S3 bucket C√°c V·∫•n ƒë·ªÅ Th∆∞·ªùng g·∫∑p L·ªói Quy·ªÅn: ƒê·∫£m b·∫£o Lambda c√≥ quy·ªÅn S3 th√≠ch h·ª£p V·∫•n ƒë·ªÅ B·ªô nh·ªõ: TƒÉng b·ªô nh·ªõ Lambda n·∫øu x·ª≠ l√Ω file l·ªõn Timeout: ƒêi·ªÅu ch·ªânh timeout Lambda cho c√°c bi·∫øn ƒë·ªïi ph·ª©c t·∫°p L·ª£i √≠ch c·ªßa bi·∫øn ƒë·ªïi d·ªØ li·ªáu C·∫£i thi·ªán hi·ªáu su·∫•t truy v·∫•n: C·∫•u tr√∫c ph·∫≥ng d·ªÖ truy v·∫•n h∆°n Gi·∫£m chi ph√≠ l∆∞u tr·ªØ: ƒê·ªãnh d·∫°ng d·ªØ li·ªáu t·ªëi ∆∞u s·ª≠ d·ª•ng √≠t dung l∆∞·ª£ng h∆°n N√¢ng cao ph√¢n t√≠ch: C√°c tr∆∞·ªùng d·∫´n xu·∫•t cho ph√©p hi·ªÉu s√¢u h∆°n Ch·∫•t l∆∞·ª£ng d·ªØ li·ªáu t·ªët h∆°n: X√°c th·ª±c ƒë·∫£m b·∫£o d·ªØ li·ªáu ƒë√°ng tin c·∫≠y C√°c b∆∞·ªõc ti·∫øp theo Sau khi ho√†n th√†nh module n√†y, b·∫°n s·∫Ω c√≥ m·ªôt pipeline bi·∫øn ƒë·ªïi d·ªØ li·ªáu ho·∫°t ƒë·ªông ƒë·∫ßy ƒë·ªß ƒë·ªÉ chu·∫©n b·ªã d·ªØ li·ªáu th·ªùi ti·∫øt c·ªßa b·∫°n cho ph√¢n t√≠ch. Trong module ti·∫øp theo, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng Amazon Athena ƒë·ªÉ truy v·∫•n v√† ph√¢n t√≠ch d·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω n√†y.\nBi·∫øn ƒë·ªïi d·ªØ li·ªáu l√† n∆°i b·∫°n c√≥ th·ªÉ th√™m ki·∫øn th·ª©c chuy√™n ng√†nh c·ªßa m√¨nh. H√£y xem x√©t c√°c ch·ªâ s·ªë th·ªùi ti·∫øt b·ªï sung n√†o c√≥ th·ªÉ h·ªØu √≠ch cho nhu c·∫ßu ph√¢n t√≠ch c·ª• th·ªÉ c·ªßa b·∫°n.\nNh·ªõ thay th·∫ø c√°c gi√° tr·ªã placeholder (YOUR-ACCOUNT-ID, REGION, t√™n bucket) b·∫±ng th√¥ng tin AWS account th·ª±c t·∫ø c·ªßa b·∫°n.\n"
},
{
	"uri": "//localhost:1313/vi/4-data-storage-solutions/",
	"title": "Ph√¢n t√≠ch D·ªØ li·ªáu v·ªõi Athena",
	"tags": [],
	"description": "",
	"content": "Ph√¢n t√≠ch D·ªØ li·ªáu v·ªõi Athena Trong module n√†y, b·∫°n s·∫Ω h·ªçc c√°ch s·ª≠ d·ª•ng Amazon Athena ƒë·ªÉ ch·∫°y c√°c truy v·∫•n SQL tr·ª±c ti·∫øp tr√™n d·ªØ li·ªáu th·ªùi ti·∫øt ƒë√£ x·ª≠ l√Ω ƒë∆∞·ª£c l∆∞u tr·ªØ trong S3. Athena l√† d·ªãch v·ª• truy v·∫•n serverless gi√∫p d·ªÖ d√†ng ph√¢n t√≠ch d·ªØ li·ªáu b·∫±ng SQL ti√™u chu·∫©n m√† kh√¥ng c·∫ßn thi·∫øt l·∫≠p c∆° s·ªü h·∫° t·∫ßng kho d·ªØ li·ªáu ph·ª©c t·∫°p.\nT·ªïng quan Module Amazon Athena cho ph√©p b·∫°n ph√¢n t√≠ch d·ªØ li·ªáu trong S3 b·∫±ng c√°c truy v·∫•n SQL ti√™u chu·∫©n m√† kh√¥ng c·∫ßn ph·∫£i di chuy·ªÉn d·ªØ li·ªáu ho·∫∑c thi·∫øt l·∫≠p m√°y ch·ªß. ƒêi·ªÅu n√†y l√†m cho n√≥ tr·ªü th√†nh c√¥ng c·ª• l√Ω t∆∞·ªüng ƒë·ªÉ ph√¢n t√≠ch d·ªØ li·ªáu th·ªùi ti·∫øt c·ªßa b·∫°n. Trong module n√†y, ch√∫ng ta s·∫Ω thi·∫øt l·∫≠p Athena ƒë·ªÉ truy v·∫•n d·ªØ li·ªáu th·ªùi ti·∫øt ƒë√£ x·ª≠ l√Ω v√† tr√≠ch xu·∫•t nh·ªØng hi·ªÉu bi·∫øt c√≥ √Ω nghƒ©a.\nTh·ªùi gian: 40-50 ph√∫t\nChi ph√≠: ~$0.50\nNh·ªØng g√¨ b·∫°n s·∫Ω x√¢y d·ª±ng graph LR\rA[S3 Processed Data] --\u0026gt; B[Athena Query Service]\rB --\u0026gt; C[SQL Analysis]\rC --\u0026gt; D[Weather Insights]\rstyle B fill:#4fc3f7,stroke:#232f3e,stroke-width:3px\rstyle A fill:#f3e5f5\rstyle D fill:#66bb6a ƒêi·ªÅu ki·ªán ti√™n quy·∫øt ƒê√£ ho√†n th√†nh Module 3: X·ª≠ l√Ω v√† Chuy·ªÉn ƒë·ªïi D·ªØ li·ªáu D·ªØ li·ªáu th·ªùi ti·∫øt ƒë√£ x·ª≠ l√Ω c√≥ s·∫µn trong S3 Truy c·∫≠p AWS Console B∆∞·ªõc 1: Thi·∫øt l·∫≠p V·ªã tr√≠ K·∫øt qu·∫£ Truy v·∫•n Athena Tr∆∞·ªõc khi s·ª≠ d·ª•ng Athena, b·∫°n c·∫ßn c·∫•u h√¨nh v·ªã tr√≠ ƒë·ªÉ l∆∞u tr·ªØ k·∫øt qu·∫£ truy v·∫•n.\n1.1 T·∫°o S3 Bucket cho K·∫øt qu·∫£ Truy v·∫•n # T·∫°o bucket cho k·∫øt qu·∫£ truy v·∫•n Athena aws s3 mb s3://your-athena-query-results-bucket # T√πy ch·ªçn: Thi·∫øt l·∫≠p lifecycle policy ƒë·ªÉ x√≥a k·∫øt qu·∫£ c≈© sau 30 ng√†y cat \u0026gt; lifecycle-policy.json \u0026lt;\u0026lt; EOF { \u0026#34;Rules\u0026#34;: [ { \u0026#34;ID\u0026#34;: \u0026#34;DeleteOldQueryResults\u0026#34;, \u0026#34;Status\u0026#34;: \u0026#34;Enabled\u0026#34;, \u0026#34;Filter\u0026#34;: {\u0026#34;Prefix\u0026#34;: \u0026#34;\u0026#34;}, \u0026#34;Expiration\u0026#34;: {\u0026#34;Days\u0026#34;: 30} } ] } EOF aws s3api put-bucket-lifecycle-configuration \\ --bucket your-athena-query-results-bucket \\ --lifecycle-configuration file://lifecycle-policy.json 1.2 C·∫•u h√¨nh V·ªã tr√≠ K·∫øt qu·∫£ Truy v·∫•n Athena M·ªü Amazon Athena console Nh·∫•p Settings ·ªü g√≥c ph·∫£i tr√™n Nh·∫•p Manage Nh·∫≠p ƒë∆∞·ªùng d·∫´n S3 bucket: s3://your-athena-query-results-bucket/ Nh·∫•p Save B∆∞·ªõc 2: T·∫°o Database v√† Table 2.1 T·∫°o Weather Analytics Database Trong Athena Query Editor, ch·∫°y:\nCREATE DATABASE IF NOT EXISTS weather_analytics COMMENT \u0026#39;Database for weather data analysis\u0026#39; LOCATION \u0026#39;s3://your-athena-query-results-bucket/databases/weather_analytics/\u0026#39;; 2.2 T·∫°o External Table cho D·ªØ li·ªáu Th·ªùi ti·∫øt ƒê√£ X·ª≠ l√Ω CREATE EXTERNAL TABLE IF NOT EXISTS weather_analytics.current_weather ( timestamp STRING, city_name STRING, country STRING, latitude DOUBLE, longitude DOUBLE, data_collection_date STRING, temperature_kelvin DOUBLE, temperature_celsius DOUBLE, temperature_fahrenheit DOUBLE, feels_like_celsius DOUBLE, feels_like_fahrenheit DOUBLE, humidity_percent INT, pressure_hpa INT, visibility_meters BIGINT, uv_index DOUBLE, weather_id INT, weather_main STRING, weather_description STRING, weather_icon STRING, wind_speed_ms DOUBLE, wind_speed_kmh DOUBLE, wind_speed_mph DOUBLE, wind_direction_deg INT, wind_gust_ms DOUBLE, cloud_coverage_percent INT, rain_1h_mm DOUBLE, rain_3h_mm DOUBLE, snow_1h_mm DOUBLE, snow_3h_mm DOUBLE, heat_index_fahrenheit DOUBLE, heat_index_celsius DOUBLE, comfort_level STRING, wind_condition STRING, weather_severity STRING ) ROW FORMAT SERDE \u0026#39;org.openx.data.jsonserde.JsonSerDe\u0026#39; WITH SERDEPROPERTIES ( \u0026#39;serialization.format\u0026#39; = \u0026#39;1\u0026#39; ) LOCATION \u0026#39;s3://your-weather-processed-bucket/processed/\u0026#39; TBLPROPERTIES ( \u0026#39;has_encrypted_data\u0026#39;=\u0026#39;false\u0026#39;, \u0026#39;projection.enabled\u0026#39;=\u0026#39;true\u0026#39;, \u0026#39;projection.data_collection_date.type\u0026#39;=\u0026#39;date\u0026#39;, \u0026#39;projection.data_collection_date.range\u0026#39;=\u0026#39;2025-01-01,NOW\u0026#39;, \u0026#39;projection.data_collection_date.format\u0026#39;=\u0026#39;yyyy-MM-dd\u0026#39;, \u0026#39;storage.location.template\u0026#39;=\u0026#39;s3://your-weather-processed-bucket/processed/year=${data_collection_date}\u0026#39; ); 2.3 X√°c minh T·∫°o Table -- Ki·ªÉm tra xem table ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng ch∆∞a SHOW TABLES IN weather_analytics; -- L·∫•y schema c·ªßa table DESCRIBE weather_analytics.current_weather; -- ƒê·∫øm t·ªïng s·ªë b·∫£n ghi SELECT COUNT(*) as total_records FROM weather_analytics.current_weather; B∆∞·ªõc 3: Ph√¢n t√≠ch D·ªØ li·ªáu Th·ªùi ti·∫øt C∆° b·∫£n 3.1 Truy v·∫•n Kh√°m ph√° D·ªØ li·ªáu Xem D·ªØ li·ªáu M·∫´u -- L·∫•y m·∫´u d·ªØ li·ªáu c·ªßa b·∫°n SELECT * FROM weather_analytics.current_weather LIMIT 10; Ki·ªÉm tra Ch·∫•t l∆∞·ª£ng D·ªØ li·ªáu -- Ki·ªÉm tra gi√° tr·ªã thi·∫øu trong c√°c tr∆∞·ªùng ch√≠nh SELECT COUNT(*) as total_records, COUNT(temperature_celsius) as temp_records, COUNT(humidity_percent) as humidity_records, COUNT(pressure_hpa) as pressure_records, COUNT(wind_speed_ms) as wind_records FROM weather_analytics.current_weather; Ph√¢n t√≠ch Ph·∫°m vi Ng√†y -- Ki·ªÉm tra ph·∫°m vi ng√†y c·ªßa d·ªØ li·ªáu SELECT MIN(data_collection_date) as earliest_date, MAX(data_collection_date) as latest_date, COUNT(DISTINCT data_collection_date) as unique_dates FROM weather_analytics.current_weather; 3.2 Ph√¢n t√≠ch Nhi·ªát ƒë·ªô Nhi·ªát ƒë·ªô Trung b√¨nh theo Th√†nh ph·ªë SELECT city_name, country, COUNT(*) as measurement_count, ROUND(AVG(temperature_celsius), 2) as avg_temp_celsius, ROUND(MIN(temperature_celsius), 2) as min_temp_celsius, ROUND(MAX(temperature_celsius), 2) as max_temp_celsius FROM weather_analytics.current_weather GROUP BY city_name, country ORDER BY avg_temp_celsius DESC; Xu h∆∞·ªõng Nhi·ªát ƒë·ªô Theo Th·ªùi gian SELECT data_collection_date, city_name, ROUND(AVG(temperature_celsius), 2) as avg_temp, ROUND(AVG(feels_like_celsius), 2) as avg_feels_like FROM weather_analytics.current_weather WHERE data_collection_date \u0026gt;= DATE(\u0026#39;2025-01-01\u0026#39;) GROUP BY data_collection_date, city_name ORDER BY data_collection_date, city_name; Ph√¢n t√≠ch Ch·ªâ s·ªë Nhi·ªát SELECT city_name, ROUND(AVG(heat_index_celsius), 2) as avg_heat_index, comfort_level, COUNT(*) as occurrence_count FROM weather_analytics.current_weather WHERE heat_index_celsius IS NOT NULL GROUP BY city_name, comfort_level ORDER BY avg_heat_index DESC; 3.3 Ph√¢n t√≠ch M·∫´u Th·ªùi ti·∫øt Ph√¢n b·ªë ƒêi·ªÅu ki·ªán Th·ªùi ti·∫øt SELECT weather_main, weather_description, COUNT(*) as occurrence_count, ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percentage FROM weather_analytics.current_weather GROUP BY weather_main, weather_description ORDER BY occurrence_count DESC; Ph√¢n t√≠ch Gi√≥ SELECT city_name, wind_condition, COUNT(*) as occurrence_count, ROUND(AVG(wind_speed_kmh), 2) as avg_wind_speed_kmh, ROUND(MAX(wind_speed_kmh), 2) as max_wind_speed_kmh FROM weather_analytics.current_weather GROUP BY city_name, wind_condition ORDER BY city_name, avg_wind_speed_kmh DESC; T∆∞∆°ng quan ƒê·ªô ·∫©m v√† Nhi·ªát ƒë·ªô SELECT city_name, CASE WHEN temperature_celsius \u0026lt; 15 THEN \u0026#39;L·∫°nh\u0026#39; WHEN temperature_celsius \u0026lt; 25 THEN \u0026#39;V·ª´a\u0026#39; ELSE \u0026#39;N√≥ng\u0026#39; END as temp_category, ROUND(AVG(humidity_percent), 2) as avg_humidity, ROUND(AVG(temperature_celsius), 2) as avg_temperature, COUNT(*) as sample_count FROM weather_analytics.current_weather GROUP BY city_name, CASE WHEN temperature_celsius \u0026lt; 15 THEN \u0026#39;L·∫°nh\u0026#39; WHEN temperature_celsius \u0026lt; 25 THEN \u0026#39;V·ª´a\u0026#39; ELSE \u0026#39;N√≥ng\u0026#39; END ORDER BY city_name, temp_category; B∆∞·ªõc 4: Truy v·∫•n Ph√¢n t√≠ch N√¢ng cao 4.1 Ph√¢n t√≠ch Chu·ªói Th·ªùi gian T√≥m t·∫Øt Th·ªùi ti·∫øt H√†ng ng√†y SELECT data_collection_date, COUNT(DISTINCT city_name) as cities_measured, ROUND(AVG(temperature_celsius), 2) as global_avg_temp, ROUND(AVG(humidity_percent), 2) as global_avg_humidity, ROUND(AVG(pressure_hpa), 2) as global_avg_pressure FROM weather_analytics.current_weather GROUP BY data_collection_date ORDER BY data_collection_date; C·ª±c tr·ªã Th·ªùi ti·∫øt -- T√¨m c·ª±c tr·ªã nhi·ªát ƒë·ªô WITH temp_extremes AS ( SELECT data_collection_date, city_name, temperature_celsius, ROW_NUMBER() OVER (PARTITION BY data_collection_date ORDER BY temperature_celsius DESC) as hot_rank, ROW_NUMBER() OVER (PARTITION BY data_collection_date ORDER BY temperature_celsius ASC) as cold_rank FROM weather_analytics.current_weather ) SELECT data_collection_date, MAX(CASE WHEN hot_rank = 1 THEN city_name END) as hottest_city, MAX(CASE WHEN hot_rank = 1 THEN temperature_celsius END) as highest_temp, MAX(CASE WHEN cold_rank = 1 THEN city_name END) as coldest_city, MAX(CASE WHEN cold_rank = 1 THEN temperature_celsius END) as lowest_temp FROM temp_extremes WHERE hot_rank = 1 OR cold_rank = 1 GROUP BY data_collection_date ORDER BY data_collection_date; 4.2 Ph√¢n t√≠ch ƒê·ªãa l√Ω Th·ªùi ti·∫øt theo V√πng ƒê·ªãa l√Ω SELECT CASE WHEN latitude \u0026gt; 23.5 THEN \u0026#39;√în ƒë·ªõi B·∫Øc\u0026#39; WHEN latitude \u0026gt; 0 THEN \u0026#39;Nhi·ªát ƒë·ªõi B·∫Øc\u0026#39; WHEN latitude \u0026gt; -23.5 THEN \u0026#39;Nhi·ªát ƒë·ªõi Nam\u0026#39; ELSE \u0026#39;√în ƒë·ªõi Nam\u0026#39; END as climate_zone, COUNT(*) as measurement_count, ROUND(AVG(temperature_celsius), 2) as avg_temperature, ROUND(AVG(humidity_percent), 2) as avg_humidity, ROUND(AVG(wind_speed_kmh), 2) as avg_wind_speed FROM weather_analytics.current_weather GROUP BY CASE WHEN latitude \u0026gt; 23.5 THEN \u0026#39;√în ƒë·ªõi B·∫Øc\u0026#39; WHEN latitude \u0026gt; 0 THEN \u0026#39;Nhi·ªát ƒë·ªõi B·∫Øc\u0026#39; WHEN latitude \u0026gt; -23.5 THEN \u0026#39;Nhi·ªát ƒë·ªõi Nam\u0026#39; ELSE \u0026#39;√în ƒë·ªõi Nam\u0026#39; END ORDER BY avg_temperature DESC; B∆∞·ªõc 5: Xu·∫•t v√† Tr·ª±c quan h√≥a K·∫øt qu·∫£ 5.1 L∆∞u K·∫øt qu·∫£ Truy v·∫•n Ch·∫°y b·∫•t k·ª≥ truy v·∫•n n√†o trong Athena Nh·∫•p Download ƒë·ªÉ l∆∞u k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng CSV K·∫øt qu·∫£ c≈©ng ƒë∆∞·ª£c t·ª± ƒë·ªông l∆∞u v√†o S3 query results bucket c·ªßa b·∫°n 5.2 T·∫°o Tr·ª±c quan h√≥a ƒê∆°n gi·∫£n B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c file CSV ƒë√£ xu·∫•t ƒë·ªÉ t·∫°o bi·ªÉu ƒë·ªì trong:\nExcel ho·∫∑c Google Sheets cho bi·ªÉu ƒë·ªì c∆° b·∫£n Python/Jupyter cho ph√¢n t√≠ch n√¢ng cao QuickSight (ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p trong module ti·∫øp theo) 5.3 V√≠ d·ª• Quy tr√¨nh Ph√¢n t√≠ch -- T·∫°o b√°o c√°o th·ªùi ti·∫øt to√†n di·ªán SELECT city_name, country, COUNT(*) as total_measurements, ROUND(AVG(temperature_celsius), 1) as avg_temp_c, ROUND(MIN(temperature_celsius), 1) as min_temp_c, ROUND(MAX(temperature_celsius), 1) as max_temp_c, ROUND(AVG(humidity_percent), 1) as avg_humidity, ROUND(AVG(pressure_hpa), 1) as avg_pressure, ROUND(AVG(wind_speed_kmh), 1) as avg_wind_kmh, MODE() WITHIN GROUP (ORDER BY weather_main) as most_common_weather, MODE() WITHIN GROUP (ORDER BY comfort_level) as most_common_comfort FROM weather_analytics.current_weather GROUP BY city_name, country HAVING COUNT(*) \u0026gt;= 5 -- Ch·ªâ c√°c th√†nh ph·ªë c√≥ √≠t nh·∫•t 5 ph√©p ƒëo ORDER BY avg_temp_c DESC; B∆∞·ªõc 6: T·ªëi ∆∞u h√≥a Hi·ªáu su·∫•t 6.1 M·∫πo Hi·ªáu su·∫•t Truy v·∫•n S·ª≠ d·ª•ng LIMIT cho truy v·∫•n kh√°m ph√°: SELECT * FROM weather_analytics.current_weather WHERE data_collection_date = \u0026#39;2025-01-15\u0026#39; LIMIT 100; L·ªçc tr√™n c·ªôt partition: -- T·ªët - l·ªçc tr√™n c·ªôt ƒë√£ partition SELECT * FROM weather_analytics.current_weather WHERE data_collection_date BETWEEN \u0026#39;2025-01-01\u0026#39; AND \u0026#39;2025-01-07\u0026#39;; Ch·ªâ select c·ªôt c·∫ßn thi·∫øt: -- Hi·ªáu su·∫•t t·ªët h∆°n SELECT city_name, temperature_celsius, humidity_percent FROM weather_analytics.current_weather; 6.2 T·ªëi ∆∞u h√≥a Chi ph√≠ Gi√°m s√°t vi·ªác s·ª≠ d·ª•ng Athena c·ªßa b·∫°n:\nKi·ªÉm tra CloudWatch metrics cho d·ªØ li·ªáu ƒë∆∞·ª£c qu√©t S·ª≠ d·ª•ng Athena Query History ƒë·ªÉ ph√¢n t√≠ch chi ph√≠ Xem x√©t chuy·ªÉn ƒë·ªïi sang ƒë·ªãnh d·∫°ng Parquet cho dataset l·ªõn Kh·∫Øc ph·ª•c C√°c V·∫•n ƒë·ªÅ Th∆∞·ªùng g·∫∑p V·∫•n ƒë·ªÅ 1: L·ªói \u0026ldquo;Table not found\u0026rdquo; X√°c minh quy·ªÅn S3 bucket c·ªßa b·∫°n Ki·ªÉm tra d·ªØ li·ªáu t·ªìn t·∫°i trong v·ªã tr√≠ S3 ƒë√£ ch·ªâ ƒë·ªãnh ƒê·∫£m b·∫£o schema table ph√π h·ª£p v·ªõi d·ªØ li·ªáu c·ªßa b·∫°n V·∫•n ƒë·ªÅ 2: \u0026ldquo;Zero records returned\u0026rdquo; X√°c minh ƒë·ªãnh d·∫°ng d·ªØ li·ªáu ph√π h·ª£p v·ªõi schema table Ki·ªÉm tra ƒë∆∞·ªùng d·∫´n S3 trong ƒë·ªãnh nghƒ©a table ƒê·∫£m b·∫£o files ·ªü ƒë·ªãnh d·∫°ng JSON nh∆∞ mong ƒë·ª£i V·∫•n ƒë·ªÅ 3: L·ªói \u0026ldquo;Access denied\u0026rdquo; Ki·ªÉm tra quy·ªÅn IAM cho Athena v√† S3 X√°c minh quy·ªÅn query results bucket Ph√¢n t√≠ch Chi ph√≠ Chi ph√≠ ƒëi·ªÉn h√¨nh cho module n√†y:\nTruy v·∫•n Athena: ~$5 per TB d·ªØ li·ªáu ƒë∆∞·ª£c qu√©t L∆∞u tr·ªØ S3: ~$0.023 per GB/th√°ng Y√™u c·∫ßu S3: ~$0.0004 per 1,000 y√™u c·∫ßu ƒê·ªëi v·ªõi dataset th·ªùi ti·∫øt ƒëi·ªÉn h√¨nh (1-10 MB), mong ƒë·ª£i t·ªïng chi ph√≠ d∆∞·ªõi $0.50.\nC√°c b∆∞·ªõc ti·∫øp theo Sau khi ho√†n th√†nh module n√†y, b·∫°n s·∫Ω c√≥ th·ªÉ ph√¢n t√≠ch d·ªØ li·ªáu th·ªùi ti·∫øt c·ªßa m√¨nh b·∫±ng c√°c truy v·∫•n SQL trong Athena. Trong module ti·∫øp theo, ch√∫ng ta s·∫Ω x√¢y d·ª±ng tr√™n n·ªÅn t·∫£ng n√†y ƒë·ªÉ t·∫°o b·∫£ng ƒëi·ªÅu khi·ªÉn t∆∞∆°ng t√°c b·∫±ng Amazon QuickSight.\nKhi vi·∫øt truy v·∫•n Athena, lu√¥n c·ªë g·∫Øng gi·ªõi h·∫°n l∆∞·ª£ng d·ªØ li·ªáu ƒë∆∞·ª£c qu√©t b·∫±ng c√°ch s·ª≠ d·ª•ng m·ªánh ƒë·ªÅ WHERE th√≠ch h·ª£p tr√™n c√°c tr∆∞·ªùng ng√†y th√°ng v√† c√°c c·ªôt ƒë∆∞·ª£c l·ªçc th∆∞·ªùng xuy√™n kh√°c.\nL∆∞u c√°c truy v·∫•n h·ªØu √≠ch c·ªßa b·∫°n d∆∞·ªõi d·∫°ng Saved Queries trong Athena ƒë·ªÉ t√°i s·ª≠ d·ª•ng. B·∫°n c≈©ng c√≥ th·ªÉ t·∫°o Views cho c√°c truy v·∫•n ph·ª©c t·∫°p th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng.\nNh·ªõ thay th·∫ø t√™n bucket placeholder b·∫±ng t√™n S3 bucket th·ª±c t·∫ø c·ªßa b·∫°n trong t·∫•t c·∫£ truy v·∫•n SQL.\n"
},
{
	"uri": "//localhost:1313/vi/5-analytics-visualization/",
	"title": "Tr·ª±c quan h√≥a D·ªØ li·ªáu v·ªõi QuickSight",
	"tags": [],
	"description": "",
	"content": "Tr·ª±c quan h√≥a D·ªØ li·ªáu v·ªõi Amazon QuickSight B√¢y gi·ªù khi b·∫°n ƒë√£ c√≥ d·ªØ li·ªáu th·ªùi ti·∫øt ƒë∆∞·ª£c l∆∞u tr·ªØ v√† c√≥ th·ªÉ truy v·∫•n th√¥ng qua Athena, ƒë√£ ƒë·∫øn l√∫c t·∫°o c√°c tr·ª±c quan h√≥a h·∫•p d·∫´n! Trong module n√†y, b·∫°n s·∫Ω s·ª≠ d·ª•ng Amazon QuickSight ƒë·ªÉ x√¢y d·ª±ng dashboard t∆∞∆°ng t√°c gi√∫p d·ªØ li·ªáu th·ªùi ti·∫øt c·ªßa b·∫°n tr·ªü n√™n sinh ƒë·ªông.\nT·ªïng quan Module Amazon QuickSight l√† d·ªãch v·ª• business intelligence (BI) c·ªßa AWS gi√∫p d·ªÖ d√†ng t·∫°o v√† xu·∫•t b·∫£n c√°c dashboard t∆∞∆°ng t√°c. B·∫°n s·∫Ω k·∫øt n·ªëi QuickSight v·ªõi ngu·ªìn d·ªØ li·ªáu Athena v√† t·∫°o c√°c tr·ª±c quan h√≥a ti·∫øt l·ªô c√°c m·∫´u v√† th√¥ng tin chi ti·∫øt t·ª´ d·ªØ li·ªáu th·ªùi ti·∫øt.\nTh·ªùi gian: 45-60 ph√∫t\nChi ph√≠: ~$3-4 (s·ª≠ d·ª•ng d√πng th·ª≠ mi·ªÖn ph√≠)\nNh·ªØng g√¨ b·∫°n s·∫Ω X√¢y d·ª±ng graph LR\rA[Athena Data] --\u0026gt; B[QuickSight Dataset]\rB --\u0026gt; C[Visualizations]\rC --\u0026gt; D[Interactive Dashboard]\rD --\u0026gt; E[Published Reports]\rstyle B fill:#ff9900,stroke:#232f3e,stroke-width:3px\rstyle D fill:#66bb6a ƒêi·ªÅu ki·ªán ti√™n quy·∫øt ƒê√£ ho√†n th√†nh Module 4: Ph√¢n t√≠ch D·ªØ li·ªáu v·ªõi Athena D·ªØ li·ªáu th·ªùi ti·∫øt c√≥ s·∫µn trong b·∫£ng Athena T√†i kho·∫£n AWS v·ªõi quy·ªÅn QuickSight B∆∞·ªõc 1: Thi·∫øt l·∫≠p Amazon QuickSight 1.1 ƒêƒÉng k√Ω QuickSight ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn Amazon QuickSight console Nh·∫•p Sign up for QuickSight Ch·ªçn Standard Edition (bao g·ªìm d√πng th·ª≠ mi·ªÖn ph√≠ 30 ng√†y) Nh·∫≠p th√¥ng tin t√†i kho·∫£n: Account name: weather-analytics-[ten-ban] Notification email: ƒê·ªãa ch·ªâ email c·ªßa b·∫°n Nh·∫•p Finish 1.2 C·∫•u h√¨nh Quy·ªÅn QuickSight Trong QuickSight, nh·∫•p bi·ªÉu t∆∞·ª£ng profile (g√≥c ph·∫£i tr√™n) Ch·ªçn Manage QuickSight Ch·ªçn Security \u0026amp; permissions Nh·∫•p Add or remove K√≠ch ho·∫°t c√°c d·ªãch v·ª• sau: ‚úÖ Amazon Athena ‚úÖ Amazon S3 Cho S3, nh·∫•p Select S3 buckets Ch·ªçn bucket d·ªØ li·ªáu th·ªùi ti·∫øt: your-weather-processed-bucket your-athena-query-results-bucket Nh·∫•p Update B∆∞·ªõc 2: T·∫°o Data Source v√† Dataset 2.1 K·∫øt n·ªëi v·ªõi Athena Trong trang ch·ªß QuickSight, nh·∫•p Datasets Nh·∫•p New dataset Ch·ªçn Athena l√†m data source C·∫•u h√¨nh k·∫øt n·ªëi: Data source name: Weather-Data-Athena Athena workgroup: primary (m·∫∑c ƒë·ªãnh) Nh·∫•p Create data source 2.2 T·∫°o Dataset t·ª´ Weather Table Ch·ªçn database: weather_analytics Ch·ªçn table: current_weather Ch·ªçn Directly query your data Nh·∫•p Visualize N·∫øu dataset c·ªßa b·∫°n nh·ªè (\u0026lt; 1GB), b·∫°n c√≥ th·ªÉ ch·ªçn \u0026ldquo;Import to SPICE\u0026rdquo; ƒë·ªÉ c√≥ hi·ªáu su·∫•t t·ªët h∆°n. SPICE l√† engine t√≠nh to√°n trong b·ªô nh·ªõ c·ªßa QuickSight.\nB∆∞·ªõc 3: T·∫°o Tr·ª±c quan h√≥a Th·ªùi ti·∫øt 3.1 Bi·ªÉu ƒë·ªì ƒê∆∞·ªùng Xu h∆∞·ªõng Nhi·ªát ƒë·ªô T·∫°o ph√¢n t√≠ch m·ªõi:\nNh·∫•p + Add ‚Üí Add visual Ch·ªçn Line chart C·∫•u h√¨nh bi·ªÉu ƒë·ªì:\nX-axis: K√©o data_collection_date v√†o X-axis Value: K√©o temperature_celsius v√†o Value Color: K√©o city_name v√†o Color T√πy ch·ªânh bi·ªÉu ƒë·ªì:\nNh·∫•p visual ‚Üí Format visual Title: \u0026ldquo;Xu h∆∞·ªõng Nhi·ªát ƒë·ªô theo Th√†nh ph·ªë\u0026rdquo; Y-axis label: \u0026ldquo;Nhi·ªát ƒë·ªô (¬∞C)\u0026rdquo; Legend: ƒê·∫∑t ·ªü d∆∞·ªõi c√πng 3.2 Bi·ªÉu ƒë·ªì Tr√≤n ƒêi·ªÅu ki·ªán Th·ªùi ti·∫øt Th√™m visual m·ªõi:\nNh·∫•p + Add ‚Üí Add visual Ch·ªçn Pie chart C·∫•u h√¨nh bi·ªÉu ƒë·ªì:\nGroup/Color: K√©o weather_main v√†o Group/Color Value: K√©o city_name v√†o Value Aggregate: ƒê·ªïi th√†nh Count T√πy ch·ªânh:\nTitle: \u0026ldquo;Ph√¢n b·ªë ƒêi·ªÅu ki·ªán Th·ªùi ti·∫øt\u0026rdquo; Legend: Hi·ªÉn th·ªã ph·∫ßn trƒÉm 3.3 Bi·ªÉu ƒë·ªì C·ªôt So s√°nh Nhi·ªát ƒë·ªô Th√†nh ph·ªë Th√™m visual m·ªõi:\nCh·ªçn Vertical bar chart C·∫•u h√¨nh:\nX-axis: K√©o city_name v√†o X-axis Value: K√©o temperature_celsius v√†o Value Aggregate: ƒê·ªïi th√†nh Average T√πy ch·ªânh:\nTitle: \u0026ldquo;Nhi·ªát ƒë·ªô Trung b√¨nh theo Th√†nh ph·ªë\u0026rdquo; Y-axis label: \u0026ldquo;Nhi·ªát ƒë·ªô Trung b√¨nh (¬∞C)\u0026rdquo; S·∫Øp x·∫øp theo gi√° tr·ªã (gi·∫£m d·∫ßn) 3.4 Bi·ªÉu ƒë·ªì Ph√¢n t√°n ƒê·ªô ·∫©m vs Nhi·ªát ƒë·ªô Th√™m visual m·ªõi:\nCh·ªçn Scatter plot C·∫•u h√¨nh:\nX-axis: K√©o temperature_celsius v√†o X-axis Y-axis: K√©o humidity_percent v√†o Y-axis Color: K√©o comfort_level v√†o Color Size: K√©o pressure_hpa v√†o Size T√πy ch·ªânh:\nTitle: \u0026ldquo;T∆∞∆°ng quan ƒê·ªô ·∫©m v√† Nhi·ªát ƒë·ªô\u0026rdquo; X-axis label: \u0026ldquo;Nhi·ªát ƒë·ªô (¬∞C)\u0026rdquo; Y-axis label: \u0026ldquo;ƒê·ªô ·∫©m (%)\u0026rdquo; 3.5 Ch·ªâ s·ªë Hi·ªáu su·∫•t Ch√≠nh (KPIs) T·∫°o c√°c √¥ KPI cho d·ªØ li·ªáu th·ªùi ti·∫øt m·ªõi nh·∫•t:\nKPI Nhi·ªát ƒë·ªô Hi·ªán t·∫°i Th√™m visual m·ªõi ‚Üí KPI C·∫•u h√¨nh: Value: temperature_celsius Aggregate: Average Filter: Th√™m filter cho ng√†y m·ªõi nh·∫•t Title: \u0026ldquo;Nhi·ªát ƒë·ªô Trung b√¨nh Hi·ªán t·∫°i\u0026rdquo; KPI T·ªëc ƒë·ªô Gi√≥ Th√™m KPI visual C·∫•u h√¨nh: Value: wind_speed_kmh Aggregate: Average Title: \u0026ldquo;T·ªëc ƒë·ªô Gi√≥ Trung b√¨nh Hi·ªán t·∫°i\u0026rdquo; KPI ƒê·ªô ·∫©m Th√™m KPI visual C·∫•u h√¨nh: Value: humidity_percent Aggregate: Average Title: \u0026ldquo;ƒê·ªô ·∫©m Trung b√¨nh Hi·ªán t·∫°i\u0026rdquo; B∆∞·ªõc 4: X√¢y d·ª±ng Dashboard To√†n di·ªán 4.1 T·ªï ch·ª©c B·ªë c·ª•c Dashboard Thay ƒë·ªïi k√≠ch th∆∞·ªõc v√† s·∫Øp x·∫øp visuals:\nƒê·∫∑t KPIs ·ªü tr√™n c√πng theo h√†ng ngang Bi·ªÉu ƒë·ªì xu h∆∞·ªõng nhi·ªát ƒë·ªô ·ªü khu v·ª±c ch√≠nh Bi·ªÉu ƒë·ªì tr√≤n v√† bi·ªÉu ƒë·ªì c·ªôt c·∫°nh nhau b√™n d∆∞·ªõi Bi·ªÉu ƒë·ªì ph√¢n t√°n ·ªü d∆∞·ªõi c√πng Th√™m ti√™u ƒë·ªÅ dashboard:\nNh·∫•p + Add ‚Üí Add title Text: \u0026ldquo;Dashboard Ph√¢n t√≠ch Th·ªùi ti·∫øt\u0026rdquo; Style: L·ªõn, cƒÉn gi·ªØa 4.2 Th√™m B·ªô l·ªçc T∆∞∆°ng t√°c Th√™m b·ªô l·ªçc ng√†y:\nNh·∫•p Filter pane (b√™n tr√°i) Nh·∫•p Create one ‚Üí Ch·ªçn data_collection_date Filter type: Date range Default: 7 ng√†y g·∫ßn nh·∫•t Th√™m b·ªô l·ªçc th√†nh ph·ªë:\nT·∫°o filter cho city_name Filter type: Multi-select dropdown Hi·ªÉn th·ªã t·∫•t c·∫£ th√†nh ph·ªë theo m·∫∑c ƒë·ªãnh Th√™m b·ªô l·ªçc ƒëi·ªÅu ki·ªán th·ªùi ti·∫øt:\nT·∫°o filter cho weather_main Filter type: Multi-select dropdown 4.3 √Åp d·ª•ng Styling Dashboard Ch·ªçn color theme:\nNh·∫•p Themes (menu tr√™n) Ch·ªçn Midnight ho·∫∑c Classic T√πy ch·ªânh m√†u s·∫Øc:\nCho bi·ªÉu ƒë·ªì nhi·ªát ƒë·ªô: S·ª≠ d·ª•ng gradient xanh-ƒë·ªè Cho ƒëi·ªÅu ki·ªán th·ªùi ti·∫øt: S·ª≠ d·ª•ng m√†u ri√™ng bi·ªát cho m·ªói ƒëi·ªÅu ki·ªán Th√™m text m√¥ t·∫£:\nNh·∫•p + Add ‚Üí Add text box Th√™m insights ho·∫∑c h∆∞·ªõng d·∫´n cho ng∆∞·ªùi d√πng dashboard B∆∞·ªõc 5: Tr·ª±c quan h√≥a N√¢ng cao 5.1 T·∫°o Heat Map cho Nhi·ªát ƒë·ªô theo Th·ªùi gian Th√™m visual m·ªõi ‚Üí Heat map C·∫•u h√¨nh: Rows: city_name Columns: data_collection_date Values: temperature_celsius (Average) T√πy ch·ªânh: Title: \u0026ldquo;Heat Map Nhi·ªát ƒë·ªô theo Th√†nh ph·ªë v√† Ng√†y\u0026rdquo; Color scale: Xanh (l·∫°nh) ƒë·∫øn ƒê·ªè (n√≥ng) 5.2 Bi·ªÉu ƒë·ªì H∆∞·ªõng Gi√≥ (S·ª≠ d·ª•ng Calculated Fields) T·∫°o calculated field:\nNh·∫•p + Add ‚Üí Add calculated field Name: wind_direction_category Formula: ifelse(\rwind_direction_deg \u0026gt;= 337.5 OR wind_direction_deg \u0026lt; 22.5, \u0026#34;N\u0026#34;,\rwind_direction_deg \u0026gt;= 22.5 AND wind_direction_deg \u0026lt; 67.5, \u0026#34;NE\u0026#34;,\rwind_direction_deg \u0026gt;= 67.5 AND wind_direction_deg \u0026lt; 112.5, \u0026#34;E\u0026#34;,\rwind_direction_deg \u0026gt;= 112.5 AND wind_direction_deg \u0026lt; 157.5, \u0026#34;SE\u0026#34;,\rwind_direction_deg \u0026gt;= 157.5 AND wind_direction_deg \u0026lt; 202.5, \u0026#34;S\u0026#34;,\rwind_direction_deg \u0026gt;= 202.5 AND wind_direction_deg \u0026lt; 247.5, \u0026#34;SW\u0026#34;,\rwind_direction_deg \u0026gt;= 247.5 AND wind_direction_deg \u0026lt; 292.5, \u0026#34;W\u0026#34;,\r\u0026#34;NW\u0026#34;\r) T·∫°o bi·ªÉu ƒë·ªì h∆∞·ªõng gi√≥:\nVisual type: Donut chart Group: wind_direction_category Value: Count of records Title: \u0026ldquo;Ph√¢n b·ªë H∆∞·ªõng Gi√≥\u0026rdquo; 5.3 Gauge M·ª©c ƒë·ªô Nghi√™m tr·ªçng Th·ªùi ti·∫øt T·∫°o calculated field:\nName: severity_score Formula: ifelse(\rweather_severity = \u0026#34;nghi√™m_tr·ªçng\u0026#34;, 4,\rweather_severity = \u0026#34;v·ª´a\u0026#34;, 3,\rweather_severity = \u0026#34;nh·∫π\u0026#34;, 2,\r1\r) Th√™m gauge visual:\nValue: severity_score (Average) Title: \u0026ldquo;Ch·ªâ s·ªë M·ª©c ƒë·ªô Nghi√™m tr·ªçng Th·ªùi ti·∫øt\u0026rdquo; Range: 1-4 B∆∞·ªõc 6: Xu·∫•t b·∫£n v√† Chia s·∫ª Dashboard 6.1 Xu·∫•t b·∫£n Dashboard Nh·∫•p Share (g√≥c ph·∫£i tr√™n) Nh·∫•p Publish dashboard Dashboard name: \u0026ldquo;Dashboard Ph√¢n t√≠ch Th·ªùi ti·∫øt\u0026rdquo; Description: \u0026ldquo;Tr·ª±c quan h√≥a d·ªØ li·ªáu th·ªùi ti·∫øt t∆∞∆°ng t√°c hi·ªÉn th·ªã xu h∆∞·ªõng nhi·ªát ƒë·ªô, m·∫´u th·ªùi ti·∫øt v√† so s√°nh th√†nh ph·ªë\u0026rdquo; Nh·∫•p Publish dashboard 6.2 Thi·∫øt l·∫≠p Quy·ªÅn Chia s·∫ª Trong dashboard ƒë√£ xu·∫•t b·∫£n, nh·∫•p Share Add users or groups: Nh·∫≠p ƒë·ªãa ch·ªâ email c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ chia s·∫ª ƒê·∫∑t quy·ªÅn: Viewer ho·∫∑c Co-owner Nh·∫•p Share 6.3 T·∫°o Dashboard C√¥ng khai (T√πy ch·ªçn) Nh·∫•p Share ‚Üí Manage dashboard access K√≠ch ho·∫°t Make dashboard public Sao ch√©p URL c√¥ng khai ƒë·ªÉ chia s·∫ª b√™n ngo√†i Ch·ªâ c√¥ng khai dashboard n·∫øu d·ªØ li·ªáu th·ªùi ti·∫øt c·ªßa b·∫°n kh√¥ng ch·ª©a th√¥ng tin nh·∫°y c·∫£m.\nB∆∞·ªõc 7: Thi·∫øt l·∫≠p L√†m m·ªõi D·ªØ li·ªáu T·ª± ƒë·ªông 7.1 C·∫•u h√¨nh L√†m m·ªõi Dataset ƒêi ƒë·∫øn Datasets Ch·ªçn weather dataset c·ªßa b·∫°n Nh·∫•p Refresh ‚Üí Schedule refresh C·∫•u h√¨nh l·ªãch: Frequency: Daily Time: S√°ng s·ªõm (v√≠ d·ª•: 6 AM) Time zone: M√∫i gi·ªù ƒë·ªãa ph∆∞∆°ng c·ªßa b·∫°n L∆∞u l·ªãch 7.2 Gi√°m s√°t Tr·∫°ng th√°i L√†m m·ªõi Ki·ªÉm tra l·ªãch s·ª≠ l√†m m·ªõi trong Dataset settings Thi·∫øt l·∫≠p th√¥ng b√°o cho l√†m m·ªõi th·∫•t b·∫°i Gi√°m s√°t ch·ªâ b√°o ƒë·ªô t∆∞∆°i c·ªßa d·ªØ li·ªáu trong dashboard B∆∞·ªõc 8: T·ªëi ∆∞u h√≥a Dashboard v√† Best Practices 8.1 T·ªëi ∆∞u h√≥a Hi·ªáu su·∫•t S·ª≠ d·ª•ng SPICE cho hi·ªáu su·∫•t t·ªët h∆°n:\nImport d·ªØ li·ªáu v√†o SPICE n·∫øu dataset \u0026lt; 10GB L·∫≠p l·ªãch l√†m m·ªõi SPICE th∆∞·ªùng xuy√™n T·ªëi ∆∞u h√≥a truy v·∫•n:\nS·ª≠ d·ª•ng filter ƒë·ªÉ gi·∫£m vi·ªác qu√©t d·ªØ li·ªáu T·∫°o b·∫£ng t√≥m t·∫Øt trong Athena cho dataset l·ªõn Gi·ªõi h·∫°n ƒë·ªô ph·ª©c t·∫°p visual:\nT·ªëi ƒëa 15-20 ƒëi·ªÉm d·ªØ li·ªáu m·ªói bi·ªÉu ƒë·ªì S·ª≠ d·ª•ng drill-down cho view chi ti·∫øt 8.2 Best Practices Tr·∫£i nghi·ªám Ng∆∞·ªùi d√πng Th·ª© b·∫≠c visual r√µ r√†ng:\nC√°c metric quan tr·ªçng nh·∫•t ·ªü tr√™n C√°c visual li√™n quan ƒë∆∞·ª£c nh√≥m l·∫°i M√†u s·∫Øc nh·∫•t qu√°n C√°c y·∫øu t·ªë t∆∞∆°ng t√°c:\nCung c·∫•p h∆∞·ªõng d·∫´n filter r√µ r√†ng S·ª≠ d·ª•ng ph·∫°m vi ng√†y nh·∫•t qu√°n K√≠ch ho·∫°t cross-filtering gi·ªØa c√°c visual T√≠nh responsive di ƒë·ªông:\nKi·ªÉm tra dashboard tr√™n thi·∫øt b·ªã di ƒë·ªông ƒêi·ªÅu ch·ªânh layout cho m√†n h√¨nh nh·ªè h∆°n ∆Øu ti√™n metric ch√≠nh cho view di ƒë·ªông Kh·∫Øc ph·ª•c C√°c V·∫•n ƒë·ªÅ Th∆∞·ªùng g·∫∑p V·∫•n ƒë·ªÅ 1: L·ªói \u0026ldquo;Insufficient permissions\u0026rdquo; Gi·∫£i ph√°p: Ki·ªÉm tra quy·ªÅn IAM c·ªßa QuickSight cho truy c·∫≠p Athena v√† S3 X√°c minh quy·ªÅn bucket trong c√†i ƒë·∫∑t b·∫£o m·∫≠t QuickSight V·∫•n ƒë·ªÅ 2: D·ªØ li·ªáu Kh√¥ng L√†m m·ªõi Gi·∫£i ph√°p: Ki·ªÉm tra quy·ªÅn truy v·∫•n Athena X√°c minh tr·∫°ng th√°i k·∫øt n·ªëi data source Xem l·∫°i error logs c·ªßa l√†m m·ªõi V·∫•n ƒë·ªÅ 3: Hi·ªáu su·∫•t Dashboard Ch·∫≠m Gi·∫£i ph√°p: Import d·ªØ li·ªáu v√†o SPICE T·ªëi ∆∞u h√≥a truy v·∫•n Athena v·ªõi filtering ph√π h·ª£p Gi·∫£m s·ªë l∆∞·ª£ng visual m·ªói dashboard Ph√¢n t√≠ch Chi ph√≠ Chi ph√≠ QuickSight cho module n√†y:\nStandard Edition: $9/th√°ng m·ªói author (d√πng th·ª≠ mi·ªÖn ph√≠ 30 ng√†y) SPICE storage: $0.25/GB/th√°ng Enterprise Edition: $18/th√°ng m·ªói author (t√≠nh nƒÉng n√¢ng cao) T·ªïng chi ph√≠ ∆∞·ªõc t√≠nh: $0-4 trong th·ªùi gian d√πng th·ª≠ mi·ªÖn ph√≠\nBest Practices B·∫£o m·∫≠t Ki·ªÉm so√°t Truy c·∫≠p:\nS·ª≠ d·ª•ng IAM roles cho quy·ªÅn d·ªãch v·ª• Tri·ªÉn khai row-level security n·∫øu c·∫ßn Audit th∆∞·ªùng xuy√™n quy·ªÅn truy c·∫≠p ng∆∞·ªùi d√πng B·∫£o v·ªá D·ªØ li·ªáu:\nK√≠ch ho·∫°t m√£ h√≥a trong transit v√† at rest S·ª≠ d·ª•ng VPC endpoints cho k·∫øt n·ªëi ri√™ng t∆∞ Gi√°m s√°t patterns truy c·∫≠p d·ªØ li·ªáu C√°c b∆∞·ªõc ti·∫øp theo Sau khi ho√†n th√†nh module n√†y, b·∫°n s·∫Ω c√≥:\n‚úÖ Dashboard th·ªùi ti·∫øt t∆∞∆°ng t√°c v·ªõi nhi·ªÅu tr·ª±c quan h√≥a ‚úÖ L√†m m·ªõi d·ªØ li·ªáu t·ª± ƒë·ªông t·ª´ ETL pipeline ‚úÖ Insights c√≥ th·ªÉ chia s·∫ª cho ph√¢n t√≠ch th·ªùi ti·∫øt ‚úÖ Hi·ªÉu bi·∫øt v·ªÅ best practices c·ªßa QuickSight S·∫Øp t·ªõi trong Module 6: H·ªçc c√°ch d·ªçn d·∫πp ƒë√∫ng c√°ch c√°c t√†i nguy√™n AWS v√† kh√°m ph√° c√°c c·∫£i ti·∫øn n√¢ng cao cho n·ªÅn t·∫£ng ph√¢n t√≠ch th·ªùi ti·∫øt c·ªßa b·∫°n.\nL∆∞u dashboard c·ªßa b·∫°n d∆∞·ªõi d·∫°ng template ƒë·ªÉ nhanh ch√≥ng t·∫°o dashboard t∆∞∆°ng t·ª± cho c√°c dataset ho·∫∑c th·ªùi gian kh√°c nhau.\nQuickSight cung c·∫•p insights ƒë∆∞·ª£c h·ªó tr·ª£ ML. H√£y th·ª≠ t√≠nh nƒÉng ML Insights ƒë·ªÉ t·ª± ƒë·ªông kh√°m ph√° anomalies v√† trends trong d·ªØ li·ªáu th·ªùi ti·∫øt c·ªßa b·∫°n.\nNh·ªõ h·ªßy ƒëƒÉng k√Ω QuickSight sau workshop n·∫øu b·∫°n kh√¥ng c√≥ k·∫ø ho·∫°ch ti·∫øp t·ª•c s·ª≠ d·ª•ng ƒë·ªÉ tr√°nh c√°c kho·∫£n ph√≠ li√™n t·ª•c.\n"
},
{
	"uri": "//localhost:1313/vi/6-cleanup-next-steps/",
	"title": "D·ªçn d·∫πp T√†i nguy√™n v√† B∆∞·ªõc ti·∫øp theo",
	"tags": [],
	"description": "",
	"content": "D·ªçn d·∫πp T√†i nguy√™n v√† B∆∞·ªõc ti·∫øp theo Ch√∫c m·ª´ng b·∫°n ƒë√£ x√¢y d·ª±ng xong pipeline ETL th·ªùi ti·∫øt serverless ho√†n ch·ªânh! Module cu·ªëi c√πng n√†y t·∫≠p trung v√†o vi·ªác d·ªçn d·∫πp ƒë√∫ng c√°ch t·∫•t c·∫£ t√†i nguy√™n AWS ƒë·ªÉ tr√°nh c√°c kho·∫£n ph√≠ li√™n t·ª•c v√† kh√°m ph√° c√°c c∆° h·ªôi c·∫£i ti·∫øn th√™m.\nT·ªïng quan Module Sau khi ho√†n th√†nh workshop th·ª±c h√†nh, vi·ªác d·ªçn d·∫πp t√†i nguy√™n l√† r·∫•t quan tr·ªçng ƒë·ªÉ ngƒÉn ng·ª´a c√°c kho·∫£n ph√≠ b·∫•t ng·ªù. Module n√†y cung c·∫•p c√°c th·ªß t·ª•c d·ªçn d·∫πp to√†n di·ªán v√† g·ª£i √Ω c√°c b∆∞·ªõc ti·∫øp theo ƒë·ªÉ m·ªü r·ªông pipeline th·ªùi ti·∫øt c·ªßa b·∫°n.\nM·ª•c ti√™u H·ªçc t·∫≠p Sau khi ho√†n th√†nh module n√†y, b·∫°n s·∫Ω:\nHi·ªÉu t·∫ßm quan tr·ªçng c·ªßa vi·ªác d·ªçn d·∫πp t√†i nguy√™n trong AWS Th·ª±c hi·ªán c√°c th·ªß t·ª•c d·ªçn d·∫πp to√†n di·ªán cho t·∫•t c·∫£ t√†i nguy√™n ƒë√£ t·∫°o H·ªçc c√°c chi·∫øn l∆∞·ª£c t·ªëi ∆∞u chi ph√≠ cho c√°c d·ª± √°n t∆∞∆°ng lai Kh√°m ph√° c√°c t√≠nh nƒÉng n√¢ng cao v√† c·∫£i ti·∫øn cho pipeline c·ªßa b·∫°n Kh√°m ph√° c√°c t√†i nguy√™n h·ªçc t·∫≠p b·ªï sung T·∫ßm quan tr·ªçng c·ªßa D·ªçn d·∫πp D·ªçn d·∫πp ƒë√∫ng c√°ch l√† c·∫ßn thi·∫øt v√¨:\nQu·∫£n l√Ω Chi ph√≠: NgƒÉn ng·ª´a c√°c kho·∫£n ph√≠ b·∫•t ng·ªù t·ª´ t√†i nguy√™n kh√¥ng s·ª≠ d·ª•ng B·∫£o m·∫≠t: Lo·∫°i b·ªè c√°c quy·ªÅn v√† ƒëi·ªÉm truy c·∫≠p kh√¥ng s·ª≠ d·ª•ng Best Practices: Thi·∫øt l·∫≠p th√≥i quen qu·∫£n l√Ω t√†i nguy√™n AWS t·ªët V·ªá sinh T√†i kho·∫£n: Gi·ªØ t√†i kho·∫£n AWS c·ªßa b·∫°n c√≥ t·ªï ch·ª©c v√† d·ªÖ qu·∫£n l√Ω Danh s√°ch Ki·ªÉm tra D·ªçn d·∫πp Ho√†n ch·ªânh 6.1 T√†i nguy√™n QuickSight ∆Øu ti√™n: Cao (Chi ph√≠ ƒëƒÉng k√Ω li√™n t·ª•c)\nX√≥a Dashboard\nLo·∫°i b·ªè dashboard th·ªùi ti·∫øt c·ªßa b·∫°n X√≥a m·ªçi phi√™n b·∫£n ƒë√£ chia s·∫ª X√≥a Dataset\nLo·∫°i b·ªè dataset d·ªØ li·ªáu th·ªùi ti·∫øt X√≥a m·ªçi d·ªØ li·ªáu cached H·ªßy ƒêƒÉng k√Ω (n·∫øu kh√¥ng c√≤n c·∫ßn thi·∫øt)\nH·∫° c·∫•p t·ª´ Author xu·ªëng Reader H·ªßy ƒëƒÉng k√Ω ƒë·ªÉ tr√°nh ph√≠ h√†ng th√°ng 6.2 T√†i nguy√™n Athena ∆Øu ti√™n: Trung b√¨nh (L∆∞u tr·ªØ k·∫øt qu·∫£ truy v·∫•n)\nDrop Tables\nDROP TABLE weather_data_processed; DROP TABLE weather_data_raw; Drop Database\nDROP DATABASE weather_analytics; D·ªçn d·∫πp K·∫øt qu·∫£ Truy v·∫•n\nX√≥a c√°c file k·∫øt qu·∫£ truy v·∫•n Athena t·ª´ S3 6.3 S3 Bucket v√† D·ªØ li·ªáu ∆Øu ti√™n: Cao (Chi ph√≠ l∆∞u tr·ªØ)\nX√≥a Raw Data Bucket\naws s3 rm s3://weather-data-raw-[YOUR-ID] --recursive aws s3 rb s3://weather-data-raw-[YOUR-ID] X√≥a Processed Data Bucket\naws s3 rm s3://weather-data-processed-[YOUR-ID] --recursive aws s3 rb s3://weather-data-processed-[YOUR-ID] X√≥a Athena Results Bucket\naws s3 rm s3://aws-athena-query-results-[ACCOUNT-ID]-[REGION] --recursive 6.4 Lambda Function ∆Øu ti√™n: Trung b√¨nh (Chi ph√≠ li√™n t·ª•c t·ªëi thi·ªÉu)\nX√≥a Weather Collector Function\naws lambda delete-function --function-name weather-data-collector X√≥a Weather Processor Function\naws lambda delete-function --function-name weather-data-processor Lo·∫°i b·ªè Function Trigger\nX√≥a EventBridge rules Lo·∫°i b·ªè S3 event notification 6.5 T√†i nguy√™n CloudWatch ∆Øu ti√™n: Th·∫•p (Free tier bao g·ªìm h·∫ßu h·∫øt vi·ªác s·ª≠ d·ª•ng)\nX√≥a Log Group\naws logs delete-log-group --log-group-name /aws/lambda/weather-data-collector aws logs delete-log-group --log-group-name /aws/lambda/weather-data-processor X√≥a EventBridge Rule\naws events delete-rule --name weather-collection-schedule Lo·∫°i b·ªè Custom Metric (n·∫øu c√≥)\n6.6 IAM Role v√† Policy ∆Øu ti√™n: Trung b√¨nh (B·∫£o m·∫≠t v√† t·ªï ch·ª©c)\nDetach Policy t·ª´ Role\naws iam detach-role-policy --role-name weather-lambda-role --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess aws iam detach-role-policy --role-name weather-lambda-role --policy-arn arn:aws:iam::aws:policy/CloudWatchLogsFullAccess X√≥a IAM Role\naws iam delete-role --role-name weather-lambda-role aws iam delete-role --role-name quicksight-athena-role Lo·∫°i b·ªè Custom Policy (n·∫øu ƒë√£ t·∫°o)\n6.7 Systems Manager Parameter ∆Øu ti√™n: Th·∫•p (Kh√¥ng c√≥ chi ph√≠ li√™n t·ª•c)\nX√≥a Parameter Store Value aws ssm delete-parameter --name /weather-etl/openweathermap/api-key T√≥m t·∫Øt Chi ph√≠ Cu·ªëi c√πng Sau khi ho√†n th√†nh d·ªçn d·∫πp, t·ªïng chi ph√≠ workshop ∆∞·ªõc t√≠nh c·ªßa b·∫°n s·∫Ω l√†:\nLambda Execution: ~$0.10 (trong Free Tier) S3 Storage: ~$0.20 (d·ªØ li·ªáu t·ªëi thi·ªÉu ƒë∆∞·ª£c l∆∞u tr·ªØ) Athena Queries: ~$0.15 (truy v·∫•n dataset nh·ªè) QuickSight: ~$3-4 (n·∫øu s·ª≠ d·ª•ng free trial) Data Transfer: ~$0.05 (t·ªëi thi·ªÉu) T·ªïng Chi ph√≠ Workshop: D∆∞·ªõi $5 (kh√¥ng bao g·ªìm ƒëƒÉng k√Ω QuickSight)\nB∆∞·ªõc ti·∫øp theo v√† C·∫£i ti·∫øn C·∫£i ti·∫øn Ngay l·∫≠p t·ª©c Thu th·∫≠p D·ªØ li·ªáu N√¢ng cao\nTh√™m nhi·ªÅu th√†nh ph·ªë v√† th√¥ng s·ªë th·ªùi ti·∫øt Tri·ªÉn khai x·ª≠ l√Ω l·ªói v√† retry Th√™m x√°c th·ª±c v√† ki·ªÉm tra ch·∫•t l∆∞·ª£ng d·ªØ li·ªáu X·ª≠ l√Ω N√¢ng cao\nTri·ªÉn khai t·ªïng h·ª£p d·ªØ li·ªáu v√† xu h∆∞·ªõng Th√™m c·∫£nh b√°o v√† th√¥ng b√°o th·ªùi ti·∫øt Bao g·ªìm so s√°nh th·ªùi ti·∫øt l·ªãch s·ª≠ Ph√¢n t√≠ch T·ªët h∆°n\nT·∫°o truy v·∫•n Athena ph·ª©c t·∫°p h∆°n Tri·ªÉn khai d·ª± ƒëo√°n machine learning Th√™m ph√¢n t√≠ch streaming real-time C√¢n nh·∫Øc Production C·∫£i ti·∫øn B·∫£o m·∫≠t\nTri·ªÉn khai IAM policy least-privilege Th√™m m√£ h√≥a khi l∆∞u tr·ªØ v√† truy·ªÅn t·∫£i S·ª≠ d·ª•ng AWS Secrets Manager cho API key Gi√°m s√°t v√† C·∫£nh b√°o\nThi·∫øt l·∫≠p CloudWatch dashboard to√†n di·ªán Tri·ªÉn khai SNS notification cho l·ªói Th√™m custom metric v√† alarm T·ªëi ∆∞u h√≥a Hi·ªáu su·∫•t\nT·ªëi ∆∞u h√≥a b·ªô nh·ªõ v√† timeout setting Lambda Tri·ªÉn khai S3 lifecycle policy Th√™m caching layer khi th√≠ch h·ª£p T√†i nguy√™n H·ªçc t·∫≠p AWS Documentation: T√¨m hi·ªÉu s√¢u h∆°n v·ªÅ c√°c d·ªãch v·ª• c·ª• th·ªÉ AWS Training: Tham gia c√°c kh√≥a h·ªçc AWS ch√≠nh th·ª©c v·ªÅ data engineering Community: Tham gia di·ªÖn ƒë√†n v√† nh√≥m ng∆∞·ªùi d√πng AWS Certification: C√¢n nh·∫Øc AWS Certified Data Analytics specialty B∆∞·ªõc X√°c minh Sau khi d·ªçn d·∫πp, x√°c minh m·ªçi th·ª© ƒë√£ ƒë∆∞·ª£c lo·∫°i b·ªè:\nKi·ªÉm tra AWS Console\nXem l·∫°i t·ª´ng service console ƒë·ªÉ t√¨m t√†i nguy√™n c√≤n l·∫°i Ki·ªÉm tra billing dashboard cho c√°c kho·∫£n ph√≠ li√™n t·ª•c X√°c minh CLI\naws s3 ls | grep weather aws lambda list-functions | grep weather aws iam list-roles | grep weather Gi√°m s√°t Chi ph√≠\nThi·∫øt l·∫≠p billing alert cho c√°c d·ª± √°n t∆∞∆°ng lai Xem l·∫°i AWS Cost Explorer cho b·∫•t k·ª≥ kho·∫£n ph√≠ b·∫•t ng·ªù n√†o K·∫øt lu·∫≠n B·∫°n ƒë√£ x√¢y d·ª±ng th√†nh c√¥ng v√† gi·ªù ƒë√¢y d·ªçn d·∫πp m·ªôt pipeline ETL th·ªùi ti·∫øt serverless ho√†n ch·ªânh! Tr·∫£i nghi·ªám n√†y cung c·∫•p n·ªÅn t·∫£ng v·ªØng ch·∫Øc ƒë·ªÉ x√¢y d·ª±ng c√°c h·ªá th·ªëng x·ª≠ l√Ω d·ªØ li·ªáu ph·ª©c t·∫°p h∆°n.\nƒêi·ªÉm ch√≠nh:\nKi·∫øn tr√∫c serverless ti·∫øt ki·ªám chi ph√≠ v√† c√≥ th·ªÉ m·ªü r·ªông D·ªçn d·∫πp t√†i nguy√™n ƒë√∫ng c√°ch l√† c·∫ßn thi·∫øt cho qu·∫£n l√Ω chi ph√≠ AWS cung c·∫•p c√°c c√¥ng c·ª• m·∫°nh m·∫Ω cho thu th·∫≠p, x·ª≠ l√Ω v√† tr·ª±c quan h√≥a d·ªØ li·ªáu Pipeline ETL c√≥ th·ªÉ ƒë∆∞·ª£c x√¢y d·ª±ng t·ª´ng b∆∞·ªõc v√† ki·ªÉm tra ·ªü m·ªói giai ƒëo·∫°n C·∫£m ∆°n b·∫°n ƒë√£ ho√†n th√†nh workshop n√†y! C√°c k·ªπ nƒÉng b·∫°n ƒë√£ h·ªçc c√≥ th·ªÉ ƒë∆∞·ª£c √°p d·ª•ng cho nhi·ªÅu th√°ch th·ª©c data engineering trong th·∫ø gi·ªõi th·ª±c.\nWorkshop Ho√†n th√†nh - Nh·ªõ x√°c minh t·∫•t c·∫£ t√†i nguy√™n ƒë√£ ƒë∆∞·ª£c d·ªçn d·∫πp ƒë·ªÉ tr√°nh c√°c kho·∫£n ph√≠ b·∫•t ng·ªù.\n"
},
{
	"uri": "//localhost:1313/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "//localhost:1313/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]